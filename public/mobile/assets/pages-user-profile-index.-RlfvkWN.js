import{a0 as e,d as a,K as t,aw as l,j as o,U as i,r as n,s,af as c,L as r,a9 as u,bN as d,Q as m,S as f,R as p,aa as y,l as b,bn as h,c as g,w as _,B as $,E as k,bO as w,o as v,g as x,i as C,f as j,t as T,a as V,F as D,N as F,n as M,ap as R,ar as U,ac as E,bP as W,_ as Y}from"./index-DE5OqlOG.js";import{_ as I}from"./uni-easyinput.Cpml7ZWU.js";import{_ as B,a as N}from"./uni-forms.DRg_j8ip.js";import{_ as O}from"./tig-copyright.abYYt2yI.js";import{_ as P,e as X}from"./tig-layout.fowSnIDi.js";import{_ as q}from"./tig-fixed-placeholder.OF5rBWLr.js";import"./uni-icons.BITEJ68A.js";const K=Y(a({__name:"index",setup(a){const{t:Y}=t(),K=l(),L=o(),Q=i({nickname:"",birthday:"",mobile:""}),S=(e,a)=>{"password"!=a||""!=Q.mobile?M({url:e}):m({title:Y("未绑定手机号，请先绑定手机号再修改密码"),icon:"none"})},z={nickname:{rules:[{required:!0,errorMessage:Y("请您填写用户昵称")}]}},A=n(),G=()=>{A.value.validate().then(()=>{J()}).catch(e=>{console.log("表单错误信息：",e)})},H=()=>{K.logout()},J=async()=>{try{await(a={...Q},e({url:"user/user/updateInformation",method:"post",data:a})),m({title:Y("修改成功"),icon:"none",duration:1e3}),setTimeout(()=>{R({success:function(){U("refreshData")}})},1e3)}catch(t){console.error(t),m({title:t.message,icon:"none",duration:1e3})}var a};s(()=>{if(c(()=>{A.value.setRules(z),ie.value.setFormatter(oe)}),"wechat"===L.XClientType&&r("token")){const e=ae(location.href);e.code&&e.code.length>12&&Z(e.code)}});const Z=async e=>{u({title:Y("授权中")+"..."});try{await d({code:e}),m({title:Y("授权成功"),icon:"none",duration:1e3});let a="/pages/user/profile/index";te.value&&(a=`/pages/order/check?flowType=${te.value}`),setTimeout(()=>{f({url:a,mode:"redirectTo",success:()=>{te.value&&p("bindWechatFlowType")}})},1e3)}catch(a){m({title:a.message,icon:"none",duration:1e3})}finally{y()}},ee=async()=>{E({title:Y("提示"),content:Y("确定取消绑定吗？"),success:async e=>{if(e.confirm){u({title:Y("正在解绑...")});try{await W(),y(),m({title:Y("解绑成功"),icon:"none",duration:1e3}),setTimeout(()=>{le()},500)}catch(a){console.error(a),m({title:a.message,icon:"none",duration:1e3})}finally{y()}}}})},ae=e=>{const a={},t=e.split("?")[1];return t&&t.split("&").forEach(e=>{const[t,l]=e.split("=");a[t]=l}),a},te=n(r("bindWechatFlowType")||null);b(async e=>{e&&e.bindWechat&&await re(),le()});const le=async()=>{u({title:Y("加载中")});try{const a=await e({url:"user/user/detail",method:"get"});let t=a.mobile;a.showMobile=t.replace(/(\d{2})\d*(\d{4})$/,"$1*****$2"),Object.assign(Q,a)}catch(a){console.error(a)}finally{y()}},oe=(e,a)=>"year"===e?`${a}${Y("年")}`:"month"===e?`${a}${Y("月")}`:"day"===e?`${a}${Y("日")}`:a,ie=n(),ne=n(!1),se=()=>{ne.value=!0},ce=e=>{e&&e.value&&(Q.birthday=uni.$u.timeFormat(e.value,"yyyy-mm-dd")),ne.value=!1},re=async()=>{const e=await h({url:location.origin+location.pathname});window.location.href=e.url};return(e,a)=>{const t=$(k("uni-easyinput"),I),l=$(k("uni-forms-item"),B),o=C,i=$(k("uni-forms"),N),n=$(k("tig-copyright"),O),s=$(k("tig-button"),X),c=$(k("tig-fixed-placeholder"),q),r=$(k("up-datetime-picker"),w),u=$(k("tig-layout"),P);return v(),g(u,{title:"个人资料","border-bottom":!0},{default:_(()=>[x(o,{class:"profile-edit-main"},{default:_(()=>[x(i,{ref_key:"formRef",ref:A,"model-value":Q,"label-width":"300rpx"},{default:_(()=>[x(o,{class:"profile-edit-content"},{default:_(()=>[x(l,{label:e.$t("用户ID"),name:"username"},{default:_(()=>[x(t,{modelValue:Q.dimUsername,"onUpdate:modelValue":a[0]||(a[0]=e=>Q.dimUsername=e),"input-border":!1,disabled:"","primary-color":"rgb(192, 196, 204)"},null,8,["modelValue"])]),_:1},8,["label"]),x(l,{label:e.$t("昵称"),name:"nickname"},{default:_(()=>[x(t,{modelValue:Q.nickname,"onUpdate:modelValue":a[1]||(a[1]=e=>Q.nickname=e),"input-border":!1,placeholder:e.$t("请输入昵称"),"primary-color":"rgb(192, 196, 204)",type:"nickname"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),x(l,{label:e.$t("出生日期"),name:"birthday"},{default:_(()=>[x(o,{class:"el-input-id",onClick:se},{default:_(()=>[j(T("0000-00-00"===Q.birthday?e.$t("请选择出生日期"):Q.birthday)+" ",1),x(o,{class:"iconfont icon-xiangyou"})]),_:1})]),_:1},8,["label"])]),_:1}),x(o,{class:"profile-edit-content"},{default:_(()=>[x(l,{label:e.$t("登录密码"),onClick:a[2]||(a[2]=e=>S("/pages/user/security/password?mobile="+Q.mobile,"password"))},{default:_(()=>[x(o,{class:"el-input-id"},{default:_(()=>[j(T(e.$t("修改"))+" ",1),x(o,{class:"iconfont icon-xiangyou"})]),_:1})]),_:1},8,["label"]),x(l,{label:e.$t("手机号码"),onClick:a[3]||(a[3]=e=>S("/pages/user/security/phone?mobile="+Q.mobile))},{default:_(()=>[x(o,{class:"el-input-id"},{default:_(()=>[j(T(Q.showMobile||e.$t("去绑定"))+" ",1),x(o,{class:"iconfont icon-xiangyou"})]),_:1})]),_:1},8,["label"]),1===D(L).openEmailRegister?(v(),g(l,{key:0,label:e.$t("邮箱")},{default:_(()=>[x(o,{class:"el-input-id",onClick:a[4]||(a[4]=e=>S("/pages/user/security/email?email="+Q.email))},{default:_(()=>[j(T(Q.email?Q.email:e.$t("去绑定"))+" ",1),x(o,{class:"iconfont icon-xiangyou"})]),_:1})]),_:1},8,["label"])):V("",!0),"wechat"==D(L).XClientType?(v(),g(l,{key:1,label:e.$t("公众号绑定")},{default:_(()=>[Q.isBindWechat?(v(),g(o,{key:0,class:"el-input-id",onClick:F(ee,["stop"])},{default:_(()=>[j(T(e.$t("解绑"))+" ",1),x(o,{class:"iconfont icon-xiangyou"})]),_:1})):(v(),g(o,{key:1,class:"el-input-id",onClick:F(re,["stop"])},{default:_(()=>[j(T(e.$t("绑定"))+" ",1),x(o,{class:"iconfont icon-xiangyou"})]),_:1}))]),_:1},8,["label"])):V("",!0)]),_:1})]),_:1},8,["model-value"])]),_:1}),x(n),x(c,{"background-color":"#fff"},{default:_(()=>[x(o,{class:"btn-box"},{default:_(()=>[x(s,{class:"btn",plain:"",onClick:H},{default:_(()=>[j(T(e.$t("退出登录")),1)]),_:1}),x(s,{class:"btn",onClick:G},{default:_(()=>[j(T(e.$t("保存修改")),1)]),_:1})]),_:1})]),_:1}),x(r,{ref_key:"datetimePickerRef",ref:ie,"cancel-text":e.$t("取消"),"confirm-text":e.$t("确定"),show:ne.value,"model-value":Date.now(),mode:"date",formatter:oe,format:"YYYY-MM-DD","confirm-color":"var(--general)","min-date":1,onCancel:a[5]||(a[5]=e=>ne.value=!1),onConfirm:ce},null,8,["cancel-text","confirm-text","show","model-value"])]),_:1})}}}),[["__scopeId","data-v-c199895e"]]);export{K as default};
