import{d as e,K as a,r as l,l as t,m as s,b3 as c,c as o,w as n,a9 as i,ar as u,Q as d,aa as m,B as r,E as f,o as p,g as _,i as g,I as k,J as y,O as v,a as b,f as h,t as x,h as C,V,M as w,br as I,F as T,ab as j,aT as $,_ as O}from"./index-DE5OqlOG.js";import{_ as P}from"./tig-image.h_tgFjnN.js";import{_ as R}from"./format-price.Cc34639m.js";import{_ as J}from"./uni-rate.BV8u_wWd.js";import{_ as S,e as A}from"./tig-layout.fowSnIDi.js";import{_ as N}from"./uni-icons.BITEJ68A.js";import{_ as U}from"./tig-upload.vue_vue_type_script_setup_true_lang.Cw9grp3Q.js";import{c as D,u as z}from"./comment.BRRH7DIc.js";const F=O(e({__name:"info",setup(e){const{t:O}=a(),F=l(""),B=l([O("送货快"),O("质量很好"),O("服务周到"),O("正品"),O("很划算"),O("包装仔细"),O("价格实惠"),O("还可以"),O("相当好")]),E=l([]),K=async e=>{i({title:O("加载中")});try{const a=await D({id:e});a.items.map(e=>{e.allCommentTag=JSON.parse(JSON.stringify(B.value)),Object.assign(e,{commentRank:0,content:"",showPics:[],commentTag:[],isAdd:!1,rankVerification:!0,contentVerification:!0,isCommentInfo:!!e.commentInfo},e.commentInfo)}),Object.assign(E.value,a.items);E.value.every(e=>1===e.isShowed)&&(history.back(),u("commentFinished",!0))}catch(a){d({title:a.message,icon:"none",duration:1e3})}finally{m()}},M=l(""),Q=(e,a)=>{let l=E.value[e].commentTag;l.includes(a)?E.value[e].commentTag=l.filter(e=>e!==a):l.push(a)};return t(e=>{if(e){const{id:a}=e;a&&(F.value=a,K(a))}}),s(()=>{c()}),(e,a)=>{const l=r(f("tig-image"),P),t=g,s=r(f("format-price"),R),c=r(f("uni-rate"),J),i=C,u=w,m=r(f("tig-button"),A),D=I,B=r(f("uni-icons"),N),q=r(f("tig-upload"),U),G=r(f("tig-layout"),S);return p(),o(G,{title:"订单评价"},{default:n(()=>[_(t,{class:"comment-info"},{default:n(()=>[(p(!0),k(y,null,v(E.value,(r,f)=>(p(),o(t,{key:f,class:"comment-item"},{default:n(()=>[r.isShowed?b("",!0):(p(),o(t,{key:0,class:"white-card"},{default:n(()=>[_(t,{class:"product flex"},{default:n(()=>[_(t,{class:"product-img"},{default:n(()=>[_(l,{src:r.picThumb,mode:"aspectFit"},null,8,["src"])]),_:2},1024),_(t,{class:"product-info"},{default:n(()=>[_(t,{class:"product-name"},{default:n(()=>[h(x(r.productName),1)]),_:2},1024),_(t,{class:"product-price"},{default:n(()=>[_(s,{"show-text":!1,"is-bottom":!1,"price-data":r.price},null,8,["price-data"])]),_:2},1024),r.skuData&&r.skuData.length>0?(p(),o(t,{key:0,class:"sku-card"},{default:n(()=>[(p(!0),k(y,null,v(r.skuData,(e,a)=>(p(),o(t,{key:a,class:"sku-item line1"},{default:n(()=>[h(x(e.value),1)]),_:2},1024))),128))]),_:2},1024)):b("",!0)]),_:2},1024)]),_:2},1024),_(t,{class:"comment"},{default:n(()=>[_(t,{class:"flex comment-cell"},{default:n(()=>[_(t,{class:"lable-text"},{default:n(()=>[h(x(e.$t("商品评分"))+"：",1)]),_:1}),_(t,{class:"flex"},{default:n(()=>[_(c,{readonly:r.isCommentInfo,value:r.commentRank,color:"#bfbfbf","active-color":"#ffa800",size:"18",onChange:e=>((e,a)=>{E.value[e].commentRank=a.value})(f,e)},null,8,["readonly","value","onChange"]),_(i,{style:{"margin-left":"10rpx"}},{default:n(()=>[h(x(r.commentRank)+x(e.$t("分")),1)]),_:2},1024)]),_:2},1024)]),_:2},1024),r.rankVerification?b("",!0):(p(),o(t,{key:0,class:"flex comment-cell"},{default:n(()=>[_(t,{class:"lable-text"}),_(t,{class:"tips"},{default:n(()=>[h(x(e.$t("请先评分商品")),1)]),_:1})]),_:1})),_(t,{class:"comment-cell"},{default:n(()=>[r.isCommentInfo?(p(),o(t,{key:1,class:"label-list"},{default:n(()=>[(p(!0),k(y,null,v(r.commentTag,(e,a)=>(p(),o(t,{key:a,class:"label-item-txt"},{default:n(()=>[_(i,null,{default:n(()=>[h(x(e),1)]),_:2},1024)]),_:2},1024))),128))]),_:2},1024)):(p(),o(t,{key:0,class:"label-list flex-wrap"},{default:n(()=>[(p(!0),k(y,null,v(r.allCommentTag,(e,a)=>(p(),o(t,{key:a,class:V([{active:r.commentTag.includes(e)},"label-item"]),onClick:a=>Q(f,e)},{default:n(()=>[_(i,null,{default:n(()=>[h(x(e),1)]),_:2},1024)]),_:2},1032,["class","onClick"]))),128)),r.isAdd?(p(),o(t,{key:1,class:"label-edit-input flex align-center justify-between"},{default:n(()=>[_(t,null,{default:n(()=>[_(u,{modelValue:M.value,"onUpdate:modelValue":a[0]||(a[0]=e=>M.value=e),type:"text","auto-focus":"",placeholder:e.$t("请输入自定义标签")},null,8,["modelValue","placeholder"])]),_:1}),_(m,{class:"btn",onClick:e=>(e=>{if(""!==M.value){const a=JSON.parse(JSON.stringify(E.value[e].allCommentTag));if(a.includes(M.value))return void d({title:O("您已添加相同标签"),icon:"none",duration:1e3});a.push(M.value),E.value[e].allCommentTag=a,Q(e,M.value)}M.value="",E.value[e].isAdd=!1})(f)},{default:n(()=>[h(x(e.$t("确定")),1)]),_:2},1032,["onClick"])]),_:2},1024)):(p(),o(t,{key:0,class:"label-edit",onClick:e=>(e=>{E.value[e].isAdd=!E.value[e].isAdd})(f)},{default:n(()=>[_(t),_(t,null,{default:n(()=>[h(x(e.$t("自定义")),1)]),_:1})]),_:2},1032,["onClick"]))]),_:2},1024))]),_:2},1024),_(t,{class:"comment-cell"},{default:n(()=>[_(t,{class:"textarea-box"},{default:n(()=>[_(D,{modelValue:r.content,"onUpdate:modelValue":e=>r.content=e,cols:"50",name:"content",placeholder:e.$t("商品是否给力？快分享你的购买心得吧~"),rows:"5",maxlength:500,style:{border:"1px solid #d9d9d9",padding:"4px"},disabled:r.isCommentInfo},null,8,["modelValue","onUpdate:modelValue","placeholder","disabled"]),_(t,{class:"strlangth"},{default:n(()=>[h(x(e.$t("1-500字")),1)]),_:1})]),_:2},1024)]),_:2},1024),_(t,{class:"comment-cell flex align-center justify-between"},{default:n(()=>[_(t,{class:"tips"},{default:n(()=>[r.contentVerification?b("",!0):(p(),o(i,{key:0},{default:n(()=>[h(x(e.$t("请填写购买心得")),1)]),_:1}))]),_:2},1024)]),_:2},1024),_(t,{class:"comment-cell"},{default:n(()=>[_(t,{class:"lable-text"},{default:n(()=>[h(x(e.$t("添加图片")),1)]),_:1}),_(t,{class:"pic-box flex-wrap"},{default:n(()=>[(p(!0),k(y,null,v(r.showPics,(e,a)=>(p(),o(t,{key:a,class:"pic-img",style:{transition:"opacity 0.2s linear","margin-right":"10px"}},{default:n(()=>[_(l,{src:e.picThumb,onClick:a=>{return l=T(j)(e.picThumb),void $({urls:[l]});var l}},null,8,["src","onClick"]),_(t,{class:"close-icon",onClick:e=>((e,a)=>{e.showPics.splice(a,1)})(r,a)},{default:n(()=>[_(B,{type:"clear",size:"25",color:"#cccccc"})]),_:2},1032,["onClick"])]),_:2},1024))),128)),_(q,{modelValue:r.showPics,"onUpdate:modelValue":e=>r.showPics=e,count:9},{default:n(()=>[_(t,{class:"add-img"},{default:n(()=>[_(B,{type:"plusempty",size:"30",color:"#cccccc"})]),_:1})]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024),_(t,{class:"comment-cell"},{default:n(()=>[_(m,{class:"tig-button",onClick:e=>(async e=>{if(e.commentRank<1)e.rankVerification=!1;else if(""!=e.content)try{const a={productId:e.productId,orderId:e.orderId,orderItemId:e.itemId,shopId:e.shopId,commentRank:e.commentRank,commentTag:e.commentTag,content:e.content,showPics:e.showPics};await z(a),e.rankVerification=!0,e.contentVerification=!0,d({title:O("提交成功"),icon:"none",duration:1e3}),setTimeout(()=>{K(F.value)},500)}catch(a){d({title:a.message,icon:"none",duration:1e3})}else e.contentVerification=!1})(r)},{default:n(()=>[h(x(e.$t("提交评论")),1)]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024))]),_:2},1024))),128))]),_:1})]),_:1})}}}),[["__scopeId","data-v-b176935a"]]);export{F as default};
