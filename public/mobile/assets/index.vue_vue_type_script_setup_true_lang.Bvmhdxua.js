import{d as e,K as a,r as l,a5 as i,B as t,bE as u,E as r,c as p,o as s,bz as m,bA as c,L as o,aa as n,Q as d,ab as f,bB as b,af as h}from"./index-DE5OqlOG.js";const v=e({__name:"index",props:{limit:{type:Number,default:1},apiUrl:{type:String,default:"user/user/uploadImg"},modelValue:{type:[Array,Object],default:()=>[]},isValueArray:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(e,{emit:v}){const{t:y}=a(),V=e,A=v,U=l([]);i(()=>V.modelValue,e=>{if(!(U.value.length>0)&&e){if("object"==typeof e){if(Array.isArray(e)&&0===e.length)return;if(0===Object.values(e).length||!Object.values(e)[0])return}h(()=>{uni.$u.test.object(e)?U.value.push({...e,url:f(e.picUrl)}):(U.value=e.map(e=>({...e,url:f(e.picUrl)})),g.value=e)})}},{immediate:!0,deep:!0});const g=l([]),x=e=>{1===e.file.length||1===V.limit?j(e.file[0]):e.file.forEach(e=>{j(e)})},N=e=>{U.value.splice(e.index,1),V.limit>1||V.isValueArray?(g.value.splice(e.index,1),A("update:modelValue",g.value)):A("update:modelValue",{picName:"",picThumb:"",picUrl:""})},j=e=>{let a;m({url:b+"/api/"+V.apiUrl,filePath:e.url,name:"file",header:{Authorization:o("token"),Secret:c()},success:e=>{n();const{data:l}=JSON.parse(e.data);a=l.picThumb,U.value.push({url:f(a)}),V.limit>1||V.isValueArray?(g.value.push({picName:l.picName,picThumb:l.picThumb,picUrl:l.picUrl}),A("update:modelValue",g.value)):A("update:modelValue",{picName:l.picName,picThumb:l.picThumb,picUrl:l.picUrl}),d({title:y("图片上传成功")})},fail:e=>{n(),d({title:y("图片上传失败"),icon:"none"})}})};return(a,l)=>{const i=t(r("up-upload"),u);return s(),p(i,{"preview-full-image":!0,"file-list":U.value,name:"1",multiple:"","max-count":e.limit,"size-type":["original","compressed"],onAfterRead:x,onDelete:N},null,8,["file-list","max-count"])}}});export{v as _};
