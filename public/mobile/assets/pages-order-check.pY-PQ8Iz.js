import{a0 as e,d as a,c as t,o as l,i as o,w as s,g as n,I as u,f as c,t as i,J as d,n as r,_ as p,K as m,r as f,a5 as y,B as v,E as _,b as g,F as h,G as b,a as k,O as I,V as $,Q as x,k as T,H as C,h as N,N as P,j as w,U as V,b9 as A,Z as S,am as U,an as D,ba as j,bb as B,aw as z,s as L,a9 as O,S as M,aa as q,aG as E,R as F,l as W,L as J,P as R}from"./index-DE5OqlOG.js";import{_ as G}from"./format-price.Cc34639m.js";import{e as H,b as K,d as Q,_ as X}from"./tig-layout.fowSnIDi.js";import{_ as Z}from"./tig-fixed-placeholder.OF5rBWLr.js";import{g as Y}from"./address.Dw0Z0wUY.js";import{_ as ee}from"./tig-image.h_tgFjnN.js";import{a as ae}from"./activityCard.mdMMZqu3.js";import{_ as te}from"./uni-easyinput.Cpml7ZWU.js";import{_ as le,a as oe}from"./uni-forms.DRg_j8ip.js";import{g as se,a as ne}from"./invoice.xNaTKHhj.js";import{d as ue}from"./discountInfo.BS5Frnqr.js";import"./uni-icons.BITEJ68A.js";const ce=p(a({__name:"addressInfo",props:{data:{type:Object,default:()=>[]}},setup(e){const a=()=>{r({url:"/pages/address/list"})};return(r,p)=>{const m=o;return l(),t(m,{class:"address-info"},{default:s(()=>[n(m,{class:"address-content",onClick:a},{default:s(()=>[n(m,{class:"address-box"},{default:s(()=>[e.data&&Object.keys(e.data).length>0?(l(),u(d,{key:0},[n(m,{class:"user-info"},{default:s(()=>[n(m,{class:"name"},{default:s(()=>[c(i(e.data.consignee+" "+e.data.mobile),1)]),_:1})]),_:1}),n(m,{class:"address"},{default:s(()=>[c(i(e.data.regionName)+" "+i(e.data.address),1)]),_:1})],64)):(l(),t(m,{key:1,class:"user-info"},{default:s(()=>[n(m,{class:"name"},{default:s(()=>[c("请选择收货地址")]),_:1})]),_:1}))]),_:1}),n(m,{class:"iconfont icon-jiantou arrow_ico"})]),_:1})]),_:1})}}}),[["__scopeId","data-v-edff46dc"]]),ie=p(a({__name:"paymentMode",props:{availablePaymentType:{},payTypeId:{}},emits:["update:payTypeId","change"],setup(e,{emit:a}){const{t:r}=m(),p=e,T=a,C=f([]),N=f(""),P=()=>{C.value=JSON.parse(JSON.stringify(p.availablePaymentType)),w.value=!0;const e=p.availablePaymentType.findIndex(e=>e.typeId===p.payTypeId);e>=0&&(V.value=e)};y(()=>C,()=>{const e=C.value.filter(e=>e.disabled);e[0]&&e[0].typeId===p.payTypeId&&(T("update:payTypeId",0),V.value=null,N.value=e[0].disabledDesc,x({title:e[0].disabledDesc,duration:1500,icon:"none"}))});const w=f(!1),V=f(null),A=(e,a)=>null!==V.value&&void 0!==V.value&&V.value>=0?V.value===e:a===p.payTypeId,S=()=>{null!==V.value&&V.value>=0?(N.value=C.value[V.value].typeName,T("update:payTypeId",C.value[V.value].typeId),T("change"),w.value=!1):x({title:r("请选择付款方式"),duration:1500,icon:"none"})};return(e,a)=>{const r=o,m=g,f=v(_("tig-button"),H),y=v(_("tig-fixed-placeholder"),Z),x=v(_("tig-popup"),K);return l(),t(r,null,{default:s(()=>[n(r,{class:"payment"},{default:s(()=>[n(r,{class:"payment-title"},{default:s(()=>[c(i(e.$t("支付方式")),1)]),_:1}),n(r,{class:"payment-content",onClick:P},{default:s(()=>[n(r,{class:"payment-text"},{default:s(()=>[c(i(N.value?N.value:p.availablePaymentType[0].typeName),1)]),_:1}),n(m,{"lazy-load":"",class:"more-ico",src:h(b)("common/more.png")},null,8,["src"])]),_:1})]),_:1}),n(x,{show:w.value,"onUpdate:show":a[0]||(a[0]=e=>w.value=e)},{default:s(()=>[n(r,{class:"payment-popup"},{default:s(()=>[n(r,{class:"popup-title title"},{default:s(()=>[c(i(e.$t("选择支付方式")),1)]),_:1}),n(r,{class:"payment-btn"},{default:s(()=>[(l(!0),u(d,null,I(C.value,(e,a)=>(l(),u(d,{key:e.typeId},[e.isShow?(l(),t(r,{key:0,class:$(["payment-btn-item",{active:A(a,e.typeId),disabled:e.disabled}]),onClick:t=>((e,a)=>{a||(V.value=e)})(a,e.disabled)},{default:s(()=>[c(i(null==e?void 0:e.typeName),1)]),_:2},1032,["class","onClick"])):k("",!0)],64))),128))]),_:1}),null!==V.value?(l(),t(r,{key:0,class:"payment-desc"},{default:s(()=>[n(r,{class:"payment-desc-title"},{default:s(()=>{var e;return[c(i(null==(e=C.value[V.value])?void 0:e.typeName),1)]}),_:1}),n(r,{class:"payment-desc-text"},{default:s(()=>{var a;return[c(i("在线支付"===(null==(a=C.value[V.value])?void 0:a.typeName)?e.$t("支持微信即时到账（绝大数银行借记卡及部分银行信用卡）"):e.$t("支持银行和企业账户汇款")),1)]}),_:1})]),_:1})):k("",!0),n(y,{"background-color":"#fff"},{default:s(()=>[n(r,{class:"btn-box"},{default:s(()=>[n(f,{onClick:S},{default:s(()=>[c(i(e.$t("提交")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["show"])]),_:1})}}}),[["__scopeId","data-v-2505edb5"]]),de=p(a({__name:"storeCard",props:{cartList:{},shippingTypeList:{},shippingType:{}},emits:["update:shippingType","change","changeProductExtra"],setup(e,{emit:a}){const{t:p}=m(),y=e,g=a,h=f(!1),b=f(0),w=T(()=>y.shippingTypeList&&y.shippingTypeList[b.value]&&y.shippingTypeList[b.value][V.value]?y.shippingTypeList[b.value][V.value]:null),V=f(0),A=f(),S=()=>{const e=JSON.parse(JSON.stringify(y.shippingType)),{shippingTypeId:a,shippingTypeName:t}=y.shippingTypeList[b.value][V.value];e[b.value].shopId=b.value,e[b.value].typeId=a,e[b.value].typeName=t,g("update:shippingType",e),g("change"),h.value=!1},U=e=>e.filter(e=>1===e.type||6===e.type),D=f(!1),j=f({}),B=f([]),z=()=>{g("changeProductExtra",{cartId:j.value.cartId,extraAttrIds:B.value.filter(e=>!!e).join(",")}),D.value=!1};return(e,a)=>{const m=o,f=v(_("tig-image"),ee),g=v(_("format-price"),G),T=N,L=v(_("tig-button"),H),O=v(_("tig-fixed-placeholder"),Z),M=v(_("tig-popup"),K);return l(),u(d,null,[(l(!0),u(d,null,I(e.cartList,(a,o)=>(l(),t(m,{key:o,class:"store-card"},{default:s(()=>[n(m,{class:"store-card-item"},{default:s(()=>[n(m,{class:"store-card-item-title"},{default:s(()=>[0===a.shopId?(l(),t(m,{key:0,class:"store-card-item-label"},{default:s(()=>[c(i(e.$t("自营")),1)]),_:1})):k("",!0),n(m,{class:"store-card-item-name"},{default:s(()=>[c(i(0===a.shopId?e.$t("自营"):a.shopTitle),1)]),_:2},1024)]),_:2},1024),(l(!0),u(d,null,I(a.carts,(a,o)=>(l(),u(d,{key:o},[n(m,{class:"store-card-item-content"},{default:s(()=>[n(m,{class:"content-item",onClick:e=>{return t="/pages/product/index?id=",void(0!==(l=a.productId)&&r({url:t+l}));var t,l}},{default:s(()=>[n(m,{class:"store-card-item-content-left"},{default:s(()=>[n(f,{class:"store-card-item-img",src:a.picThumb},null,8,["src"])]),_:2},1024),n(m,{class:"store-card-item-content-right"},{default:s(()=>{return[n(m,{class:"store-card-item-content-right-title line2"},{default:s(()=>[c(i(a.productName),1)]),_:2},1024),a.skuData.length>0?(l(),t(m,{key:0,class:"sku-card"},{default:s(()=>[(l(!0),u(d,null,I(a.skuData,(e,a)=>(l(),t(m,{key:a,class:"sku-item"},{default:s(()=>[c(i(e.value),1)]),_:2},1024))),128))]),_:2},1024)):k("",!0),a.activityInfo&&U(a.activityInfo).length>0?(l(),t(m,{key:1,class:"activity-box"},{default:s(()=>[(l(!0),u(d,null,I(U(a.activityInfo),(e,a)=>(l(),t(ae,{key:a,"font-size":"22rpx","activity-info":e,"card-type":"sub"},null,8,["activity-info"]))),128))]),_:2},1024)):k("",!0),n(m,{class:"right-price-box",style:C({marginTop:(e=a,(e.skuData.length>0&&e.activityInfo&&U(e.activityInfo).length>0?0:0!==e.skuData.length||e.activityInfo&&0!==U(e.activityInfo).length?10:55)+"rpx")})},{default:s(()=>[n(m,{class:"store-card-item-content-right-price"},{default:s(()=>[n(g,{"font-style":{fontWeight:"bold"},"decimals-style":{fontSize:"20rpx",fontWeight:"bold"},"currency-style":{fontSize:"20rpx",fontWeight:"bold"},"price-data":a.price},null,8,["price-data"]),a.originPrice&&a.originPrice!==a.price?(l(),t(g,{key:0,"font-style":{fontWeight:"400",textDecoration:"line-through",fontSize:"19rpx",color:"#969799",position:"relative",bottom:"-2px",left:"5px"},"is-bottom":!1,"price-data":a.originPrice},null,8,["price-data"])):k("",!0)]),_:2},1024),n(m,{class:"store-card-item-content-right-num"},{default:s(()=>[c(" x"+i(a.quantity),1)]),_:2},1024)]),_:2},1032,["style"])];var e}),_:2},1024)]),_:2},1032,["onClick"])]),_:2},1024),a.extraSkuAllData&&a.extraSkuAllData.extra&&a.extraSkuAllData.extra.length?(l(),t(m,{key:0,class:"attr-box",onClick:e=>(e=>{j.value=e,B.value=e.extraSkuData.length?e.extraSkuData.map(e=>e.attributesId):[],D.value=!0})(a)},{default:s(()=>[n(m,{class:"attr-label"},{default:s(()=>[c("附加")]),_:1}),a.extraSkuData&&a.extraSkuData.length?(l(),t(m,{key:0,class:"attr-list"},{default:s(()=>[(l(!0),u(d,null,I(a.extraSkuData,(e,o)=>(l(),t(m,{key:o,class:"attr-item"},{default:s(()=>[n(m,{class:"item-content"},{default:s(()=>[n(T,{class:"line1 content-text"},{default:s(()=>[c(i(e.attrValue),1)]),_:2},1024),n(m,{class:"right"},{default:s(()=>[n(g,{class:"price","price-data":e.attrPrice},null,8,["price-data"]),n(m,{class:"num"},{default:s(()=>[c("x"+i(a.quantity),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:2},1024)):(l(),t(m,{key:1},{default:s(()=>[c(i(e.$t("可选附加规格")),1)]),_:1})),n(T,{class:"iconfont-h5 icon-xiajiantou1-copy"})]),_:2},1032,["onClick"])):k("",!0)],64))),128)),a.gift&&a.gift.length>0?(l(),t(m,{key:0,class:"gift-box"},{default:s(()=>[n(m,{class:"gift-title"},{default:s(()=>[c(i(e.$t("赠品")),1)]),_:1}),n(m,{class:"gift-content"},{default:s(()=>[(l(!0),u(d,null,I(a.gift,(e,a)=>(l(),t(m,{key:a,class:"gift-content-item"},{default:s(()=>[n(m,{class:"gift-item-left"},{default:s(()=>[n(f,{src:e.picThumb,class:"gift-img"},null,8,["src"])]),_:2},1024),n(m,{class:"gift-item-right"},{default:s(()=>[n(m,{class:"gift-item-name line1"},{default:s(()=>[c(i(e.productName),1)]),_:2},1024),e.skuData.length>0?(l(),t(m,{key:0,class:"sku-card"},{default:s(()=>[(l(!0),u(d,null,I(e.skuData,(e,a)=>(l(),t(m,{key:a,class:"sku-item"},{default:s(()=>[c(i(e.value),1)]),_:2},1024))),128))]),_:2},1024)):k("",!0),n(m,{class:"gift-item-num"},{default:s(()=>[c("x"+i(e.num),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:2},1024)]),_:2},1024)):k("",!0),n(m,{class:"payment"},{default:s(()=>[n(m,{class:"payment-title"},{default:s(()=>[c(i(e.$t("配送方式")),1)]),_:1}),n(m,{class:"payment-content",onClick:e=>{return t=a.shopId,1===a.noShipping?x({title:p("无需配送"),duration:1500,icon:"none"}):y.shippingTypeList[t]&&0!==y.shippingTypeList[t].length?void 0:x({title:p("该收货地址不支持配送"),duration:1500,icon:"none"});var t}},{default:s(()=>[n(m,{class:"payment-text"},{default:s(()=>{return[c(i((e=a.shopId,t=a.noShipping,1===t?p("无需配送"):y.shippingType&&y.shippingType[e]&&y.shippingType[e].typeName||p("该收货地址不支持配送"))),1)];var e,t}),_:2},1024)]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128)),n(M,{show:h.value,"onUpdate:show":a[0]||(a[0]=e=>h.value=e)},{default:s(()=>[n(m,{class:"payment-popup"},{default:s(()=>[n(m,{class:"popup-title title"},{default:s(()=>[c(i(e.$t("选择配送方式")),1)]),_:1}),n(m,{class:"payment-btn"},{default:s(()=>[(l(!0),u(d,null,I(e.shippingTypeList[b.value],(a,o)=>{return l(),t(m,{key:o,class:$(["payment-btn-item",{active:(n=a.shippingTypeId,A.value?A.value===n:(null==(u=y.shippingType[b.value])?void 0:u.typeId)===n)}]),onClick:e=>((e,a)=>{V.value=e,A.value=a})(o,a.shippingTypeId)},{default:s(()=>[c(i(e.$t(null==a?void 0:a.shippingTypeName)),1)]),_:2},1032,["class","onClick"]);var n,u}),128))]),_:1}),n(m,{class:"payment-desc"},{default:s(()=>[n(m,{class:"payment-desc-title"},{default:s(()=>{var a;return[c(i(e.$t((null==(a=w.value)?void 0:a.shippingTypeName)||"")),1)]}),_:1}),n(m,{class:"payment-desc-text"},{default:s(()=>{var a;return[c(i(e.$t((null==(a=w.value)?void 0:a.shippingTimeDesc)||"")),1)]}),_:1})]),_:1}),n(O,{"background-color":"#fff"},{default:s(()=>[n(m,{class:"btn-box"},{default:s(()=>[n(L,{onClick:S},{default:s(()=>[c(i(e.$t("提交")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["show"]),n(M,{show:D.value,"onUpdate:show":a[1]||(a[1]=e=>D.value=e)},{default:s(()=>[n(m,{class:"attribute"},{default:s(()=>[n(m,{class:"popup-title title"},{default:s(()=>[c(i(e.$t("附加")),1)]),_:1}),n(m,{class:"attribute-list"},{default:s(()=>{var e;return[(l(!0),u(d,null,I(null==(e=j.value.extraSkuAllData)?void 0:e.extra,(e,a)=>(l(),t(m,{key:a,class:"attribute-item"},{default:s(()=>[n(m,{class:"item-title"},{default:s(()=>[c(i(e.attrName),1)]),_:2},1024),n(m,{class:"item-content"},{default:s(()=>[(l(!0),u(d,null,I(e.attrList,e=>(l(),t(m,{key:e.attributesId,class:"item-attr-box"},{default:s(()=>[n(m,{class:$(["item-attr",{checked:B.value[a]===e.attributesId}]),onClick:P(t=>((e,a)=>{B.value[e]&&B.value[e]===a?B.value[e]=null:B.value[e]=a})(a,e.attributesId),["stop"])},{default:s(()=>[n(m,{class:"label"},{default:s(()=>[c(i(e.attrValue),1)]),_:2},1024),n(m,{class:"line-box"}),n(g,{class:"value","price-data":e.attrPrice},null,8,["price-data"])]),_:2},1032,["class","onClick"])]),_:2},1024))),128))]),_:2},1024)]),_:2},1024))),128))]}),_:1}),n(O,{"background-color":"#fff"},{default:s(()=>[n(m,{class:"attribute-btn"},{default:s(()=>[n(m,{class:"desc"},{default:s(()=>[c(i(`已选择${B.value.length}种`),1)]),_:1}),n(m,{class:""},{default:s(()=>[n(L,{style:{width:"400rpx",height:"80rpx"},onClick:z},{default:s(()=>[c(i(e.$t("确定")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["show"])],64)}}}),[["__scopeId","data-v-647ca7ed"]]),re=p(a({__name:"couponInfo",props:{couponList:{},useCouponIds:{},selectUserCouponIds:{},couponAmount:{},balance:{},points:{},availablePoints:{},pointsAmount:{},usePoint:{},flowType:{}},emits:["update:useCouponIds","sendBalanceStatus","change","update:usePoint","update:selectUserCouponIds"],setup(e,{expose:a,emit:p}){const{t:T}=m(),C=w(),{currency:P}=(()=>{const e=w(),a=f(""),t=f("");return a.value=e.dollarSign,t.value=e.dollarSignCn,{currency:a,currencyName:t}})(),U=e,D=p,j=f([]),B=f({enableCoupons:[],disableCoupons:[]});y(()=>B,e=>{j.value=e.value.enableCoupons.filter(e=>e.selected)},{deep:!0,immediate:!0});const z=f(!1),L=f(!1),O=f("可用优惠券"),M=e=>{O.value=e},q=()=>{B.value=JSON.parse(JSON.stringify(U.couponList)),z.value=!0},E=e=>{if(j.value.findIndex(a=>a.shopId===e.shopId)>-1)W(e.shopId),R(e.shopId,e.userCouponId,!1);else{j.value.findIndex(a=>a.id===e.id)>-1?(J(e.id),X(e.id,e.userCouponId,!1)):j.value.push(e),j.value.push(e)}},F=e=>{j.value=j.value.filter(({id:a})=>a!==e.id)},W=e=>{j.value=j.value.filter(a=>a.shopId!==e)},J=e=>{j.value=j.value.filter(a=>a.id!==e)},R=(e,a,t)=>{B.value.enableCoupons.forEach(l=>{l.shopId===e&&l.userCouponId!==a&&(l.selected=t)})},X=(e,a,t)=>{B.value.enableCoupons.forEach(l=>{l.id===e&&l.userCouponId!==a&&(l.selected=t)})},Y=()=>{let e=[],a=[];j.value.length>0&&(e=j.value.map(({id:e})=>e),a=j.value.map(({userCouponId:e})=>e)),D("update:useCouponIds",e),D("update:selectUserCouponIds",a),D("change"),z.value=!1},ee=f(!1),ae=V({usePoints:0}),se=f(),ne={usePoints:{rules:[{required:!0,errorMessage:T(`请输入${C.integralName}`)},{validateFunction:function(e,a,t,l){return a>U.availablePoints&&l(T(`${C.integralName}不能大于可用${C.integralName}`)),a<0&&l(T(`${C.integralName}不能小于0`)),!0}}]}};y(ee,e=>{e&&setTimeout(()=>{se.value.setRules(ne)},1e3)});const ue=()=>{if(0===U.points&&0===U.pointsAmount)return x({title:T(`暂无可用${C.integralName}`),duration:1500,icon:"none"});ee.value=!0,ae.usePoints=U.usePoint},ce=()=>{se.value.validate().then(e=>{ae.usePoints||(ae.usePoints=0),D("update:usePoint",Number(ae.usePoints)),D("change"),ee.value=!1}).catch(e=>{console.log("表单错误信息：",e)})},ie=()=>{L.value=!L.value,D("sendBalanceStatus",L.value)},de=()=>{r({url:"/pages/user/account/index"})};return a({isBalance:L}),(e,a)=>{const r=o,p=g,m=N,f=A,y=v(_("format-price"),G),x=v(_("tig-checkbox"),Q),T=v(_("tig-button"),H),w=v(_("tig-fixed-placeholder"),Z),V=S,U=v(_("tig-popup"),K),D=v(_("uni-easyinput"),te),j=v(_("uni-forms-item"),le),W=v(_("uni-forms"),oe);return l(),u(d,null,[n(r,{class:"coupon-info"},{default:s(()=>[3!=e.flowType?(l(),u(d,{key:0},[1==h(C).useCoupon?(l(),t(r,{key:0,class:"coupon"},{default:s(()=>[n(r,{class:"coupon-title"},{default:s(()=>[c(i(e.$t("优惠券")),1)]),_:1}),n(r,{class:"coupon-content",onClick:q},{default:s(()=>[n(r,{class:"coupon-text"},{default:s(()=>[c(i(e.$t("优惠")+h(P)+e.couponAmount),1)]),_:1}),n(p,{"lazy-load":"",class:"more-ico",src:h(b)("common/more.png")},null,8,["src"])]),_:1})]),_:1})):k("",!0),1==h(C).usePoints?(l(),t(r,{key:1,class:"points"},{default:s(()=>[n(r,{class:"points-title"},{default:s(()=>[c(i(e.$t(h(C).integralName))+" ",1),n(r,{class:"points-text"},{default:s(()=>[c(i(e.$t(`当前账户${h(C).integralName}`))+"：",1),n(m,{class:"special-text"},{default:s(()=>[c(i(e.points),1)]),_:1})]),_:1})]),_:1}),n(r,{class:"points-content",onClick:ue},{default:s(()=>[e.pointsAmount>0?(l(),t(r,{key:0,class:"points-text"},{default:s(()=>[c(i(e.$t("共抵扣："))+i(h(P)+e.pointsAmount),1)]),_:1})):0===e.points&&0===e.pointsAmount?(l(),t(r,{key:1,class:"points-text"},{default:s(()=>[c(i(e.$t(`暂无可用${h(C).integralName}`)),1)]),_:1})):(l(),t(r,{key:2,class:"points-text"},{default:s(()=>[c(i(`最多可用${e.availablePoints}${h(C).integralName}`),1)]),_:1})),n(p,{"lazy-load":"",class:"more-ico",src:h(b)("common/more.png")},null,8,["src"])]),_:1})]),_:1})):k("",!0)],64)):k("",!0),1==h(C).useSurplus?(l(),t(r,{key:1,class:"balance"},{default:s(()=>[n(r,{class:"balance-title",onClick:de},{default:s(()=>[c(i(e.$t("余额"))+" ",1),n(r,{class:"balance-text"},{default:s(()=>[c(i(e.$t("当前账户余额"))+"：",1),n(m,{class:"special-text"},{default:s(()=>[c(i(e.balance),1)]),_:1})]),_:1})]),_:1}),n(f,{checked:L.value,color:"var(--general)",style:{transform:"scale(0.8)"},onChange:ie},null,8,["checked"])]),_:1})):k("",!0)]),_:1}),n(U,{show:z.value,"onUpdate:show":a[2]||(a[2]=e=>z.value=e),"background-color":"#fff"},{default:s(()=>[n(V,{"scroll-y":"true",class:"coupon-container"},{default:s(()=>[n(r,{class:"popup-title"},{default:s(()=>[c(i(e.$t("优惠券")),1)]),_:1}),n(r,{class:"coupon-menu"},{default:s(()=>[n(r,{class:$(["coupon-menu-item",{active:"可用优惠券"===O.value}]),onClick:a[0]||(a[0]=e=>M("可用优惠券"))},{default:s(()=>[c(i(e.$t("可用优惠券"))+"("+i(B.value.enableCoupons.length)+")",1)]),_:1},8,["class"]),n(r,{class:$(["coupon-menu-item",{active:"不可用优惠券"===O.value}]),onClick:a[1]||(a[1]=e=>M("不可用优惠券"))},{default:s(()=>[c(i(e.$t("不可用优惠券"))+"("+i(B.value.disableCoupons.length)+")",1)]),_:1},8,["class"])]),_:1}),n(r,{class:"coupon-container-content"},{default:s(()=>["可用优惠券"===O.value?(l(),u(d,{key:0},[n(r,{class:"coupon-box"},{default:s(()=>[(l(!0),u(d,null,I(B.value.enableCoupons,(a,o)=>(l(),t(r,{key:o,class:"coupon-item",onClick:e=>(e=>{e.selected=!e.selected,e.selected?E(e):F(e)})(a)},{default:s(()=>[n(r,{class:"coupon-click-area"}),n(r,{class:"left"},{default:s(()=>[n(r,{class:"col-1"},{default:s(()=>[n(r,{class:"title"},{default:s(()=>[c(i(a.couponName),1)]),_:2},1024)]),_:2},1024),a.couponDesc?(l(),t(r,{key:0,class:"col-2"},{default:s(()=>[c(i(a.couponDesc),1)]),_:2},1024)):k("",!0),n(r,{class:$(["col-3",{"special-col":!a.couponDesc}])},{default:s(()=>[c(i(e.$t("有效期："))+i(a.endDate),1)]),_:2},1032,["class"])]),_:2},1024),n(r,{class:"right"},{default:s(()=>[n(r,{class:"right-1"},{default:s(()=>[2===a.couponType?(l(),u(d,{key:0},[n(r,{class:"zhekou"},{default:s(()=>[c(i(a.couponDiscount),1)]),_:2},1024),n(r,{class:"zhe"},{default:s(()=>[c(i(e.$t("折")),1)]),_:1})],64)):(l(),t(y,{key:1,"font-style":{fontSize:"48rpx",lineHeight:1},"currency-style":{selfAlign:"end",fontSize:"24rpx"},"price-data":a.couponMoney},null,8,["price-data"]))]),_:2},1024),n(r,{class:"right-2"},{default:s(()=>[n(x,{checked:a.selected},null,8,["checked"])]),_:2},1024)]),_:2},1024),n(r,{class:"dotted-line"})]),_:2},1032,["onClick"]))),128))]),_:1}),0===B.value.enableCoupons.length?(l(),t(r,{key:0,class:"coupon-empty"},{default:s(()=>[c(i(e.$t("暂无优惠券")),1)]),_:1})):k("",!0)],64)):k("",!0),"不可用优惠券"===O.value?(l(),u(d,{key:1},[n(r,{class:"coupon-box"},{default:s(()=>[(l(!0),u(d,null,I(B.value.disableCoupons,(a,o)=>(l(),t(r,{key:o,class:"coupon-item grayScaleDiv"},{default:s(()=>[n(r,{class:"left"},{default:s(()=>[n(r,{class:"col-1"},{default:s(()=>[n(r,{class:"title"},{default:s(()=>[c(i(a.couponName),1)]),_:2},1024)]),_:2},1024),a.disableReason?(l(),t(r,{key:0,class:"col-2"},{default:s(()=>[c(i(a.disableReason),1)]),_:2},1024)):k("",!0),n(r,{class:$(["col-3",{"special-col":!a.couponDesc}])},{default:s(()=>[c(i(e.$t("有效期："))+i(a.endDate),1)]),_:2},1032,["class"])]),_:2},1024),n(r,{class:"right"},{default:s(()=>[n(r,{class:"right-1"},{default:s(()=>[2===a.couponType?(l(),u(d,{key:0},[n(r,{class:"zhekou"},{default:s(()=>[c(i(a.couponDiscount),1)]),_:2},1024),n(r,{class:"zhe"},{default:s(()=>[c(i(e.$t("折")),1)]),_:1})],64)):(l(),t(y,{key:1,"font-style":{fontSize:"48rpx",lineHeight:1},"currency-style":{selfAlign:"end",fontSize:"24rpx"},"price-data":a.couponMoney},null,8,["price-data"]))]),_:2},1024),n(r,{class:"right-2"},{default:s(()=>[n(x,{checked:a.selected,"onUpdate:checked":e=>a.selected=e,disabled:!0},null,8,["checked","onUpdate:checked"])]),_:2},1024)]),_:2},1024),n(r,{class:"dotted-line"})]),_:2},1024))),128))]),_:1}),0===B.value.disableCoupons.length?(l(),t(r,{key:0,class:"coupon-empty"},{default:s(()=>[c(i(e.$t("暂无优惠券")),1)]),_:1})):k("",!0)],64)):k("",!0)]),_:1}),n(w,{"background-color":"#fff"},{default:s(()=>[n(r,{class:"btn-box"},{default:s(()=>[n(T,{onClick:Y},{default:s(()=>[c(i(e.$t("确定")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["show"]),n(U,{show:ee.value,"onUpdate:show":a[4]||(a[4]=e=>ee.value=e),"background-color":"#f5f5f5"},{default:s(()=>[n(r,{class:"points-popup"},{default:s(()=>[n(r,{class:"popup-title"},{default:s(()=>[c(i(e.$t(h(C).integralName)),1)]),_:1}),n(r,{class:"form-usePoints"},{default:s(()=>[n(W,{ref_key:"pointsForm",ref:se,"model-value":ae},{default:s(()=>[n(j,{"label-width":"80",label:e.$t(`使用${h(C).integralName}`),name:"usePoints"},{default:s(()=>[n(D,{modelValue:ae.usePoints,"onUpdate:modelValue":a[3]||(a[3]=e=>ae.usePoints=e),"primary-color":"rgb(192, 196, 204)","input-border":!1,type:"number",placeholder:e.$t(`请输入${h(C).integralName}`)},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1},8,["model-value"])]),_:1}),n(w,{"background-color":"#fff"},{default:s(()=>[n(r,{class:"btn-box"},{default:s(()=>[n(T,{onClick:ce},{default:s(()=>[c(i(e.$t("确定")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["show"])],64)}}}),[["__scopeId","data-v-480c30d5"]]),pe=p(a({__name:"invoiceInfo",props:{getAddressInfo:{type:Object,default:()=>{}},invoiceInfo:{type:Object,default:()=>{}}},emits:["update:invoiceInfo","change"],setup(e,{emit:a}){const{t:p}=m(),I=w(),x=e,C=a,P=T(()=>{switch(x.invoiceInfo.invoiceType){case 1:return"普通发票";case 2:return"增值税专用发票";default:return"不开发票"}}),A={companyCode:{rules:[{required:!0,errorMessage:p("纳税人识号不能为空!")}]},companyAddress:{rules:[{required:!0,errorMessage:p("单位地址不能为空!")}]},companyPhone:{rules:[{required:!0,errorMessage:p("单位电话不能为空!")}]},companyBank:{rules:[{required:!0,errorMessage:p("开户银行不能为空!")}]},companyAccount:{rules:[{required:!0,errorMessage:p("银行账户不能为空!")}]},mobile:{rules:[{required:!0,errorMessage:p("手机不能为空!")}]}},j=()=>{z(),q()},B=V({titleType:1,invoiceType:1,companyName:"",mobile:"",email:"",companyCode:"",companyAddress:"",companyPhone:"",companyBank:"",companyAccount:""}),z=()=>{B.companyName="",B.mobile="",B.email="",B.companyCode="",B.companyAddress="",B.companyPhone="",B.companyBank="",B.companyAccount=""},L=f(!1),O=f(!1),M=async()=>{try{const e=await ne();e&&Object.keys(e).length>0?(L.value=!0,2===B.invoiceType&&(B.companyCode=e.companyCode,B.companyAddress=e.companyAddress,B.companyPhone=e.companyPhone,B.companyBank=e.companyBank,B.companyAccount=e.companyAccount)):L.value=!1}catch(e){console.error(e)}},q=async()=>{try{const e=await se({invoiceType:B.invoiceType,titleType:B.titleType});e?(1===B.invoiceType&&1===B.titleType?(B.companyName=e.companyName,B.mobile=e.mobile,B.email=e.email):(B.companyCode=e.companyCode,B.companyName=e.companyName,B.companyAddress=e.companyAddress,B.companyPhone=e.companyPhone,B.companyBank=e.companyBank,B.companyAccount=e.companyAccount),B.mobile=e.mobile,B.email=e.email):1===B.titleType&&(B.companyName=x.getAddressInfo.consignee,B.mobile=x.getAddressInfo.mobile,B.email=x.getAddressInfo.email)}catch(e){console.error(e)}};y(O,e=>{var a;e&&(M(),0==(null==(a=Object.keys(x.invoiceInfo))?void 0:a.length)&&q())});const E=()=>{O.value=!0},F=e=>{B.invoiceType=e,z(),1==e?q():M()},W=f(),J=()=>{O.value=!1,C("update:invoiceInfo",{})},R=()=>{W.value.validate().then(()=>{C("update:invoiceInfo",B),O.value=!1}).catch(e=>{console.log("表单错误信息：",e)})},G=()=>{r({url:"/pages/user/invoiceManagement/index?type=invoice"})};return(e,a)=>{const r=o,p=g,m=N,f=v(_("up-radio"),U),y=v(_("up-radio-group"),D),x=v(_("uni-forms-item"),le),T=v(_("uni-easyinput"),te),C=v(_("uni-forms"),oe),w=v(_("tig-button"),H),V=v(_("tig-fixed-placeholder"),Z),z=S,M=v(_("tig-popup"),K);return l(),t(r,{class:"invoice-info"},{default:s(()=>[n(r,{class:"invoice"},{default:s(()=>[n(r,{class:"invoice-title"},{default:s(()=>[c(i(e.$t("发票")),1)]),_:1}),n(r,{class:"invoice-content",onClick:E},{default:s(()=>[n(r,{class:"invoice-text"},{default:s(()=>[c(i(e.$t(P.value||"")),1)]),_:1}),n(p,{"lazy-load":"",class:"more-ico",src:h(b)("common/more.png")},null,8,["src"])]),_:1})]),_:1}),n(M,{show:O.value,"onUpdate:show":a[14]||(a[14]=e=>O.value=e)},{default:s(()=>[n(z,{"scroll-y":"true",class:"invoice-popup-content"},{default:s(()=>[n(r,{class:"invoice-popup-box"},{default:s(()=>[n(r,{class:"popup-title title"},{default:s(()=>[c(i(e.$t("发票")),1)]),_:1}),n(r,{class:"invoice-typemenu"},{default:s(()=>[n(r,{class:$(["invoice-typemenu-item",{active:1===B.invoiceType}]),onClick:a[0]||(a[0]=e=>F(1))},{default:s(()=>[c("普通发票")]),_:1},8,["class"]),1==h(I).invoiceAdded?(l(),t(r,{key:0,class:$(["invoice-typemenu-item",{active:2===B.invoiceType}]),onClick:a[1]||(a[1]=e=>F(2))},{default:s(()=>[c("增值税专用发票")]),_:1},8,["class"])):k("",!0),n(r,{class:"invoice-explain"},{default:s(()=>[c(" 我公司依法开具发票，请您按照税法规定使用发票。根据现行税收政策，部分公司提供数电票, 数电（专用发票）法律效力与现有增值税专用发票相同;如商品由第三方卖家销售，发票类型和内容将由该卖家决定，发票由卖家开具并提供。如您为企业采购，需要多单合并开具或批量提交发票可注册企业用户；"),n(m,{class:"special-text"},{default:s(()=>[c("使用礼品卡支付部分的金额，不支持开发票")]),_:1})]),_:1})]),_:1}),n(r,{class:"invoice-formState"},{default:s(()=>[n(C,{ref_key:"formRef",ref:W,"model-value":B,rules:A,"label-width":"170rpx"},{default:s(()=>[1===B.invoiceType?(l(),u(d,{key:0},[n(x,{label:e.$t("发票抬头"),name:"name"},{default:s(()=>[n(r,{class:"item-layout",onChange:j},{default:s(()=>[n(y,{modelValue:B.titleType,"onUpdate:modelValue":a[2]||(a[2]=e=>B.titleType=e),placement:"row"},{default:s(()=>[n(f,{"custom-style":{marginRight:"22rpx"},name:1,"active-color":"var(--general)",label:e.$t("个人")},null,8,["label"]),n(f,{name:2,"active-color":"var(--general)",label:e.$t("企业")},null,8,["label"])]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["label"]),1==B.titleType?(l(),t(x,{key:0,label:e.$t("个人名称"),name:"companyName",rules:[{required:!0,errorMessage:e.$t("个人名称不能为空")}]},{default:s(()=>[n(T,{modelValue:B.companyName,"onUpdate:modelValue":a[3]||(a[3]=e=>B.companyName=e),"primary-color":"rgb(192, 196, 204)","input-border":!1,placeholder:e.$t("请输入个人名称")},null,8,["modelValue","placeholder"])]),_:1},8,["label","rules"])):(l(),u(d,{key:1},[n(x,{label:e.$t("企业名称"),name:"companyName",rules:[{required:!0,errorMessage:e.$t("企业名称不能为空")}]},{default:s(()=>[n(T,{modelValue:B.companyName,"onUpdate:modelValue":a[4]||(a[4]=e=>B.companyName=e),"primary-color":"rgb(192, 196, 204)","input-border":!1,placeholder:e.$t("请输入企业名称")},null,8,["modelValue","placeholder"])]),_:1},8,["label","rules"]),n(x,{label:e.$t("纳税人识号"),name:"companyCode"},{default:s(()=>[n(T,{modelValue:B.companyCode,"onUpdate:modelValue":a[5]||(a[5]=e=>B.companyCode=e),"primary-color":"rgb(192, 196, 204)","input-border":!1,placeholder:e.$t("请输入纳税人识号")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),n(x,{label:e.$t("单位地址"),name:"companyAddress"},{default:s(()=>[n(T,{modelValue:B.companyAddress,"onUpdate:modelValue":a[6]||(a[6]=e=>B.companyAddress=e),"primary-color":"rgb(192, 196, 204)","input-border":!1,placeholder:e.$t("请输入单位地址")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),n(x,{label:e.$t("单位电话"),name:"companyPhone"},{default:s(()=>[n(T,{modelValue:B.companyPhone,"onUpdate:modelValue":a[7]||(a[7]=e=>B.companyPhone=e),"primary-color":"rgb(192, 196, 204)","input-border":!1,placeholder:e.$t("请输入单位电话")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),n(x,{label:e.$t("开户银行"),name:"companyBank"},{default:s(()=>[n(T,{modelValue:B.companyBank,"onUpdate:modelValue":a[8]||(a[8]=e=>B.companyBank=e),"primary-color":"rgb(192, 196, 204)","input-border":!1,placeholder:e.$t("请输入开户银行")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),n(x,{label:e.$t("银行账户"),name:"companyAccount"},{default:s(()=>[n(T,{modelValue:B.companyAccount,"onUpdate:modelValue":a[9]||(a[9]=e=>B.companyAccount=e),"primary-color":"rgb(192, 196, 204)","input-border":!1,placeholder:e.$t("请输入银行账户")},null,8,["modelValue","placeholder"])]),_:1},8,["label"])],64)),n(x,{label:e.$t("收票人手机"),name:"mobile"},{default:s(()=>[n(T,{modelValue:B.mobile,"onUpdate:modelValue":a[10]||(a[10]=e=>B.mobile=e),"primary-color":"rgb(192, 196, 204)","input-border":!1,placeholder:e.$t("请输入收票人手机")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),n(x,{label:e.$t("收票人邮箱"),name:"email"},{default:s(()=>[n(T,{modelValue:B.email,"onUpdate:modelValue":a[11]||(a[11]=e=>B.email=e),"primary-color":"rgb(192, 196, 204)","input-border":!1,placeholder:e.$t("请输入收票人邮箱")},null,8,["modelValue","placeholder"])]),_:1},8,["label"])],64)):2===B.invoiceType&&L.value?(l(),u(d,{key:1},[n(r,{class:"invoiceInfo-content-item"},{default:s(()=>[n(r,{class:"item-label"},{default:s(()=>[c(i(e.$t("纳税人识号")),1)]),_:1}),n(r,{class:"item-value"},{default:s(()=>[c(i(B.companyCode),1)]),_:1})]),_:1}),n(r,{class:"invoiceInfo-content-item"},{default:s(()=>[n(r,{class:"item-label"},{default:s(()=>[c(i(e.$t("单位地址")),1)]),_:1}),n(r,{class:"item-value"},{default:s(()=>[c(i(B.companyAddress),1)]),_:1})]),_:1}),n(r,{class:"invoiceInfo-content-item"},{default:s(()=>[n(r,{class:"item-label"},{default:s(()=>[c(i(e.$t("单位电话")),1)]),_:1}),n(r,{class:"item-value"},{default:s(()=>[c(i(B.companyPhone),1)]),_:1})]),_:1}),n(r,{class:"invoiceInfo-content-item"},{default:s(()=>[n(r,{class:"item-label"},{default:s(()=>[c(i(e.$t("开户银行")),1)]),_:1}),n(r,{class:"item-value"},{default:s(()=>[c(i(B.companyBank),1)]),_:1})]),_:1}),n(r,{class:"invoiceInfo-content-item"},{default:s(()=>[n(r,{class:"item-label"},{default:s(()=>[c(i(e.$t("银行账户")),1)]),_:1}),n(r,{class:"item-value"},{default:s(()=>[c(i(B.companyAccount),1)]),_:1})]),_:1}),n(x,{label:e.$t("收票人手机"),name:"mobile"},{default:s(()=>[n(T,{modelValue:B.mobile,"onUpdate:modelValue":a[12]||(a[12]=e=>B.mobile=e),"primary-color":"rgb(192, 196, 204)","input-border":!1,placeholder:e.$t("请输入收票人手机")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),n(x,{label:e.$t("收票人邮箱"),name:"email"},{default:s(()=>[n(T,{modelValue:B.email,"onUpdate:modelValue":a[13]||(a[13]=e=>B.email=e),"primary-color":"rgb(192, 196, 204)","input-border":!1,placeholder:e.$t("请输入收票人邮箱")},null,8,["modelValue","placeholder"])]),_:1},8,["label"])],64)):(l(),t(r,{key:2,class:"notPass"},{default:s(()=>[n(r,null,{default:s(()=>[c(i(e.$t("您还未通过增票资质申请，暂时无法开具增值税专用发票"))+" ",1),n(m,{class:"notPassBtn",onClick:G},{default:s(()=>[c(i(e.$t("去申请")),1)]),_:1})]),_:1})]),_:1}))]),_:1},8,["model-value"])]),_:1}),n(V,{"background-color":"#fff"},{default:s(()=>[n(r,{class:"btn-box"},{default:s(()=>[n(w,{class:"btn",plain:"",disabled:2===B.invoiceType&&!L.value,onClick:J},{default:s(()=>[c(i(e.$t("暂不开票")),1)]),_:1},8,["disabled"]),n(w,{class:"btn",disabled:2===B.invoiceType&&!L.value,onClick:R},{default:s(()=>[c(i(e.$t("提交")),1)]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["show"])]),_:1})}}}),[["__scopeId","data-v-322121b9"]]),me=p(a({__name:"remark",props:{modelValue:{type:String,default:""}},emits:["update:modelValue"],setup(e,{emit:a}){const u=e,d=a,r=T({get:()=>u.modelValue,set(e){d("update:modelValue",e)}});return(e,a)=>{const u=o,d=v(_("up-input"),j);return l(),t(u,{class:"remark"},{default:s(()=>[n(u,{class:"remark-title"},{default:s(()=>[c(i(e.$t("备注")),1)]),_:1}),n(u,{class:"remark-content"},{default:s(()=>[n(d,{modelValue:r.value,"onUpdate:modelValue":a[0]||(a[0]=e=>r.value=e),placeholder:e.$t("备注建议提前协商（250字以内）"),border:"none","input-align":"right",maxlength:"250",clearable:!0},null,8,["modelValue","placeholder"])]),_:1})]),_:1})}}}),[["__scopeId","data-v-f6ca286c"]]),fe=p(a({__name:"totalCard",props:{total:{type:Object,default:()=>({})},cartList:{type:Array,default:()=>[]},flowType:{type:Number}},setup(e){const a=w(),u=f(!1),d=()=>{u.value=!u.value};return(r,p)=>{const m=o,f=v(_("format-price"),G),y=v(_("up-icon"),B),g=N;return l(),t(m,{class:"total-card"},{default:s(()=>[n(m,null,{default:s(()=>[n(m,{class:"total-card-item"},{default:s(()=>[n(m,{class:"total-card-item-left"},{default:s(()=>[c(i(r.$t("商品总价")),1)]),_:1}),n(m,{class:"total-card-item-right"},{default:s(()=>[n(f,{"is-bottom":!1,"price-data":e.total.productAmount},null,8,["price-data"])]),_:1})]),_:1}),e.total.serviceFee&&e.total.serviceFee>0?(l(),t(m,{key:0,class:"total-card-item"},{default:s(()=>[n(m,{class:"total-card-item-left"},{default:s(()=>[c(i(r.$t("附加费用")),1)]),_:1}),n(m,{class:"total-card-item-right"},{default:s(()=>[n(f,{"is-bottom":!1,"price-data":e.total.serviceFee},null,8,["price-data"])]),_:1})]),_:1})):k("",!0),e.total.shippingFee>0?(l(),t(m,{key:1,class:"total-card-item"},{default:s(()=>[n(m,{class:"total-card-item-left"},{default:s(()=>[c(i(r.$t("配送费用")),1)]),_:1}),n(m,{class:"total-card-item-right special-text"},{default:s(()=>[n(f,{"is-bottom":!1,"price-data":e.total.shippingFee},null,8,["price-data"])]),_:1})]),_:1})):k("",!0),e.total.balance>0?(l(),t(m,{key:2,class:"total-card-item"},{default:s(()=>[n(m,{class:"total-card-item-left"},{default:s(()=>[c(i(r.$t("使用余额")),1)]),_:1}),n(m,{class:"total-card-item-right"},{default:s(()=>[c("- "),n(f,{"is-bottom":!1,"price-data":e.total.balance},null,8,["price-data"])]),_:1})]),_:1})):k("",!0),e.total.pointsAmount>0&&3!=e.flowType?(l(),t(m,{key:3,class:"total-card-item"},{default:s(()=>[n(m,{class:"total-card-item-left"},{default:s(()=>[c(i(r.$t(`${h(a).integralName}减免`)),1)]),_:1}),n(m,{class:"total-card-item-right"},{default:s(()=>[c("- "),n(f,{"is-bottom":!1,"price-data":e.total.pointsAmount},null,8,["price-data"])]),_:1})]),_:1})):k("",!0),e.total.discounts>0?(l(),t(m,{key:4,class:"total-card-item"},{default:s(()=>[n(m,{class:"total-card-item-left",onClick:d},{default:s(()=>[c(i(r.$t("共优惠"))+" ",1),n(y,{style:{"padding-left":"4rpx"},size:"16",color:"#969799",name:"info-circle"})]),_:1}),n(m,{class:"total-card-item-right"},{default:s(()=>[n(m,null,{default:s(()=>[c(" - "),n(f,{"is-bottom":!1,"price-data":e.total.discounts},null,8,["price-data"])]),_:1})]),_:1})]),_:1})):k("",!0),e.total.orderSendPoint&&e.total.orderSendPoint>0?(l(),t(m,{key:5,class:"total-card-tig"},{default:s(()=>[c(" * "+i(r.$t("该订单完成后，您将预计获得"))+" ",1),n(g,{class:"special-text"},{default:s(()=>[c(i(e.total.orderSendPoint),1)]),_:1}),c(" "+i(r.$t(h(a).integralName)),1)]),_:1})):k("",!0)]),_:1}),n(ue,{modelValue:u.value,"onUpdate:modelValue":p[0]||(p[0]=e=>u.value=e),total:e.total,"discount-type":"order"},null,8,["modelValue","total"])]),_:1})}}}),[["__scopeId","data-v-774f31be"]]),ye=p(a({__name:"check",setup(a){const{t:u}=m(),d=w(),p=z(),y=V({addressId:0,shippingType:{},payTypeId:0,usePoint:0,useBalance:0,useCouponIds:[],selectUserCouponIds:[],buyerNote:"",invoiceData:{},productExtra:{}}),g=f([]),b=f({}),I=async()=>{try{const e=await Y({page:1,size:99}),a=J("link");if(0===e.records.length&&!a)return r({url:"/pages/address/list"});e.records.length>0&&(b.value=e.records[0],y.addressId=e.records[0].addressId,g.value=e.records)}catch(e){console.error(e)}},$=f([]),C=async()=>{try{const a=await e({url:"order/check/getAvailablePaymentType",method:"GET"});y.payTypeId=a[0].typeId,$.value=a}catch(a){console.log(a)}},N=f({}),P=async()=>{try{const t=await(a={flowType:j.value},e({url:"order/check/getStoreShippingType",method:"GET",params:a}));N.value=t;for(const e in t)t[e]&&t[e].length>0&&(y.shippingType[e]={typeId:t[e][0].shippingTypeId,shopId:t[e][0].shopId,typeName:t[e][0].shippingTypeName})}catch(t){console.log(t)}var a},A=f([]),S=f(),U=f([]),D=f([]),j=f(1),B=f(0),K=async()=>{try{const t=await(a={flowType:j.value,...y},e({url:"order/check/index",method:"post",data:a})),{cartList:l,total:o,couponList:s,tmplIds:n,item:u,useCouponIds:c,selectUserCouponIds:i}=t;Object.assign(y,u),A.value=l,S.value=o,U.value=s,D.value=n,B.value=t.availablePoints,c&&c.length>0&&(y.useCouponIds=c),i&&i.length>0&&(y.selectUserCouponIds=i)}catch(t){console.error(t)}var a},Q=async e=>{y.productExtra=e;const a=await ee();a&&(A.value=a.cartList)},ee=async()=>{O({title:u("加载中")});try{const t=await(a={flowType:j.value,...y},e({url:"order/check/update",method:"post",data:a}));return Object.assign(y,t.item),S.value=t.total,B.value=t.availablePoints,t}catch(t){x({title:t.message,duration:1500})}finally{q()}var a},ae=async()=>{O({title:u("加载中")});try{const t=await(a=y,e({url:"order/check/updateCoupon",method:"post",data:a}));return U.value=t.couponList,S.value=t.total,A.value=t.cartList,y.useCouponIds=t.useCouponIds,y.selectUserCouponIds=t.selectUserCouponIds,t}catch(t){console.error(t)}finally{q()}var a},te=e=>{y.useBalance=e?p.userInfo.balance:0,ee()},le=T(()=>{if(!y.shippingType)return!0;for(const e of A.value)if(0===e.noShipping&&!y.shippingType[e.shopId])return!0;return!1}),oe=f(!1),se=async()=>{if(!oe.value)return 0===y.payTypeId?x({title:u("请选择付款方式"),icon:"none"}):void(le.value||oe.value||(oe.value=!0,ne()))},ne=async()=>{try{const t=await(a=y,e({url:"order/check/submit",method:"post",data:a}));2===t.returnType?M({url:`/pages/order/payStatus?id=${t.orderId}`,mode:"redirectTo"}):M({url:`/pages/order/pay?orderId=${t.orderId}`,mode:"redirectTo"})}catch(t){if(console.error(t),"wechat"===d.XClientType&&5002===t.code)return R("bindWechatFlowType",j.value),M({url:`/pages/user/profile/index?bindWechat=true&flowType=${j.value}`});x({title:t.message,icon:"none"}),setTimeout(()=>{M({url:"/pages/cart/index",mode:"redirectTo"})},1500)}finally{oe.value=!1}var a},ue=f();L(async()=>{ye(),(null==ue?void 0:ue.value)&&(ue.value.isBalance=!1,y.useBalance=0)});const ye=async()=>{try{O({title:u("加载中")}),await Promise.all([I(),C(),P(),p.getUserInfo()]),await K()}catch(e){console.error(e),x({title:e.message,icon:"none"}),setTimeout(()=>{M({url:"/pages/cart/index",mode:"redirectTo"})},1500)}finally{q()}};return E(()=>{F("link")}),W(e=>{e&&e.flowType&&(j.value=e.flowType)}),(e,a)=>{const u=o,r=v(_("format-price"),G),m=v(_("tig-button"),H),f=v(_("tig-fixed-placeholder"),Z),g=v(_("tig-layout"),X);return l(),t(g,{title:"提交订单"},{default:s(()=>{var o,v;return[n(ce,{data:b.value},null,8,["data"]),$.value.length>0?(l(),t(ie,{key:0,"pay-type-id":y.payTypeId,"onUpdate:payTypeId":a[0]||(a[0]=e=>y.payTypeId=e),"available-payment-type":$.value,onChange:ee},null,8,["pay-type-id","available-payment-type"])):k("",!0),n(de,{"shipping-type":y.shippingType,"onUpdate:shippingType":a[1]||(a[1]=e=>y.shippingType=e),"cart-list":A.value,"shipping-type-list":N.value,onChange:ee,onChangeProductExtra:Q},null,8,["shipping-type","cart-list","shipping-type-list"]),n(me,{modelValue:y.buyerNote,"onUpdate:modelValue":a[2]||(a[2]=e=>y.buyerNote=e)},null,8,["modelValue"]),1==h(d).useCoupon||1==h(d).usePoints||1==h(d).useSurplus?(l(),t(re,{key:1,ref_key:"couponInfoRef",ref:ue,"use-coupon-ids":y.useCouponIds,"onUpdate:useCouponIds":a[3]||(a[3]=e=>y.useCouponIds=e),"select-user-coupon-ids":y.selectUserCouponIds,"onUpdate:selectUserCouponIds":a[4]||(a[4]=e=>y.selectUserCouponIds=e),"use-point":y.usePoint,"onUpdate:usePoint":a[5]||(a[5]=e=>y.usePoint=e),balance:h(p).userInfo.balance??0,points:h(p).userInfo.points,"available-points":B.value,"points-amount":Number(null==(o=S.value)?void 0:o.pointsAmount)??0,"coupon-amount":Number(null==(v=S.value)?void 0:v.discountCouponAmount)??0,"coupon-list":U.value,"flow-type":j.value,onSendBalanceStatus:te,onChange:ae},null,8,["use-coupon-ids","select-user-coupon-ids","use-point","balance","points","available-points","points-amount","coupon-amount","coupon-list","flow-type"])):k("",!0),1===h(d).canInvoice?(l(),t(pe,{key:2,"invoice-info":y.invoiceData,"onUpdate:invoiceInfo":a[6]||(a[6]=e=>y.invoiceData=e),"get-address-info":b.value},null,8,["invoice-info","get-address-info"])):k("",!0),n(fe,{total:S.value,"cart-list":A.value,"flow-type":j.value},null,8,["total","cart-list","flow-type"]),n(f,{"background-color":"#fff"},{default:s(()=>[n(u,{class:"submit-btn-box"},{default:s(()=>[n(u,{class:"submit-btn-price"},{default:s(()=>{var a;return[n(u,{class:"price-text"},{default:s(()=>[c(i(e.$t("应付"))+":",1)]),_:1}),3==j.value?(l(),t(u,{key:0,class:"points-box"},{default:s(()=>[n(u,{class:"points-value"},{default:s(()=>{var a;return[c(i(null==(a=S.value)?void 0:a.exchangePoints)+" ",1),n(u,{class:"points-text"},{default:s(()=>[c(i(e.$t(h(d).integralName)),1)]),_:1})]}),_:1}),n(u,{class:"symbol"},{default:s(()=>[c("+")]),_:1})]),_:1})):k("",!0),n(r,{"font-style":{fontWeight:"bold",fontSize:"34rpx"},"decimals-style":{fontSize:"24rpx",fontWeight:"bold"},"currency-style":{fontSize:"23rpx",fontWeight:"bold"},"price-data":null==(a=S.value)?void 0:a.unpaidAmount},null,8,["price-data"])]}),_:1}),n(u,null,{default:s(()=>[n(m,{class:"btn",disabled:le.value,onClick:se},{default:s(()=>[c(i(e.$t("提交订单")),1)]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1})]}),_:1})}}}),[["__scopeId","data-v-fc3eddbc"]]);export{ye as default};
