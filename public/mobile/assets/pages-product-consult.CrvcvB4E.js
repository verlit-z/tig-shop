import{d as a,K as l,r as e,l as t,q as s,c as u,w as o,Q as c,a9 as d,aa as i,B as n,E as r,b7 as f,o as p,g as m,a as _,i as v,b as g,F as y,ab as b,f as h,t as k,I as x,J as w,O as $,h as j,aB as C,G as I,af as z,_ as T}from"./index-DE5OqlOG.js";import{_ as N}from"./format-price.Cc34639m.js";import{_ as P,e as V,b as A}from"./tig-layout.fowSnIDi.js";import{_ as B}from"./tig-fixed-placeholder.OF5rBWLr.js";import{h as Q,c as S,i as U}from"./product.xxdbZFp6.js";const q=T(a({__name:"consult",setup(a){const{t:T}=l(),q=e({productId:0,productStock:0}),E=e(!1),F=e(1),G=e(10),J=e(0),K=e(!1),L=e(!1),M=e(""),O=e([]),D=e(0),H=e(!1),R=async()=>{F.value>1&&(K.value=!0),d({title:T("加载中")}),O.value=[];try{const a=await S({productId:W.value,page:F.value,size:G.value});O.value=[...O.value,...a.records],D.value=a.total}catch(a){c({title:a.message,icon:"none"})}finally{K.value=!1,i()}},W=e("");t(a=>{if(a){const{id:l}=a;l&&(W.value=l,(async a=>{try{let l=await Q(a);q.value=l.item}catch(l){c({title:l.message,icon:"none"})}})(l),R())}});const X=()=>{L.value=!0,z(()=>{setTimeout(()=>{H.value=!0},100)})},Y=async()=>{if(M.value.trim())try{await U({productId:W.value,content:M.value,type:2}),M.value="",L.value=!1,c({title:T("请您耐心等待客服人员的回复，您可在会员中心查看留言回复消息动态")}),R()}catch(a){c({title:a.message,icon:"none"})}else c({title:T("请输入咨询内容"),icon:"none"})},Z=()=>{L.value=!1};return s(()=>{F.value<Math.ceil(J.value/G.value)&&(F.value++,R())}),(a,l)=>{const e=g,t=v,s=n(r("format-price"),N),c=j,d=n(r("tig-button"),V),i=n(r("tig-fixed-placeholder"),B),z=n(r("up-textarea"),f),T=n(r("tig-popup"),A),Q=n(r("tig-layout"),P);return p(),u(Q,{title:"商品咨询"},{default:o(()=>[m(t,{class:"product-info flex"},{default:o(()=>[m(t,{class:"product-info-img"},{default:o(()=>[m(e,{"lazy-load":"",class:"product-img",src:y(b)(q.value.picThumb||"")},null,8,["src"])]),_:1}),m(t,null,{default:o(()=>[m(t,{class:"product-info-title line2"},{default:o(()=>[h(k(q.value.productName),1)]),_:1}),q.value.marketPrice&&Number(q.value.marketPrice)>0?(p(),u(t,{key:0,class:"product-info-price"},{default:o(()=>[m(s,{"is-bottom":!1,"price-data":q.value.marketPrice},null,8,["price-data"])]),_:1})):_("",!0)]),_:1})]),_:1}),m(t,{class:"product-consult-card"},{default:o(()=>[(p(!0),x(w,null,$(O.value,(a,l)=>(p(),u(t,{key:l,class:"consult-item"},{default:o(()=>[m(t,{class:"consult-item-tit flex justify-between"},{default:o(()=>[m(t,{class:"time"},{default:o(()=>[h(k(a.addTime),1)]),_:2},1024),m(t,{class:"name"},{default:o(()=>[h(k(a.username),1)]),_:2},1024)]),_:2},1024),m(t,{class:"consult-con line1"},{default:o(()=>[m(c,null,{default:o(()=>[h("Q")]),_:1}),h(" "+k(a.content),1)]),_:2},1024),a.reply?(p(),u(t,{key:0,class:"consult-con line1 reply"},{default:o(()=>[m(c,null,{default:o(()=>[h("A")]),_:1}),h(" "+k(a.reply.content),1)]),_:2},1024)):_("",!0)]),_:2},1024))),128))]),_:1}),m(i,{"background-color":"#fff"},{default:o(()=>[m(t,{class:"btn-box"},{default:o(()=>[m(d,{class:"btn",onClick:X},{default:o(()=>[h(k(a.$t("咨询客服")),1)]),_:1})]),_:1})]),_:1}),m(T,{show:L.value,"onUpdate:show":l[1]||(l[1]=a=>L.value=a),round:20,showClose:!1},{default:o(()=>[m(t,{class:"popup-content"},{default:o(()=>[m(t,{class:"popup-header"},{default:o(()=>[m(t,{class:"flex"},{default:o(()=>[m(t,{class:"product-Slot"},{default:o(()=>[C(a.$slots,"left",{},()=>[m(t,{class:"iconfont icon-houtui",onClick:Z})],!0)]),_:3}),m(t,{class:"product-info-img"},{default:o(()=>[m(e,{"lazy-load":"",class:"product-img",src:y(b)(q.value.picThumb||"")},null,8,["src"])]),_:1}),m(t,{class:"product-info-title"},{default:o(()=>[h(k(a.$t(q.value.productName)),1)]),_:1})]),_:3}),m(t,{class:"popup-footer"},{default:o(()=>[m(d,{class:"btn",disabled:!M.value.trim(),"custom-style":{background:M.value.trim()?"#C3A769":"#e6e6e6",color:M.value.trim()?"#fff":"#f7f7f7",borderColor:"transparent"},onClick:Y},{default:o(()=>[h(k(a.$t("提交")),1)]),_:1},8,["disabled","custom-style"])]),_:1})]),_:3}),m(t,{class:"popup-body"},{default:o(()=>[m(t,{class:"popup-item"},{default:o(()=>[m(t,{class:"popup-item-title"},{default:o(()=>[h(k(a.$t("咨询内容"))+":",1)]),_:1}),m(z,{modelValue:M.value,"onUpdate:modelValue":l[0]||(l[0]=a=>M.value=a),"input-align":"right",height:"120",placeholder:a.$t("您可以对商品包装、规格、支付、发票、退换货和物流配送类的问题咨询客服"),border:"none",maxlength:"200",style:{background:"#f5f5f5"},focus:H.value},null,8,["modelValue","placeholder","focus"]),m(t,{class:"popup-item-footer"},{default:o(()=>[h(k(M.value.length)+"/200 ",1)]),_:1})]),_:1})]),_:1})]),_:3})]),_:3},8,["show"]),F.value>1?(p(),u(t,{key:0,class:"loading-box"},{default:o(()=>[E.value?(p(),u(t,{key:0,class:"bottomLoading"},{default:o(()=>[m(e,{"lazy-load":"",class:"loading",src:y(I)("common/loading.gif")},null,8,["src"])]),_:1})):_("",!0)]),_:1})):_("",!0),m(t,{class:"loading-box"},{default:o(()=>[O.value.length<1?(p(),u(t,{key:0,class:"empty-box"},{default:o(()=>[m(t,{class:"pictrue"},{default:o(()=>[m(e,{src:y(I)("common/data_empty.png")},null,8,["src"])]),_:1}),m(t,{class:"txt"},{default:o(()=>[h(k(a.$t("暂无咨询")),1)]),_:1})]),_:1})):_("",!0)]),_:1})]),_:3})}}}),[["__scopeId","data-v-8cc5455a"]]);export{q as default};
