import{d as e,aV as a,r as t,k as s,aM as l,aG as r,c as o,o as u,aZ as n,aN as i,aO as c,aW as v,_ as d,l as m,S as p,w as h,B as y,E as g,a6 as f,a as _,g as x,i as b,f as k,t as w,F as P}from"./index-DE5OqlOG.js";import{_ as S}from"./format-price.Cc34639m.js";import{_ as C}from"./tig-loadingpage.vue_vue_type_script_setup_true_lang.ClZKVkre.js";import{_ as j}from"./tig-layout.fowSnIDi.js";import{g as M}from"./pay.BBOrkwEb.js";import{r as T}from"./index.cAM2UeJZ.js";import"./masonry.CqYTyCF5.js";import"./specification.BJJ9B7ka.js";import"./tig-image.h_tgFjnN.js";import"./uni-icons.BITEJ68A.js";import"./uni-number-box.JWQxtRhY.js";import"./product.xxdbZFp6.js";import"./activityCard.mdMMZqu3.js";import"./useList.B4FtGhCx.js";const A=d(e({__name:"animation",setup(e,{expose:d}){const m=.03,p=.08,h=.04,y=.06,g=1.1,f=1,_=16,x=.75,b=.2,k=.2,w={SCALE_UP:50,CHECK_MARK:25},P=c(),S=a(),C=t(0),j=t(0),M=t(0),T=t({step:0,progress:0,scale:1,checkProgress:0}),A=s(()=>[{x:.3*-M.value,y:0},{x:0,y:.3*M.value},{x:.6*M.value,y:.3*-M.value}]),E=s(()=>({width:2*C.value,height:2*j.value})),I=s(()=>4!==T.value.step);let L=null,R=null;const K=e=>Math.ceil(e),V=()=>{!R&&L&&F()},W=()=>{R&&(clearTimeout(R),R=null)},$=()=>{const{step:e,scale:a}=T.value,t=(s=a,Math.round(1e3*s)/1e3);var s;t<g&&1===e?T.value.scale+=p:t>=g&&1===e&&(T.value.step=2),2===e&&(T.value.scale-=h,t<=f&&(T.value.scale=f,setTimeout(()=>{T.value.step=3},w.CHECK_MARK))),L.save(),L.translate(C.value,j.value),1===e&&L.scale(T.value.scale,T.value.scale),L.beginPath(),L.arc(0,0,M.value,0,2*Math.PI,!1),L.setFillStyle(S.themeStyle["--general"]),L.fill(),L.restore()},z=()=>{L.save(),L.translate(C.value,j.value),L.beginPath(),L.arc(0,0,M.value,0,2*Math.PI,!1),L.setFillStyle(S.themeStyle["--general"]),L.fill(),L.restore(),L.save(),L.translate(.9*C.value,j.value),L.setStrokeStyle("#fff"),L.setLineWidth(M.value*k),L.setLineCap("round"),(()=>{const{checkProgress:e}=T.value,a=A.value,t=Math.hypot(a[1].x-a[0].x,a[1].y-a[0].y),s=Math.hypot(a[2].x-a[1].x,a[2].y-a[1].y),l=(t+s)*e;if(L.beginPath(),L.moveTo(a[0].x,a[0].y),l<=t){const e=l/t;L.lineTo(a[0].x+(a[1].x-a[0].x)*e,a[0].y+(a[1].y-a[0].y)*e)}else{L.lineTo(a[1].x,a[1].y);const e=(l-t)/s;L.lineTo(a[1].x+(a[2].x-a[1].x)*e,a[1].y+(a[2].y-a[1].y)*e)}})(),L.stroke(),L.restore(),T.value.checkProgress+=y,T.value.checkProgress>=1&&(T.value.checkProgress=1,T.value.step=4)},F=()=>{if(L){switch(L.clearRect(0,0,E.value.width,E.value.height),T.value.step){case 0:(()=>{const{progress:e}=T.value;L.save(),L.beginPath(),L.arc(C.value,j.value,M.value,-Math.PI/2,-Math.PI/2+2*Math.PI*e,!1),L.setStrokeStyle(S.themeStyle["--general"]),L.setLineWidth(M.value*b),L.setLineCap("round"),L.stroke(),L.restore(),T.value.progress+=m,T.value.progress>=1&&(T.value.progress=1,setTimeout(()=>{T.value.step=1},w.SCALE_UP))})();break;case 1:case 2:$();break;case 3:z();break;case 4:return void W();default:return void console.warn("未知动画步骤",T.value.step)}L.draw(!0),I.value&&(R=setTimeout(F,_))}else console.error("画布上下文未初始化")},U=e=>{console.error(e),W()},H=async()=>{try{const e=await i(".canvas-content",P);if(!e||!e.width||!e.height)throw new Error("无法获取画布尺寸");if(C.value=K(e.width/2),j.value=K(e.height/2),M.value=K(Math.min(e.width,e.height)/2)*x,L=v("myCanvas",P),!L)throw new Error("无法创建画布上下文");V()}catch(e){(e=>{console.error("动画初始化失败",e),W()})(e)}};return l(async()=>{setTimeout(()=>{H()},300)}),r(()=>{W()}),d({resetAnimation:()=>{W(),T.value={step:0,progress:0,scale:1,checkProgress:0},L&&E.value.width>0&&(L.clearRect(0,0,E.value.width,E.value.height),L.draw(!0))},startAnimation:V,stopAnimation:W}),(e,a)=>{const t=n;return u(),o(t,{id:"myCanvas",class:"canvas-content",hidpi:"","canvas-id":"myCanvas",onError:U})}}}),[["__scopeId","data-v-6720319c"]]),E=d(e({__name:"payStatus",setup(e){f(e=>({"15bcea04":c.value})),m(e=>{e&&e.id?(l.value=!0,n(Number(e.id))):p({url:"/pages/index/index"})});const l=t(!1),r=t({}),n=async e=>{try{const a=await M({id:e});r.value=a}catch(a){console.error(a)}finally{l.value=!1}},i=a(),c=s(()=>i.hexToRgba(i.themeStyle["--general"],.1));return(e,a)=>{const t=b,s=y(g("format-price"),S),n=y(g("tig-loadingpage"),C),i=y(g("tig-layout"),j);return u(),o(i,null,{default:h(()=>[l.value?_("",!0):(u(),o(t,{key:0,class:"pay-status"},{default:h(()=>[x(t,{class:"pay-status-content"},{default:h(()=>[x(t,{class:"status-content"},{default:h(()=>[x(A),x(t,{class:"status-text"},{default:h(()=>[k(w(e.$t("支付成功")),1)]),_:1})]),_:1}),x(t,{class:"money"},{default:h(()=>[x(t,{class:"money-text"},{default:h(()=>[k(w(e.$t("实付")),1)]),_:1}),x(t,{class:"money-value"},{default:h(()=>[x(s,{"font-style":{fontSize:"38rpx"},"currency-style":{fontSize:"30rpx"},"decimals-style":{fontSize:"26rpx",fontWeight:"400"},"is-bootom":!0,"price-data":r.value.orderAmount},null,8,["price-data"])]),_:1})]),_:1}),x(t,{class:"status-btns"},{default:h(()=>[x(t,{class:"btn-item",onClick:a[0]||(a[0]=e=>P(p)({url:"/pages/user/order/list"}))},{default:h(()=>[k(w(e.$t("查看订单")),1)]),_:1}),x(t,{class:"btn-item primary",onClick:a[1]||(a[1]=e=>P(p)({url:"/pages/index/index"}))},{default:h(()=>[k(w(e.$t("继续逛逛")),1)]),_:1})]),_:1})]),_:1}),x(t,{class:"recommend"},{default:h(()=>[x(t,{class:"recommend-mask"}),x(t,{class:"recommend-content"},{default:h(()=>[x(T,{"title-bg":"#fff"})]),_:1})]),_:1})]),_:1})),x(n,{modelValue:l.value,"onUpdate:modelValue":a[2]||(a[2]=e=>l.value=e)},null,8,["modelValue"])]),_:1})}}}),[["__scopeId","data-v-bcb0bd68"]]);export{E as default};
