import{d as e,bh as a,r as t,a5 as s,aM as l,b2 as o,aO as c,aG as i,c as n,o as u,i as r,w as d,g as p,a as y,b as f,V as m,F as g,G as v,ab as h,_ as k,B as x,E as _,a7 as b,I,J as S,O as z,aB as C,f as L,t as $,h as w,N as j,n as O,af as N}from"./index-DE5OqlOG.js";import{_ as V}from"./format-price.Cc34639m.js";import{s as A}from"./specification.BJJ9B7ka.js";import{a as E}from"./activityCard.mdMMZqu3.js";const T=k(e({__name:"tig-lazy-image",props:{src:{type:String,default:"",required:!1},mode:{type:String,default:""}},emits:["error","load"],setup(e,{emit:k}){const x=e,_=a(),b=t(!1),I=t(!0),S=t(!1),z=k,C=t("");s(()=>x.src,e=>{e?(b.value=!1,I.value=!0,C.value=h(e)):(b.value=!0,I.value=!1,S.value=!0)},{immediate:!0});const L=e=>{I.value=!1,S.value=!0,b.value=!1,z("load",e)},$=e=>{b.value=!0,I.value=!1,S.value=!0,z("error",e)},w=c(),j=t(!1);let O;const N=()=>{O&&(O.disconnect(),O=null)};return l(()=>{O=o(w),O.relativeToViewport({top:0,bottom:10}).observe(`.base-image-box${_}`,e=>{j.value=e.intersectionRatio>0,e.intersectionRatio>0&&N()})}),i(()=>{N()}),(a,t)=>{const s=f,l=r;return u(),n(l,{class:"tig-lazy-image"},{default:d(()=>[p(l,{class:m("base-image-box base-image-box"+g(_))},{default:d(()=>[!b.value&&j.value?(u(),n(s,{key:0,class:m(["base-image",{"loading-end":!I.value}]),src:C.value,mode:e.mode,onError:$,onLoad:L},null,8,["class","src","mode"])):y("",!0),!I.value&&b.value?(u(),n(s,{key:1,class:"base-image empty",src:g(v)("common/empty-img-bg3.png"),mode:e.mode},null,8,["src","mode"])):y("",!0),S.value||b.value?y("",!0):(u(),n(l,{key:2,class:"base-skeleton shan"},{default:d(()=>[p(l,{class:"block"})]),_:1}))]),_:1},8,["class"])]),_:1})}}}),[["__scopeId","data-v-6b2953d8"]]),F=k(e({__name:"masonry",props:{commodityList:{type:Array,default:""},promotionList:{type:Object,default:{}},type:{type:String,default:""}},emits:["callback"],setup(e,{emit:a}){const l=e,o=a,c=()=>{o("callback")},i=t([]),m=t([]),h=t([]),k=async()=>{if(!i.value.length)return;let e=i.value[0];if(!e)return;let a=m.value.length,t=h.value.length;a<t?m.value.push(e):a>t?h.value.push(e):m.value.push(e),i.value.splice(0,1),i.value.length&&setTimeout(()=>{k()},50)};s(()=>l.commodityList,(e,a)=>{console.log("watch commodityList",e,a);let t=Array.isArray(a)&&a.length>0?a.length:0;var s;e&&(i.value=[...i.value,...(s=e.slice(t),JSON.parse(JSON.stringify(s)))],i.value.forEach(e=>{e.isCheck=!1}),N(()=>{k()}))},{immediate:!0});const F=e=>{let a,t,s;if(a=l.promotionList[e.productId],a&&a.activityInfo&&a.activityInfo.length>0&&a.activityInfo[0].skuIds&&(t=a.activityInfo[0].skuIds[0]),"exchange"===l.type)s=`id=${e.id}&type=exchange`;else s=`id=${e.productId}`;s=t?`${s}&skuId=${t}`:s,O({url:"/pages/product/index?"+s})},J=t(0),P=t(),R=t({}),B=e=>{if(!e.isCheck){if("exchange"===l.type)J.value=e.id;else J.value=e.productId;e.isCheck=!0,R.value=e}},G=()=>{P.value.handleShowPopup(),R.value.isCheck=!1},q=()=>{J.value=0};return(a,t)=>{const s=x(_("tig-lazy-image"),T),l=r,o=x(_("format-price"),V),i=w,k=f,O=x(_("up-loading-icon"),b);return u(),I(S,null,[p(l,{class:"masonry"},{default:d(()=>[p(l,{id:"left-item",class:"masonry-item"},{default:d(()=>[(u(!0),I(S,null,z(m.value,t=>C(a.$slots,"left",{key:t.id,item:t},()=>[p(l,{class:"item-li",onClick:e=>F(t)},{default:d(()=>[p(l,{class:"photo"},{default:d(()=>[p(s,{src:t.picThumb,mode:"widthFix"},null,8,["src"]),p(l,{class:"product-status-box"},{default:d(()=>[1==t.isSeckill?(u(),I(S,{key:0},[0==t.seckillStock?(u(),n(l,{key:0,class:"outsale"},{default:d(()=>[L($(a.$t("已售罄")),1)]),_:1})):y("",!0)],64)):(u(),I(S,{key:1},[t.productSku&&0===t.productSku.length&&0==t.productStock?(u(),n(l,{key:0,class:"outsale"},{default:d(()=>[L($(a.$t("已售罄")),1)]),_:1})):y("",!0)],64))]),_:2},1024)]),_:2},1024),p(l,{class:"info"},{default:d(()=>[p(l,{class:"detail"},{default:d(()=>[L($(t.productName),1)]),_:2},1024),Object.keys(e.promotionList).length>0&&e.promotionList[t.productId]&&e.promotionList[t.productId].activityInfo?(u(),n(l,{key:0,class:"flex activity-box"},{default:d(()=>[(u(!0),I(S,null,z(e.promotionList[t.productId].activityInfo,e=>(u(),n(E,{key:e.promotionId,"activity-info":e},null,8,["activity-info"]))),128))]),_:2},1024)):y("",!0),p(l,{class:"action"},{default:d(()=>[p(l,{class:"pricenum"},{default:d(()=>["exchange"===e.type?(u(),n(l,{key:0,class:"exchange-box"},{default:d(()=>[p(o,{"font-style":{fontSize:"32rpx"},"currency-style":{fontSize:"22rpx"},"decimals-style":{fontSize:"25rpx"},"price-data":t.discountsPrice},null,8,["price-data"]),p(i,{class:"exchange-icon"},{default:d(()=>[L("+")]),_:1}),p(k,{class:"exchange-img",src:g(v)("exchange/exchange.png")},null,8,["src"]),p(i,{class:"exchange-text"},{default:d(()=>[L($(t.exchangeIntegral),1)]),_:2},1024)]),_:2},1024)):(u(),n(o,{key:1,"font-style":{fontSize:"32rpx"},"currency-style":{fontSize:"22rpx"},"decimals-style":{fontSize:"25rpx"},"price-data":t.price},null,8,["price-data"]))]),_:2},1024),p(l,{class:"buy_btn",onClick:j(e=>B(t),["stop"])},{default:d(()=>[t.isCheck?(u(),n(O,{key:0,size:"22",mode:"circle"})):(u(),I(S,{key:1},["exchange"===e.type?(u(),I(S,{key:0},[],64)):(u(),n(i,{key:1,class:"iconfont-h5 icon-gouwuche3 buy_btn_icon"}))],64))]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"])],!0)),128))]),_:3}),p(l,{id:"right-item",class:"masonry-item"},{default:d(()=>[(u(!0),I(S,null,z(h.value,t=>C(a.$slots,"right",{key:t.id,item:t},()=>[p(l,{class:"item-li",onClick:e=>F(t)},{default:d(()=>[p(l,{class:"photo"},{default:d(()=>[p(s,{src:t.picThumb,mode:"widthFix"},null,8,["src"]),p(l,{class:"product-status-box"},{default:d(()=>[t.productSku&&0===t.productSku.length&&0==t.productStock?(u(),n(l,{key:0,class:"outsale"},{default:d(()=>[L($(a.$t("已售罄")),1)]),_:1})):y("",!0)]),_:2},1024)]),_:2},1024),p(l,{class:"info"},{default:d(()=>[p(l,{class:"detail"},{default:d(()=>[L($(t.productName),1)]),_:2},1024),Object.keys(e.promotionList).length>0?(u(),n(l,{key:0,class:"flex activity-box"},{default:d(()=>[e.promotionList[t.productId]&&e.promotionList[t.productId].activityInfo?(u(!0),I(S,{key:0},z(e.promotionList[t.productId].activityInfo,e=>(u(),n(E,{key:e.promotionId,"activity-info":e},null,8,["activity-info"]))),128)):y("",!0)]),_:2},1024)):y("",!0),p(l,{class:"action"},{default:d(()=>[p(l,{class:"pricenum"},{default:d(()=>["exchange"===e.type?(u(),n(l,{key:0,class:"exchange-box"},{default:d(()=>[p(o,{"font-style":{fontSize:"32rpx"},"currency-style":{fontSize:"22rpx"},"decimals-style":{fontSize:"25rpx"},"price-data":t.discountsPrice},null,8,["price-data"]),p(i,{class:"exchange-icon"},{default:d(()=>[L("+")]),_:1}),p(k,{class:"exchange-img",src:g(v)("exchange/exchange.png")},null,8,["src"]),p(i,{class:"exchange-text"},{default:d(()=>[L($(t.exchangeIntegral),1)]),_:2},1024)]),_:2},1024)):(u(),n(o,{key:1,"font-style":{fontSize:"32rpx"},"currency-style":{fontSize:"22rpx"},"decimals-style":{fontSize:"25rpx"},"price-data":t.price},null,8,["price-data"]))]),_:2},1024),p(l,{class:"buy_btn",onClick:j(e=>B(t),["stop"])},{default:d(()=>[t.isCheck?(u(),n(O,{key:0,size:"22",mode:"circle"})):(u(),I(S,{key:1},["exchange"===e.type?(u(),I(S,{key:0},[],64)):(u(),n(i,{key:1,class:"iconfont-h5 icon-gouwuche3 buy_btn_icon"}))],64))]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"])],!0)),128))]),_:3})]),_:3}),p(A,{ref_key:"specificationRef",ref:P,modelValue:J.value,"onUpdate:modelValue":t[0]||(t[0]=e=>J.value=e),type:e.type,onAddCardSucceed:c,onLoadEnd:G,onClose:q},null,8,["modelValue","type"])],64)}}}),[["__scopeId","data-v-30e426a9"]]);export{T as _,F as m};
