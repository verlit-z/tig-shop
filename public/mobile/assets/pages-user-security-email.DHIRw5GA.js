import{d as e,r as a,l,k as t,c as i,w as s,B as u,E as n,o,g as r,i as c,I as d,J as v,F as p,f,t as m,Q as y,n as _,_ as k}from"./index-DE5OqlOG.js";import{_ as h}from"./uni-easyinput.Cpml7ZWU.js";import{_ as b,e as g}from"./tig-layout.fowSnIDi.js";import{V as x}from"./index.CrA6UYZE.js";import{c as $,d as U,e as C,f as q}from"./security.CquDD74n.js";import"./uni-icons.BITEJ68A.js";const w=k(e({__name:"email",setup(e){const k=e=>{T.value=e},w=e=>{E.value=e},j=e=>{M.value=e},I=e=>{D.value=e},E=a(""),D=a(""),M=a(""),T=a(""),B=a(""),F=a(!0),J=a(!1),K=a(!1);l(e=>{e.email?(J.value=!0,E.value=e.email):J.value=!1});const Q=t(()=>!T.value||!B.value),V=e=>{y({title:e,duration:1500,icon:"none"})},z=async()=>{try{let e={email:E.value,code:T.value};await C({...e}),y({title:"绑定成功",icon:"none"}),_({url:"/pages/user/index"})}catch(e){y({title:e.message,icon:"none"})}},A=async()=>{if(!K.value)return await(async()=>{try{await q({email:E.value,code:T.value}),K.value=!0}catch(e){y({title:e.message,icon:"none"}),console.error("Email validation failed:",e)}})();try{let e={email:K.value?D.value:E.value,code:K.value?M.value:T.value};await C({...e}),y({title:"绑定成功",icon:"none"}),_({url:"/pages/user/index"})}catch(e){y({title:e.message,icon:"none"})}};return(e,a)=>{const l=u(n("uni-easyinput"),h),t=c,y=u(n("tig-button"),g),_=u(n("tig-layout"),b);return o(),i(_,{title:"账户安全"},{default:s(()=>[r(t,{class:"profile-edit-main"},{default:s(()=>[r(t,{class:"profile-edit-content"},{default:s(()=>[K.value?(o(),d(v,{key:0},[r(t,{class:"item special-item line"},{default:s(()=>[r(l,{"input-border":!1,value:D.value,focus:!0,class:"uni-input item-input",placeholder:e.$t("请输入新邮箱"),"primary-color":"rgb(192, 196, 204)",onInput:I},null,8,["value","placeholder"])]),_:1}),r(t,{class:"flex align-center"},{default:s(()=>[r(t,{class:"item line"},{default:s(()=>[r(l,{"input-border":!1,value:M.value,class:"",placeholder:e.$t("新邮箱验证码"),"primary-color":"rgb(192, 196, 204)",onInput:j},null,8,["value","placeholder"])]),_:1}),r(x,{"is-checked":F.value,"onUpdate:isChecked":a[0]||(a[0]=e=>F.value=e),email:D.value,"onUpdate:email":a[1]||(a[1]=e=>D.value=e),"verify-token-data":B.value,"onUpdate:verifyTokenData":a[2]||(a[2]=e=>B.value=e),style:{height:"65rpx"},"request-api":p($),onMobileErrorCallback:V},null,8,["is-checked","email","verify-token-data","request-api"])]),_:1})],64)):(o(),d(v,{key:1},[J.value?(o(),i(t,{key:0,class:"item"},{default:s(()=>[r(t,{class:"title"},{default:s(()=>[r(t,null,{default:s(()=>[f(m(e.$t("请输入")),1)]),_:1}),r(t,{class:"info"},{default:s(()=>[f(m(E.value.replace(/(\w{2})[\w.-]*@/,"$1*****@")),1)]),_:1}),r(t,null,{default:s(()=>[f(m(e.$t("收到的短信验证码")),1)]),_:1})]),_:1})]),_:1})):(o(),d(v,{key:1},[r(t,{class:"item"},{default:s(()=>[r(t,{class:"title"},{default:s(()=>[r(t,null,{default:s(()=>[f(m(e.$t("您还未绑定邮箱，请输入邮箱绑定")),1)]),_:1})]),_:1})]),_:1}),r(t,{class:"item special-item line"},{default:s(()=>[r(l,{"input-border":!1,value:E.value,class:"uni-input item-input",placeholder:e.$t("请输入邮箱"),"primary-color":"rgb(192, 196, 204)",onInput:w},null,8,["value","placeholder"])]),_:1})],64)),r(t,{class:"flex align-center"},{default:s(()=>[r(t,{class:"item line"},{default:s(()=>[r(l,{"input-border":!1,value:T.value,class:"",placeholder:e.$t("邮箱验证码"),"primary-color":"rgb(192, 196, 204)",onInput:k},null,8,["value","placeholder"])]),_:1}),J.value?(o(),i(x,{key:0,"is-checked":F.value,"onUpdate:isChecked":a[3]||(a[3]=e=>F.value=e),email:E.value,"onUpdate:email":a[4]||(a[4]=e=>E.value=e),"verify-token-data":B.value,"onUpdate:verifyTokenData":a[5]||(a[5]=e=>B.value=e),style:{height:"65rpx"},"request-api":p(U),onMobileErrorCallback:V},null,8,["is-checked","email","verify-token-data","request-api"])):(o(),i(x,{key:1,"is-checked":F.value,"onUpdate:isChecked":a[6]||(a[6]=e=>F.value=e),email:E.value,"onUpdate:email":a[7]||(a[7]=e=>E.value=e),"verify-token-data":B.value,"onUpdate:verifyTokenData":a[8]||(a[8]=e=>B.value=e),style:{height:"65rpx"},"request-api":p($),onMobileErrorCallback:V},null,8,["is-checked","email","verify-token-data","request-api"]))]),_:1})],64)),J.value?(o(),i(t,{key:3,class:"item",style:{height:"60rpx"}},{default:s(()=>[r(y,{disabled:Q.value,class:"next",onClick:A},{default:s(()=>[f(m(e.$t("下一步")),1)]),_:1},8,["disabled"])]),_:1})):(o(),i(t,{key:2,class:"item",style:{height:"60rpx"}},{default:s(()=>[r(y,{disabled:Q.value,class:"next",onClick:z},{default:s(()=>[f(m(e.$t("下一步")),1)]),_:1},8,["disabled"])]),_:1}))]),_:1}),r(t,{class:"profile-edit-content"},{default:s(()=>[r(t,{class:"btn-item"},{default:s(()=>[r(t,{class:"title"},{default:s(()=>[r(t,{class:"big-title"},{default:s(()=>[f(m(e.$t("为什么要进行身份验证"))+"？",1)]),_:1})]),_:1}),r(t,{class:"info"},{default:s(()=>[f("1. "+m(e.$t("为保障您的账户信息安全，在变更账户中的重要信息时需要进行身份验证，感谢您的理解和支持"))+"。",1)]),_:1}),r(t,{class:"info"},{default:s(()=>[f("2. "+m(e.$t("验证身份遇到问题？您可以通知我们的客服，我们将尽快联系您"))+"。",1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})}}}),[["__scopeId","data-v-e910326b"]]);export{w as default};
