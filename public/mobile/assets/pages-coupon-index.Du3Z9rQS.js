import{_ as e,c as t,o as a,w as s,aB as l,f as u,t as o,i as c,d as n,K as i,r as d,U as f,l as p,s as r,q as y,a9 as _,aa as m,B as g,E as v,g as h,a as k,I as x,J as b,O as $,V as D,b as z,F as N,G as I,Q as j,n as w}from"./index-DE5OqlOG.js";import{_ as S}from"./format-price.Cc34639m.js";import{e as T,_ as C}from"./tig-layout.fowSnIDi.js";import{g as R,b as B,a as E}from"./coupon.cwyGQYgg.js";const M=e({},[["render",function(e,n){const i=c;return a(),t(i,{class:"tag"},{default:s(()=>[l(e.$slots,"default",{},()=>[u(o(e.$t("已过期")),1)],!0)]),_:3})}],["__scopeId","data-v-659b4d16"]]),U=e(n({__name:"index",setup(e){const{t:l}=i(),n=d("优惠券"),U=f({page:1,size:10}),J=d(1),O=d(0),q=d([]),F=d(!0),G=async()=>{_({title:l("加载中")});try{let e={};e=1==J.value?await R(U):await B(U),q.value=[...q.value,...e.records],O.value=e.total}catch(e){console.error(e)}finally{m(),F.value=!1}},K=(e,t,a)=>0===t?1===e?"已领取":a>0?"再次领取":l("马上领"):0===e?"马上领":a>=t?"已领取":"再次领取";return p(e=>{e&&e.type&&(J.value=e.type,2==e.type&&(n.value="我的优惠券"))}),r(()=>{U.page=1,q.value=[],G()}),y(()=>{U.page<Math.ceil(O.value/U.size)&&(U.page++,G())}),(e,i)=>{const d=c,f=g(v("format-price"),S),p=g(v("tig-button"),T),r=z,y=g(v("tig-layout"),C);return a(),t(d,null,{default:s(()=>[h(y,{title:n.value},{default:s(()=>[q.value&&q.value.length?(a(),t(d,{key:0,class:"tmcscoupon-list"},{default:s(()=>[1==J.value?(a(),t(d,{key:0,class:"coupon-box"},{default:s(()=>[(a(!0),x(b,null,$(q.value,(c,n)=>(a(),t(d,{key:n,class:"coupon-item"},{default:s(()=>[h(d,{class:"left"},{default:s(()=>[h(d,{class:"col-1"},{default:s(()=>[h(d,{class:"title line2"},{default:s(()=>[u(o(c.couponName),1)]),_:2},1024)]),_:2},1024),c.couponDesc?(a(),t(d,{key:0,class:"col-2"},{default:s(()=>[u(o(c.couponDesc),1)]),_:2},1024)):k("",!0),1===c.sendType?(a(),t(d,{key:1,class:"col-3"},{default:s(()=>[u(o(e.$t("有效期"))+"："+o(c.useEndDate),1)]),_:2},1024)):k("",!0),0===c.sendType&&c.delayDay>0?(a(),t(d,{key:2,class:"col-3"},{default:s(()=>[u(o(`领券${c.delayDay}天后生效，有效期{1}天`),1)]),_:2},1024)):k("",!0),0===c.sendType&&0===c.delayDay?(a(),t(d,{key:3,class:"col-3"},{default:s(()=>[u(o(`领券当日起${c.useDay}天内可用`),1)]),_:2},1024)):k("",!0)]),_:2},1024),h(d,{class:"right"},{default:s(()=>[h(d,{class:"right-1"},{default:s(()=>[2===c.couponType?(a(),x(b,{key:0},[h(d,{class:"zhekou"},{default:s(()=>[u(o(c.couponDiscount),1)]),_:2},1024),h(d,{class:"zhe"},{default:s(()=>[u(o(e.$t("折")),1)]),_:1})],64)):(a(),t(f,{key:1,"show-text":!1,"currency-style":{"justify-content":"flex-end",fontSize:"24rpx","padding-bottom":"8rpx"},"is-bottom":!1,"font-style":{fontSize:"48rpx"},"price-data":c.couponMoney},null,8,["price-data"]))]),_:2},1024),h(d,{class:"right-2"},{default:s(()=>[h(d,null,{default:s(()=>[h(p,{"custom-style":{height:"55rpx"},"plain-main-color":"",disabled:"已领取"===K(c.isReceive,c.limitNum,c.receiveNum),onClick:e=>(async e=>{if(_({title:l("加载中")}),"已领取"!==K(e.isReceive,e.limitNum,e.receiveNum))try{await E({couponId:e.couponId}),j({title:l("领取成功"),duration:1500}),setTimeout(()=>{U.page=1,q.value=[],G()},100)}catch(t){console.error(t),j({title:t.message,icon:"none",duration:1500})}finally{m()}else j({title:l("已领取"),icon:"none",duration:1500})})(c)},{default:s(()=>[u(o(e.$t(K(c.isReceive,c.limitNum,c.receiveNum))),1)]),_:2},1032,["disabled","onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024),h(d,{class:"dotted-line"})]),_:2},1024))),128))]),_:1})):k("",!0),2==J.value?(a(),t(d,{key:1,class:"coupon-box"},{default:s(()=>[(a(!0),x(b,null,$(q.value,(l,c)=>(a(),t(d,{key:c,class:D([{grayScaleDiv:1!=l.status&&2!=l.status&&3!=l.status,pastDue:5===l.status,haveBeenUsed:4===l.status,comingIntoEffect:3===l.status},"coupon-item"])},{default:s(()=>[1!=l.status&&2!=l.status&&3!=l.status?(a(),t(d,{key:0,class:"tag-box"},{default:s(()=>[5===l.status?(a(),t(M,{key:0})):(a(),t(M,{key:1},{default:s(()=>[u(o(3===l.status?e.$t("即将生效"):e.$t("已使用")),1)]),_:2},1024))]),_:2},1024)):k("",!0),h(d,{class:"left"},{default:s(()=>[h(d,{class:"col-1"},{default:s(()=>[h(d,{class:"title line2"},{default:s(()=>[u(o(l.couponName),1)]),_:2},1024)]),_:2},1024),l.couponDesc?(a(),t(d,{key:0,class:"col-2"},{default:s(()=>[u(o(l.couponDesc),1)]),_:2},1024)):k("",!0),h(d,{class:"col-3"},{default:s(()=>[u(o(e.$t("有效期"))+"："+o(l.endDate),1)]),_:2},1024)]),_:2},1024),h(d,{class:"right"},{default:s(()=>[h(d,{class:"right-1"},{default:s(()=>[2===l.couponType?(a(),x(b,{key:0},[h(d,{class:"zhekou"},{default:s(()=>[u(o(l.couponDiscount),1)]),_:2},1024),h(d,{class:"zhe"},{default:s(()=>[u(o(e.$t("折")),1)]),_:1})],64)):(a(),t(f,{key:1,"show-text":!1,"currency-style":{"justify-content":"flex-end",fontSize:"24rpx","padding-bottom":"8rpx"},"is-bottom":!1,"font-style":{fontSize:"48rpx"},"price-data":l.couponMoney},null,8,["price-data"]))]),_:2},1024),h(d,{class:"right-2"},{default:s(()=>[h(d,null,{default:s(()=>[1===l.status||2===l.status?(a(),t(p,{key:0,"custom-style":{height:"55rpx"},onClick:e=>(e=>{const t={couponId:e.couponId,couponName:e.couponName};w({url:"/pages/search/result?couponInfo="+encodeURIComponent(JSON.stringify(t))})})(l)},{default:s(()=>[u(o(e.$t("立即使用")),1)]),_:2},1032,["onClick"])):k("",!0),3===l.status?(a(),t(p,{key:1,disabled:!0,"custom-style":{height:"55rpx"}},{default:s(()=>[u(o(e.$t("即将生效")),1)]),_:1})):k("",!0),4===l.status?(a(),t(p,{key:2,disabled:!0,"custom-style":{height:"55rpx"}},{default:s(()=>[u(o(e.$t("已使用")),1)]),_:1})):k("",!0),5===l.status?(a(),t(p,{key:3,disabled:!0,"custom-style":{height:"55rpx"}},{default:s(()=>[u(o(e.$t("已过期")),1)]),_:1})):k("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1024),h(d,{class:"dotted-line"})]),_:2},1032,["class"]))),128))]),_:1})):k("",!0)]),_:1})):k("",!0),!F.value&&q.value&&0===q.value.length?(a(),t(d,{key:1,class:"empty-box"},{default:s(()=>[h(d,{class:"pictrue"},{default:s(()=>[h(r,{"lazy-load":"",src:N(I)("common/data_empty.png")},null,8,["src"])]),_:1}),h(d,{class:"txt"},{default:s(()=>[u(o(e.$t("暂无优惠券！")),1)]),_:1})]),_:1})):k("",!0)]),_:1},8,["title"])]),_:1})}}}),[["__scopeId","data-v-b95f2f54"]]);export{U as default};
