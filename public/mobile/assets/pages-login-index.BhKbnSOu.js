import{d as e,K as a,j as l,aw as s,a1 as t,r as o,k as u,B as i,E as n,I as c,o as d,g as r,w as p,i as v,f,t as _,a as k,c as m,J as g,F as y,M as h,ah as x,V as b,a2 as w,h as T,N as C,S as U,Q as $,ax as E,L as R,R as A,ae as I,n as S,_ as j,l as L,P as M,s as V,ay as q}from"./index-DE5OqlOG.js";import{_ as D}from"./tig-mobile-areacode.j2KAvlq4.js";import{e as F,d as O,_ as P}from"./tig-layout.fowSnIDi.js";import{V as z,a as N}from"./index.CrA6UYZE.js";var W={};const B=j(e({__name:"baseLogin",props:{loginType:{},loginTypeModifiers:{},csrfToken:{},csrfTokenModifiers:{}},emits:["update:loginType","update:csrfToken"],setup(e){const{t:j}=a(),L=l(),M=s(),V=t(e,"loginType"),q=t(e,"csrfToken"),B=o(""),J=o(""),K=o(W.VITE_DEFAULT_USER_NAME||""),Q=o(W.VITE_DEFAULT_USER_PASSWORD||""),X=o(!1),G=o(""),H=o(!1),Y=o(),Z=o("86"),ee=u(()=>"password"===V.value?!K.value||!Q.value:!B.value||!J.value||!G.value),ae=e=>{e&&U({url:e})},le=e=>{B.value=e.detail.value},se=e=>{J.value=e.detail.value},te=e=>{$({title:e,duration:1500,icon:"none"})},oe=()=>{if(!X.value)return $({title:j("请先同意用户协议"),duration:1500,icon:"none"});ie()},ue=()=>{V.value="mobile"===V.value?"password":"mobile",K.value=W.VITE_DEFAULT_USER_NAME||"",Q.value=W.VITE_DEFAULT_USER_PASSWORD||"",B.value="",J.value="",G.value="",X.value=!1},ie=async()=>{try{H.value=!0;const e={loginType:V.value,username:K.value,password:Q.value,mobile:"",mobileCode:"",verifyToken:G.value};"mobile"===V.value&&(e.mobile=L.isOpenMobileAreaCode?Z.value+B.value:B.value,e.mobileCode=J.value);const a=await E(e,{"X-CSRF-Token":q.value});M.setToken(a.token),M.getUserInfo(),$({title:j("登录成功"),duration:1e3});const l=R("URL");setTimeout(()=>{l?U({url:l,success:()=>{A("URL")}}):I({url:"/pages/index/index"})},800)}catch(e){1002==e.code&&Y.value?Y.value.show():e.code>0&&($({title:e.message,duration:1500,icon:"none"}),J.value="")}finally{H.value=!1}},ne=e=>{G.value=e.verifyToken,ie()},ce=o("password"),de=()=>{ce.value="password"===ce.value?"text":"password"},re=e=>{K.value=e.detail.value},pe=e=>{Q.value=e.detail.value},ve=()=>{S({url:"/pages/reset/index"})};return(e,a)=>{const l=v,s=i(n("tig-mobile-areacode"),D),t=h,o=i(n("tig-button"),F),u=w,U=T,$=i(n("tig-checkbox"),O),E=i(n("tig-layout"),P);return d(),c(g,null,[r(E,{title:"登录"},{default:p(()=>[r(l,{class:"login-box"},{default:p(()=>[r(l,{class:"wechat-login-warp"},{default:p(()=>[r(l,{class:"plr-40"},{default:p(()=>[r(l,{class:"h1_tit"},{default:p(()=>[f(_(e.$t("mobile"===V.value?"手机登录":"账号登录")),1)]),_:1}),r(l,{class:"form-box"},{default:p(()=>[r(l,{class:"form"},{default:p(()=>["mobile"===V.value?(d(),c(g,{key:0},[r(l,{class:"item"},{default:p(()=>[r(l,{class:"text mobileareacode-box"},{default:p(()=>[y(L).isOpenMobileAreaCode?(d(),m(s,{key:0,modelValue:Z.value,"onUpdate:modelValue":a[0]||(a[0]=e=>Z.value=e)},null,8,["modelValue"])):k("",!0),r(t,{type:"text",value:B.value,placeholder:e.$t("请输入手机号"),"placeholder-class":"placeholder",class:"mobile-text","adjust-position":!1,onInput:le},null,8,["value","placeholder"])]),_:1})]),_:1}),r(l,{class:"item mobile_code_text"},{default:p(()=>[r(l,{style:{width:"68%","margin-right":"10rpx"}},{default:p(()=>[r(t,{type:"text",placeholder:e.$t("手机短信验证码"),"placeholder-class":"placeholder",value:J.value,name:"mobile_code","adjust-position":!1,class:"text",onInput:se},null,8,["placeholder","value"])]),_:1}),r(z,{"is-checked":X.value,"onUpdate:isChecked":a[1]||(a[1]=e=>X.value=e),"verify-token-data":G.value,"onUpdate:verifyTokenData":a[2]||(a[2]=e=>G.value=e),style:{height:"65rpx"},mobile:y(L).isOpenMobileAreaCode?Z.value+B.value:B.value,"request-api":y(x),onMobileErrorCallback:te},null,8,["is-checked","verify-token-data","mobile","request-api"])]),_:1})],64)):k("",!0),"password"===V.value?(d(),c(g,{key:1},[r(l,{class:"item"},{default:p(()=>[r(t,{type:"text",placeholder:e.$t(1===y(L).openEmailRegister?"用户名/手机/邮箱":"用户名/手机号"),"placeholder-class":"placeholder",class:"text username-text",value:K.value,"adjust-position":!1,onInput:re},null,8,["placeholder","value"])]),_:1}),"password"==ce.value?(d(),m(l,{key:0,class:"item"},{default:p(()=>[r(t,{type:"password",placeholder:e.$t("请输入密码"),"placeholder-class":"placeholder",class:"text password-text",value:Q.value,"adjust-position":!1,onInput:pe},null,8,["placeholder","value"]),r(l,{class:"password_show_hide iconfont icon-yincang",onClick:de})]),_:1})):k("",!0),"text"==ce.value?(d(),m(l,{key:1,class:"item"},{default:p(()=>[r(t,{type:"text",placeholder:e.$t("请输入密码"),"placeholder-class":"placeholder",class:"text password-text",value:Q.value,"adjust-position":!1,onInput:pe},null,8,["placeholder","value"]),r(l,{class:"password_show_hide iconfont icon-xianshi",onClick:de})]),_:1})):k("",!0)],64)):k("",!0),r(l,{class:"btn2-css3"},{default:p(()=>[r(o,{"loading-text":e.$t("登录中"),loading:H.value,disabled:ee.value,onClick:oe},{default:p(()=>[f(_(e.$t("确 认")),1)]),_:1},8,["loading-text","loading","disabled"])]),_:1}),r(l,{class:b(["desc-box",{flex:"password"===V.value}])},{default:p(()=>["password"===V.value?(d(),m(l,{key:0,class:"",onClick:ve},{default:p(()=>[f(_(e.$t("忘记密码"))+"?",1)]),_:1})):k("",!0)]),_:1},8,["class"]),0===y(L).shopRegClosed?(d(),m(l,{key:2,class:"register"},{default:p(()=>[f(_(e.$t("没有账号"))+"？ ",1),r(u,{"open-type":"redirect",url:"/pages/register/index",class:"special-color"},{default:p(()=>[f(_(e.$t("立即注册")),1)]),_:1})]),_:1})):k("",!0)]),_:1})]),_:1})]),_:1})]),_:1}),r(l,{class:"btns-box"},{default:p(()=>[r(l,{class:"quick-login"},{default:p(()=>[r(l,{class:"login-dtit"},{default:p(()=>[r(U,{class:"tit"},{default:p(()=>[f(_(e.$t("其他登录方式")),1)]),_:1}),r(U,{class:"line1 line"}),r(U,{class:"line2 line"})]),_:1}),r(l,{class:"quick-type-box"},{default:p(()=>["password"===V.value?(d(),m(l,{key:0,class:"quick-type",onClick:ue},{default:p(()=>[r(l,{class:"go-link icon-mobile"}),r(l,{class:"text"},{default:p(()=>[f(_(e.$t("手机号登录")),1)]),_:1})]),_:1})):k("",!0),"mobile"===V.value?(d(),m(l,{key:1,class:"quick-type",onClick:ue},{default:p(()=>[r(l,{class:"go-link icon-userlogin"}),r(l,{class:"text"},{default:p(()=>[f(_(e.$t("账号登入")),1)]),_:1})]),_:1})):k("",!0)]),_:1})]),_:1}),r(l,{class:"rule-text",onClick:a[6]||(a[6]=e=>X.value=!X.value)},{default:p(()=>[r($,{checked:X.value,"onUpdate:checked":a[3]||(a[3]=e=>X.value=e)},null,8,["checked"]),r(l,{class:"rule-xieyi"},{default:p(()=>[r(U,null,{default:p(()=>[f(_(e.$t("我已阅读并同意")),1)]),_:1}),r(U,{class:"special-color",onClick:a[4]||(a[4]=C(e=>ae("/pages/login/mallAgreement?articleSn=fwxy"),["stop"]))},{default:p(()=>[f(" 《"+_(e.$t("服务协议"))+"》 ",1)]),_:1}),r(U,null,{default:p(()=>[f(_(e.$t("和")),1)]),_:1}),r(U,{class:"special-color",onClick:a[5]||(a[5]=C(e=>ae("/pages/login/mallAgreement?articleSn=ysxy"),["stop"]))},{default:p(()=>[f(" 《"+_(e.$t("隐私协议"))+"》 ",1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),r(N,{ref_key:"verifyRef",ref:Y,mode:"pop","captcha-type":"blockPuzzle","img-size":{width:"310px",height:"155px"},onOkCallback:ne},null,512)],64)}}}),[["__scopeId","data-v-a3a58182"]]),J=j(e({__name:"index",setup(e){const a=s(),l=o("password"),t=o({});L(e=>{e&&(e.loginType&&(l.value=e.loginType),e.url&&M("URL",e.url),e.code&&(t.value=e)),i()}),V(()=>{(R("token")||a.token)&&I({url:"/pages/index/index"})});const u=o(""),i=async()=>{try{const e=await q();u.value=e}catch(e){console.error("获取CSRF Token失败:",e)}};return(e,a)=>{const s=v;return d(),m(s,null,{default:p(()=>[r(B,{"csrf-token":u.value,"onUpdate:csrfToken":a[0]||(a[0]=e=>u.value=e),"login-type":l.value,"onUpdate:loginType":a[1]||(a[1]=e=>l.value=e)},null,8,["csrf-token","login-type"])]),_:1})}}}),[["__scopeId","data-v-b8b65f3c"]]);export{J as default};
