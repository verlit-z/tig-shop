import{d as e,a6 as a,k as t,B as l,E as u,bi as s,c as i,o as d,_ as c,a0 as r,K as o,j as n,r as v,i as m,N as p,w as f,aB as k,n as b,Q as y,a5 as g,U as x,I as _,J as h,g as S,a as I,Z as V,h as N,f as $,b as w,F as C,G as E,t as P,O as T,V as j,ab as L,aT as z}from"./index-DE5OqlOG.js";import{_ as A}from"./tig-image.h_tgFjnN.js";import{_ as U}from"./format-price.Cc34639m.js";import{_ as B}from"./uni-icons.BITEJ68A.js";import{_ as O}from"./uni-number-box.JWQxtRhY.js";import{b as Q}from"./tig-layout.fowSnIDi.js";import{j as W,k as q,h as D}from"./product.xxdbZFp6.js";const F=c(e({__name:"tig-number-box",props:{modelValue:{type:Number,default:1},max:{type:Number,default:99},min:{type:Number,default:1},inputWidth:{type:[String,Number],default:35},buttonSize:{type:[String,Number],default:30},buttonWidth:{type:[String,Number],default:35},iconStyle:{type:String,default:""},disabled:{type:Boolean,default:!1}},emits:["update:modelValue","overlimit","change"],setup(e,{emit:c}){a(e=>({"280613e4":m.value}));const r=e,o=c,n=t({get:()=>r.modelValue,set(e){o("update:modelValue",e),o("change",e)}}),v=e=>{o("overlimit",e)},m=t(()=>r.buttonWidth+"px");return(a,t)=>{const c=l(u("up-number-box"),s);return d(),i(c,{modelValue:n.value,"onUpdate:modelValue":t[0]||(t[0]=e=>n.value=e),"icon-style":e.iconStyle,"button-size":e.buttonSize,min:e.min,max:e.max,"input-width":e.inputWidth,disabled:e.disabled,onOverlimit:v,onChange:t[1]||(t[1]=()=>{})},null,8,["modelValue","icon-style","button-size","min","max","input-width","disabled"])}}}),[["__scopeId","data-v-77dd584a"]]),G=e=>r({url:"product/exchange/detail",method:"get",params:{id:e}}),J=e({__name:"buy",props:{id:Number,number:{type:Number},skuId:{type:Number},extraAttrIds:{type:String,default:""},disabled:{type:Boolean,default:!1},isQuick:{type:Boolean,default:!1},type:{type:String},skuItem:{type:Array}},emits:["callback"],setup(e,{emit:a}){const{t:t}=o(),l=n(),u=e,s=a,c=v(!1),g=async()=>{var e;if(!u.disabled)try{if(c.value)return;c.value=!0;let a={};const i={id:u.id??0,number:u.number,skuId:u.skuId,isQuick:u.isQuick?1:0};if(u.extraAttrIds&&(i.extraAttrIds=u.extraAttrIds),"exchange"===u.type)a=await(e=i,r({url:"product/exchange/addToCart",method:"post",data:e}));else a=await W(i);if(s("callback"),1==u.isQuick){if(1===l.closeOrder)return uni.$u.toast(t("商城已关闭下单"));b({url:`/pages/order/check?flowType=${a.flowType}`})}else y({title:t("加入购物车成功"),duration:1500})}catch(a){y({title:a.message,icon:"none",duration:1500})}finally{c.value=!1}};return(e,a)=>{const t=m;return d(),i(t,{class:"buy",onClick:p(g,["stop"])},{default:f(()=>[k(e.$slots,"default")]),_:3})}}}),K=c(e({__name:"specification",props:{modelValue:{type:[Number],default:0},skuId:{type:[Number],default:0},type:{type:[String],default:""}},emits:["sendValue","addCardSucceed","update:skuId","loadEnd","close"],setup(e,{expose:s,emit:c}){a(e=>({"1d49ad2a":$e.value,"8d2ac78e":we.value}));const r=e,n=c,{t:b}=o(),W=v(!1),K=()=>{n("close"),Se(),W.value=!1},Z=()=>{W.value=!0},H=v([]),M=v([]),R=v({}),X=v("0"),Y=v("0"),ee=v(""),ae=v(0),te=v(""),le=v(1),ue=v(0),se=v([]),ie=v({}),de=v(1),ce=v(0),re=v([]),oe=v([]),ne=v(!1);g(()=>r.modelValue,e=>{e&&e>0&&(le.value=1,se.value=[],R.value={},oe.value=[],ne.value=!0,(async()=>{try{let e={};"exchange"===r.type?(e=await G(r.modelValue),ie.value=e.exchangeInfo,ae.value=e.exchangeInfo.productStock,X.value=ie.value.discountsPrice||"0",ee.value=ie.value.picUrl||""):(e=await D(r.modelValue),ae.value=e.item.productStock,X.value=e.item.productPrice||"0",ee.value=e.item.picUrl||""),de.value=e.item.productType,ce.value=e.item.isBuy,te.value=e.item.productName||"",H.value=e.attrList.spe,re.value=e.attrList.extra,M.value=e.skuList,ve()}catch(e){y({title:e.message,icon:"none"}),n("loadEnd")}})())},{immediate:!0});const ve=()=>{if(H.value.length>0){if(r.skuId>0){const e=M.value.find(e=>e.skuId===r.skuId);if(e){e.skuValue.split("|").forEach((e,a)=>{se.value[a]=e})}}0===se.value.length&&(H.value.forEach((e,a)=>{e.attrList.forEach(e=>{e.checked=!1}),se.value[a]=e.attrList[0].attrName+":"+e.attrList[0].attrValue,e.attrList[0].checked=!0}),ee.value=H.value[0].attrList[0].attrPic),me()}else M.value.length>0&&(R.value=M.value[0]);ge()},me=()=>{H.value.forEach((e,a)=>{const t=se.value[a];e.attrList.forEach(e=>{const l=`${e.attrName}:${e.attrValue}`;e.checked=t===l;const u=[...se.value];u[a]=l;const s=M.value.find(e=>e.skuValue===u.join("|"));e.skuStock=s?s.skuStock:0})});const e=M.value.find(e=>e.skuValue==se.value.join("|"));e&&(R.value=e)},pe=x({id:0}),fe=v(""),ke=v(0),be=v([]),ye=v(0),ge=async()=>{if(r.type)return ne.value=!1,void n("loadEnd");if(r.modelValue){pe.id=r.modelValue,pe.skuId=R.value.skuId||null,pe.extraAttrIds=oe.value.length>0?oe.value.filter(e=>!!e).join(","):"";try{const e=await q(pe);X.value=e.price,e.originPrice&&(Y.value=e.originPrice),ae.value=e.stock,se.value.length>0&&(fe.value=se.value.map(e=>e.split(":")[1]).join(" ")),e.promotion.length>0&&he(e.promotion),ke.value&&ue.value>0?le.value=le.value>ue.value?ue.value:le.value:0===ae.value?le.value=1:le.value=le.value>ae.value?ae.value:le.value,ne.value&&Se()}catch(e){y({title:e.message,icon:"none"})}finally{ne.value=!1,n("loadEnd")}}},xe=v({seckillEndTime:"",seckillSales:0,seckillStock:0}),_e=v({discountEndTime:"",discountPrice:0}),he=e=>{be.value=e.filter(e=>1!==e.type&&6!==e.type);const a=e.find(e=>1===e.type),t=e.find(e=>6===e.type);t?(ye.value=1,_e.value.discountEndTime=t.data.item.endTime,_e.value.discountPrice=t.data.item.discountPrice):(ye.value=0,_e.value={discountEndTime:"",discountPrice:0}),a?(ke.value=1,xe.value.seckillEndTime=a.data.seckillEndTime,xe.value.seckillSales=a.data.item.seckillSales,xe.value.seckillStock=a.data.item.seckillStock,ue.value=a.data.seckillLimitNum,ae.value=a.data.item.seckillStock):(ke.value=0,xe.value={seckillEndTime:"",seckillSales:0,seckillStock:0})},Se=()=>{n("sendValue",{productOriginPrice:Y.value,productPrice:X.value,productStock:ae.value,productNumber:le.value,productSkuId:R.value.skuId,skuStr:fe.value,isSeckill:ke.value,seckillValue:xe.value,promotionList:be.value,isDiscount:ye.value,discountValue:_e.value})},Ie=()=>{K()},Ve=()=>{K(),setTimeout(()=>{n("addCardSucceed",!0)},500)},Ne=e=>{"minus"===e&&uni.$u.toast(b("商品数量不能小于1")),"plus"===e&&uni.$u.toast(b("库存不足"))},$e=t(()=>"65vh"),we=t(()=>"calc(100rpx + 15px + var(--safe-bottom))");return s({handleShowPopup:Z}),(a,t)=>{const s=m,c=l(u("tig-image"),A),r=l(u("format-price"),U),o=N,n=w,v=l(u("uni-icons"),B),b=l(u("uni-number-box"),O),y=l(u("tig-number-box"),F),g=V,x=l(u("tig-popup"),Q);return d(),_(h,null,[S(s,{onClick:Z},{default:f(()=>[k(a.$slots,"default",{},void 0,!0)]),_:3}),S(x,{show:W.value,"onUpdate:show":t[3]||(t[3]=e=>W.value=e),"z-index":999,"show-close":!1,onClose:Ie},{default:f(()=>[S(g,{"scroll-y":"true",class:"specification"},{default:f(()=>[S(s,{class:"product-sku-box flex justify-between"},{default:f(()=>[S(s,{class:"product-info"},{default:f(()=>[S(s,{class:"product-info-img",onClick:t[0]||(t[0]=e=>(e=>{if(!e)return;let a=L(e);z({urls:[a],current:a})})(ee.value))},{default:f(()=>[S(c,{src:ee.value},null,8,["src"])]),_:1}),S(s,{class:"info"},{default:f(()=>[S(s,{class:"price"},{default:f(()=>["exchange"===e.type?(d(),i(s,{key:0,class:"exchange-box"},{default:f(()=>[S(r,{"font-style":{fontSize:"32rpx"},"currency-style":{fontSize:"22rpx"},"decimals-style":{fontSize:"25rpx"},"price-data":X.value},null,8,["price-data"]),S(o,{class:"exchange-icon"},{default:f(()=>[$("+")]),_:1}),S(n,{class:"exchange-img",src:C(E)("exchange/exchange.png")},null,8,["src"]),S(o,{class:"exchange-text"},{default:f(()=>[$(P(ie.value.exchangeIntegral),1)]),_:1})]),_:1})):(d(),i(r,{key:1,"font-style":{fontSize:"32rpx"},"currency-style":{fontSize:"22rpx"},"decimals-style":{fontSize:"24rpx"},"price-data":X.value},null,8,["price-data"]))]),_:1}),ye.value||ke.value?(d(),i(s,{key:0,class:"ticket"},{default:f(()=>[S(s,{class:"ticket-content"},{default:f(()=>[$(P(ke.value?a.$t("秒杀价"):a.$t("限时折扣")),1)]),_:1})]),_:1})):I("",!0),Y.value&&Number(Y.value)>Number(X.value)?(d(),i(s,{key:1,class:"del-box"},{default:f(()=>[S(r,{"is-bottom":!1,"price-data":Y.value,"font-style":{"text-decoration":"line-through"}},null,8,["price-data"])]),_:1})):I("",!0),S(s,{class:"name line2"},{default:f(()=>[$(P(te.value),1)]),_:1})]),_:1})]),_:1}),S(s,{class:"popup-close",onClick:K},{default:f(()=>[S(v,{type:"closeempty",size:"24",style:{color:"#c8c9cc"}})]),_:1})]),_:1}),S(s,null,{default:f(()=>[H.value.length>0?(d(),i(s,{key:0,class:"product-sku-info"},{default:f(()=>[(d(!0),_(h,null,T(H.value,(e,a)=>(d(),i(s,{key:a,class:"sku-item"},{default:f(()=>[S(s,{class:"tit"},{default:f(()=>[$(P(e.attrName),1)]),_:2},1024),S(s,{class:"sku-tag flex"},{default:f(()=>[(d(!0),_(h,null,T(e.attrList,(e,t)=>(d(),i(s,{key:t,class:j("tag "+(e.checked?"checked ":0==e.skuStock?"disabled":"")),onClick:e=>((e,a)=>{const t=H.value[e].attrList[a];0===e&&(ee.value=t.attrPic),se.value[e]=t.attrName+":"+t.attrValue,me(),ge()})(a,t)},{default:f(()=>[e.attrPicThumb&&0===a?(d(),i(s,{key:0,class:"tag-img"},{default:f(()=>[S(c,{src:e.attrPicThumb},null,8,["src"])]),_:2},1024)):I("",!0),S(s,{class:"tag-text"},{default:f(()=>[$(P(e.attrValue),1)]),_:2},1024)]),_:2},1032,["class","onClick"]))),128))]),_:2},1024)]),_:2},1024))),128))]),_:1})):I("",!0),S(s,{class:"product-sku-info"},{default:f(()=>[S(s,{class:"num-item"},{default:f(()=>[S(s,{class:"tit"},{default:f(()=>[$(P(a.$t("购买数量")),1)]),_:1}),S(s,{class:"sku-num flex align-center"},{default:f(()=>[ke.value&&ue.value>0?(d(),_(h,{key:0},[S(b,{modelValue:le.value,"onUpdate:modelValue":t[1]||(t[1]=e=>le.value=e),min:1,max:ue.value,width:60},null,8,["modelValue","max"]),S(s,{class:"stock"},{default:f(()=>[$(P(a.$t("限购"))+"：",1),S(o,{style:{color:"var(--general)"}},{default:f(()=>[$(P(ue.value)+P(a.$t("件")),1)]),_:1})]),_:1})],64)):(d(),_(h,{key:1},[S(y,{modelValue:le.value,"onUpdate:modelValue":t[2]||(t[2]=e=>le.value=e),min:1,max:ae.value,onOverlimit:Ne},null,8,["modelValue","max"]),S(s,{class:"stock"},{default:f(()=>[$(P(a.$t("库存"))+"：",1),ae.value>50?(d(),i(o,{key:0,style:{color:"var(--general)"}},{default:f(()=>[$(P(a.$t("充足")),1)]),_:1})):0===ae.value?(d(),i(o,{key:1,style:{color:"var(--general)"}},{default:f(()=>[$(P(a.$t("缺货")),1)]),_:1})):(d(),i(o,{key:2,style:{color:"var(--general)"}},{default:f(()=>[$(P(a.$t("仅剩"))+P(ae.value)+"件",1)]),_:1}))]),_:1})],64))]),_:1})]),_:1})]),_:1})]),_:1}),re.value.length>0?(d(),i(s,{key:0,class:"product-sku-info attribute"},{default:f(()=>[(d(!0),_(h,null,T(re.value,(e,a)=>(d(),i(s,{key:a,class:"attribute-item"},{default:f(()=>[S(s,{class:"item-title"},{default:f(()=>[$(P(e.attrName),1)]),_:2},1024),S(s,{class:"item-content"},{default:f(()=>[(d(!0),_(h,null,T(e.attrList,e=>(d(),i(s,{key:e.attributesId,class:j(["item-attr",{checked:oe.value[a]===e.attributesId}]),onClick:p(t=>((e,a)=>{oe.value[e]&&oe.value[e]===a?oe.value[e]=null:oe.value[e]=a,ge()})(a,e.attributesId),["stop"])},{default:f(()=>[S(s,{class:"label"},{default:f(()=>[$(P(e.attrValue),1)]),_:2},1024),S(r,{class:"value","price-data":e.attrPrice},null,8,["price-data"])]),_:2},1032,["class","onClick"]))),128))]),_:2},1024)]),_:2},1024))),128))]),_:1})):I("",!0)]),_:1}),4!==de.value||1!==ce.value?(d(),i(s,{key:0,class:"footer"},{default:f(()=>["exchange"===e.type?(d(),i(s,{key:0,class:"exchange-btn"},{default:f(()=>[S(J,{id:ie.value.id,"sku-id":R.value.skuId,disabled:0==ae.value,"extra-attr-ids":pe.extraAttrIds,number:le.value,"is-quick":!0,type:e.type,onCallback:K},{default:f(()=>[S(s,{class:j(["btn",0===ae.value?"disabled-div":""])},{default:f(()=>[$(P(a.$t("立即兑换")),1)]),_:1},8,["class"])]),_:1},8,["id","sku-id","disabled","extra-attr-ids","number","type"])]),_:1})):(d(),_(h,{key:1},[1===de.value?(d(),i(s,{key:0,class:"add_cart"},{default:f(()=>[S(J,{id:Number(e.modelValue),"sku-id":R.value.skuId,disabled:0==ae.value,"extra-attr-ids":pe.extraAttrIds,number:le.value,onCallback:Ve},{default:f(()=>[S(s,{class:j(["btn cart",0===ae.value?"disabled-div":""])},{default:f(()=>[$(P(a.$t("加入购物车")),1)]),_:1},8,["class"])]),_:1},8,["id","sku-id","disabled","extra-attr-ids","number"]),S(J,{id:Number(e.modelValue),"sku-id":R.value.skuId,disabled:0==ae.value,"extra-attr-ids":pe.extraAttrIds,number:le.value,"is-quick":!0,onCallback:K},{default:f(()=>[S(s,{class:j(["btn buy-right",0===ae.value?"disabled-div":""])},{default:f(()=>[$(P(a.$t("立即购买")),1)]),_:1},8,["class"])]),_:1},8,["id","sku-id","disabled","extra-attr-ids","number"])]),_:1})):(d(),i(s,{key:1,class:"exchange-btn"},{default:f(()=>[S(J,{id:e.modelValue,"sku-id":R.value.skuId,disabled:0==ae.value,"extra-attr-ids":pe.extraAttrIds,number:le.value,"is-quick":!0,type:e.type,onCallback:K},{default:f(()=>[S(s,{class:j(["btn",0===ae.value?"disabled-div":""])},{default:f(()=>[$(P(a.$t("立即购买")),1)]),_:1},8,["class"])]),_:1},8,["id","sku-id","disabled","extra-attr-ids","number","type"])]),_:1}))],64))]),_:1})):I("",!0)]),_:1},8,["show"])],64)}}}),[["__scopeId","data-v-c4569433"]]);export{F as _,G as g,K as s};
