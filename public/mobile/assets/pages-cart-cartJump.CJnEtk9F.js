import{d as t,K as a,j as e,a8 as l,r as s,s as c,x as o,L as i,a9 as u,aa as n,k as r,c as d,w as f,B as h,E as k,o as m,I as p,g as _,J as v,a as y,i as g,f as b,t as x,h as C,O as $,V as I,a2 as w,b as j,F as D,ab as V,H as S,ac as A,n as E,Q as z,_ as U}from"./index-DE5OqlOG.js";import{_ as T,c as P,d as O}from"./tig-layout.fowSnIDi.js";import{_ as W}from"./format-price.Cc34639m.js";import{_ as B}from"./specification.BJJ9B7ka.js";import{_ as q,a as L}from"./uni-swipe-action.BWIh5ZTG.js";import{a as N}from"./activityCard.mdMMZqu3.js";import{d as F}from"./discountInfo.BS5Frnqr.js";import{r as J}from"./index.cAM2UeJZ.js";import{c as H,t as K,d as Q}from"./cartEmpty.DFnDCip0.js";import{g as G,u as M,c as R,r as X,a as Y}from"./cart.GGc2DLzy.js";import{u as Z}from"./product.xxdbZFp6.js";import"./tig-image.h_tgFjnN.js";import"./uni-icons.BITEJ68A.js";import"./uni-number-box.JWQxtRhY.js";import"./masonry.CqYTyCF5.js";import"./useList.B4FtGhCx.js";const tt=U(t({__name:"cartJump",setup(t){const{t:U}=a(),tt=e(),at=l(),et=s([]),lt=s({checkedCount:0,discountAfter:0,discountCouponAmount:0,discountProductPromotionAmount:0,discountSeckillAmount:0,discountTimeDiscountAmount:0,discounts:0,productAmount:0,totalCount:0}),st=s(!1),ct=s(!1),ot=()=>{et.value.forEach(t=>{t.carts.forEach(t=>{t.isDisabled||(t.isChecked=ct.value)})}),nt(),rt()},it=()=>{ct.value=!ct.value,ot()},ut=()=>{nt(),rt()},nt=()=>{et.value.forEach(t=>{const a=t.carts.filter(t=>!t.isDisabled);t.isChecked=a.every(t=>!0===t.isChecked)}),ct.value=et.value.every(t=>!0===t.isChecked)},rt=async()=>{const t=[];et.value.forEach(a=>{a.carts.forEach(a=>{t.push({cartId:a.cartId,isChecked:a.isChecked?1:0})})});try{await M({data:t}),kt()}catch(a){console.error(a)}},dt=()=>{kt()};c(()=>{o(),kt()});const ft=s(!0),ht=s(!i("token")),kt=async()=>{u({title:U("加载中")});try{const t=await G();console.log(t),lt.value=t.total,et.value=t.cartList,ht.value=!1,nt()}catch(t){console.error(t),401===t.code&&(ht.value=!0)}finally{ft.value=!1,n()}};let mt=null;const pt=t=>{t&&"minus"===t&&uni.$u.toast(U("商品数量不能小于1")),t&&"plus"===t&&uni.$u.toast(U("库存不足"))},_t=async(t,a)=>{((t,a)=>{mt&&clearTimeout(mt),mt=setTimeout(()=>{vt(t,a)},300)})(t,a)},vt=async(t,a)=>{try{await Y({cartId:t,data:{quantity:a}}),kt()}catch(e){console.error(e),z({title:e.message,icon:"none",duration:800}),setTimeout(()=>{kt()},800)}},yt=()=>{st.value=!st.value},gt=()=>{A({title:U("提示"),content:U("确认要清空购物车吗？"),success:async t=>{t.confirm&&(await R(),kt())}})},bt=r(()=>{const t=[];return et.value.forEach(a=>{a.carts.forEach(a=>{a.isChecked&&t.push(a.cartId)})}),t||[]}),xt=()=>{if(0==bt.value.length)return uni.$u.toast(U("请选择要删除的商品"));A({title:U("提示"),content:U("确认要删除指定的商品吗？"),success:async t=>{if(t.confirm)try{await X({cartIds:bt.value}),kt()}catch(a){console.error(a)}}})},Ct=()=>{if(0!=lt.value.checkedCount)return 1===tt.closeOrder?uni.$u.toast(U("商城已关闭下单")):void E({url:"/pages/order/check"})},$t=t=>{const a=[],e=t.filter(t=>2===t.type),l=t.filter(t=>2!==t.type);return l.length>0&&a.push(l[0]),e.length>0&&a.push(e[0]),a},It=s(!1),wt=s({}),jt=s(!1),Dt=()=>{It.value&&(It.value=!1),jt.value=!jt.value},Vt=r(()=>({bottom:at.currentActiveValue>-1?"var(--tabbar-height)":"0",paddingBottom:at.currentActiveValue>-1?"0":"var(--safe-bottom)",height:at.currentActiveValue>-1?"var(--checkOutBar-height)":"calc(var(--checkOutBar-height) + var(--safe-bottom))"}));return(t,a)=>{const e=h(k("tig-navbar"),P),l=C,s=g,c=h(k("tig-checkbox"),O),o=j,i=w,u=h(k("format-price"),W),n=h(k("tig-number-box"),B),r=h(k("uni-swipe-action-item"),q),E=h(k("uni-swipe-action"),L),z=h(k("tig-layout"),T);return m(),d(z,{onLoginSuccess:dt},{default:f(()=>[ht.value?(m(),d(K,{key:1})):(m(),p(v,{key:0},[_(e,{"show-left":!0,title:"购物车"}),ft.value?y("",!0):(m(),d(s,{key:0,class:"cart-box shoppingCart"},{default:f(()=>[et.value.length>0?(m(),p(v,{key:0},[_(s,{class:"top-text"},{default:f(()=>[_(s,{class:"fl"},{default:f(()=>[b(x(t.$t("已选商品"))+" ",1),_(l,{class:"select-num"},{default:f(()=>[b(x(lt.value.checkedCount),1)]),_:1}),b(" "+x(t.$t("件")),1)]),_:1}),_(s,{class:"fr administrate acea-row row-center-wrapper",onClick:yt},{default:f(()=>[_(l,{class:"manage-btn"},{default:f(()=>[b(x(st.value?t.$t("完成"):t.$t("管理")),1)]),_:1})]),_:1})]),_:1}),_(s,{class:"cart_list_wrap"},{default:f(()=>[(m(!0),p(v,null,$(et.value,(a,e)=>(m(),d(s,{key:a.cartId,class:"cart_table"},{default:f(()=>[_(s,{class:"cart_store_title noborder"},{default:f(()=>[_(c,{checked:a.isChecked,"onUpdate:checked":t=>a.isChecked=t,size:"20",onChange:t=>(t=>{const a=et.value[t];a.carts.forEach(t=>{t.isDisabled||(t.isChecked=a.isChecked)}),nt(),rt()})(e)},null,8,["checked","onUpdate:checked","onChange"]),_(s,{class:"store_label"},{default:f(()=>[b(x(a.shopTitle?a.shopTitle:t.$t("自营")),1)]),_:2},1024)]),_:2},1024),_(s,{class:"goods-list-cart"},{default:f(()=>[_(E,null,{default:f(()=>[(m(!0),p(v,null,$(a.carts,(a,e)=>(m(),d(s,{key:a.productId,class:"cart_item"},{default:f(()=>[_(r,{threshold:0,"auto-close":""},{right:f(()=>[_(s,{class:"cart-move-box"},{default:f(()=>[_(s,{class:"btn-collect",onClick:t=>(async(t,a)=>{try{await Z({productId:t})}catch(e){console.error(e)}finally{await X({cartIds:[a]}),kt()}})(a.productId,a.cartId)},{default:f(()=>[_(l,null,{default:f(()=>[b(x(t.$t("移入收藏")),1)]),_:1})]),_:2},1032,["onClick"]),_(s,{class:"btn-del",onClick:t=>{return e=a.cartId,void A({title:U("提示"),content:U("确认要删除该的商品吗？"),success:async t=>{if(t.confirm)try{await X({cartIds:[e]}),kt()}catch(a){console.error(a)}}});var e}},{default:f(()=>[_(l,null,{default:f(()=>[b(x(t.$t("删除")),1)]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)]),default:f(()=>[_(s,{class:I(["cart_list_con",{cartItemDisabled:a.isDisabled}])},{default:f(()=>[_(c,{checked:a.isChecked,"onUpdate:checked":t=>a.isChecked=t,size:"20",class:"check-item",disabled:a.isDisabled,onChange:ut},null,8,["checked","onUpdate:checked","disabled"]),_(i,{url:`/pages/product/index?id=${a.productId}${a.skuId>0?`&sku_id=${a.skuId}`:""}`,class:"photo"},{default:f(()=>[_(s,{class:"photo-img"},{default:f(()=>[_(o,{src:D(V)(a.picThumb)},null,8,["src"]),0===a.stock?(m(),d(s,{key:0,class:"cart-notice-row"},{default:f(()=>[b(x(t.$t("已售罄")),1)]),_:1})):y("",!0),0===a.productStatus?(m(),d(s,{key:1,class:"cart-notice-row"},{default:f(()=>[b(x(t.$t("已下架")),1)]),_:1})):y("",!0)]),_:2},1024)]),_:2},1032,["url"]),_(s,{class:"cart-row"},{default:f(()=>[_(i,{target:"_blank",url:`/pages/product/index?id=${a.productId}${a.skuId>0?`&sku_id=${a.skuId}`:""}`},{default:f(()=>[_(s,{class:"name"},{default:f(()=>[b(x(a.productName),1)]),_:2},1024)]),_:2},1032,["url"]),_(s,{class:"sku-card-box"},{default:f(()=>[a.skuData&&a.skuData.length>0?(m(),d(s,{key:0,class:"sku-card"},{default:f(()=>[(m(!0),p(v,null,$(a.skuData,(t,a)=>(m(),d(s,{key:t,class:"sku-item line1"},{default:f(()=>[b(x(t.value),1)]),_:2},1024))),128))]),_:2},1024)):y("",!0)]),_:2},1024),a.activityInfo?(m(),d(s,{key:0,class:"activity-box"},{default:f(()=>[(m(!0),p(v,null,$($t(a.activityInfo),t=>(m(),d(N,{key:t.promotionId,"activity-info":t,"card-type":"sub"},null,8,["activity-info"]))),128))]),_:2},1024)):y("",!0),_(s,{class:I(["cart-price",{"cart-price-margin":!(a.skuData&&0!==a.skuData.length||a.activityInfo)}])},{default:f(()=>[_(s,{class:"price-one"},{default:f(()=>[_(u,{"show-text":!1,"font-style":{fontWeight:"bold"},"decimals-style":{fontSize:"22rpx",fontWeight:"bold"},"currency-style":{fontSize:"23rpx",fontWeight:"bold"},"price-data":a.originPrice&&a.originPrice!==a.price?a.originPrice:a.price},null,8,["price-data"])]),_:2},1024),_(s,{class:"cart-num-box"},{default:f(()=>[_(n,{modelValue:a.quantity,"onUpdate:modelValue":t=>a.quantity=t,disabled:a.isDisabled||0===a.stock,min:1,"button-width":30,max:a.stock,"input-width":"30","button-size":"30",onChange:t=>_t(a.cartId,a.quantity),onOverlimit:pt},null,8,["modelValue","onUpdate:modelValue","disabled","max","onChange"])]),_:2},1024)]),_:2},1032,["class"]),a.price&&a.originPrice!==a.price?(m(),d(s,{key:1,class:"origin-price"},{default:f(()=>[b(x(t.$t("每件预计到手"))+" ",1),_(u,{"show-text":!1,"is-bottom":!1,"price-data":a.price},null,8,["price-data"])]),_:2},1024)):y("",!0),a.extraSkuData&&a.extraSkuData.length?(m(),d(s,{key:2,class:"extraskudata",onClick:t=>(t=>{It.value=!0,wt.value=t})(a)},{default:f(()=>[1===a.extraSkuData.length?(m(!0),p(v,{key:0},$(a.extraSkuData,t=>(m(),d(s,{key:t,class:"extraskudata-item"},{default:f(()=>[_(s,{class:"title line1"},{default:f(()=>[b(x(t.attrName),1)]),_:2},1024),_(s,{class:"line-box"},{default:f(()=>[_(s,{class:"line"})]),_:1}),_(s,{class:"content"},{default:f(()=>[_(l,{class:"line1 content-text"},{default:f(()=>[b(x(t.attrValue),1)]),_:2},1024),_(u,{"show-text":!1,class:"price","price-data":t.totalAttrPrice},null,8,["price-data"]),_(l,{class:"iconfont-h5 icon-xiajiantou1-copy"})]),_:2},1024)]),_:2},1024))),128)):(m(),d(s,{key:1,class:"extraskudata-item"},{default:f(()=>[_(s,{class:"title"},{default:f(()=>[b(x(t.$t("附加")),1)]),_:1}),_(s,{class:"line-box"},{default:f(()=>[_(s,{class:"line"})]),_:1}),_(s,{class:"content"},{default:f(()=>[_(l,{class:"line1 content-text"},{default:f(()=>[b(x(`已选${a.extraSkuData.length}项`)+" ",1),_(u,{"show-text":!1,class:"price","price-data":a.serviceFee},null,8,["price-data"])]),_:2},1024),_(l,{class:"iconfont-h5 icon-xiajiantou1-copy"})]),_:2},1024)]),_:2},1024))]),_:2},1032,["onClick"])):y("",!0)]),_:2},1024)]),_:2},1032,["class"])]),_:2},1024)]),_:2},1024))),128))]),_:2},1024)]),_:2},1024),a.gift.length>0?(m(),d(s,{key:0,class:"gift-box"},{default:f(()=>[_(s,{class:"gift-title"},{default:f(()=>[b(x(t.$t("赠品")),1)]),_:1}),_(s,{class:"gift-content"},{default:f(()=>[(m(!0),p(v,null,$(a.gift,t=>(m(),d(s,{key:t.giftId,class:"gift-content-item"},{default:f(()=>[_(s,{class:"gift-item-left"},{default:f(()=>[_(o,{src:D(V)(t.picThumb)},null,8,["src"])]),_:2},1024),_(s,{class:"gift-item-right"},{default:f(()=>[_(s,{class:"gift-item-name line1"},{default:f(()=>[b(x(t.productName),1)]),_:2},1024),t.skuData.length>0?(m(),d(s,{key:0,class:"sku-card"},{default:f(()=>[(m(!0),p(v,null,$(t.skuData,(t,a)=>(m(),d(s,{key:a,class:"sku-item"},{default:f(()=>[b(x(t.value),1)]),_:2},1024))),128))]),_:2},1024)):y("",!0),_(s,{class:"gift-item-num"},{default:f(()=>[b("x"+x(t.num),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:2},1024)]),_:2},1024)):y("",!0)]),_:2},1024))),128))]),_:1}),_(s,{class:"checkOutBar",style:S(Vt.value)},{default:f(()=>[_(s,{class:"bar-check"},{default:f(()=>[_(s,{class:"checkbox-pad"},{default:f(()=>[_(c,{checked:ct.value,"onUpdate:checked":a[0]||(a[0]=t=>ct.value=t),size:"20",onChange:ot},null,8,["checked"]),_(l,{class:"checkbox-text",onClick:it},{default:f(()=>[b(x(t.$t("全选")),1)]),_:1})]),_:1})]),_:1}),st.value?(m(),d(s,{key:0,class:"edit-cart-action"},{default:f(()=>[_(s,{class:"l_a_tool lt_delete",onClick:gt},{default:f(()=>[b(x(t.$t("清空购物车")),1)]),_:1}),_(s,{class:I(["l_a_tool",{ltDisable:0===bt.value.length}]),onClick:xt},{default:f(()=>[b(x(t.$t("删除勾选商品")),1)]),_:1},8,["class"])]),_:1})):y("",!0),st.value?y("",!0):(m(),d(s,{key:1,class:"cart-total-box"},{default:f(()=>[_(s,{class:"cart-total"},{default:f(()=>[_(s,{class:I("btn-checkout "+(0==lt.value.checkedCount?"unable_btn":"")),onClick:Ct},{default:f(()=>[b(x(t.$t("去结算")),1)]),_:1},8,["class"]),_(s,{class:"item-total"},{default:f(()=>[_(s,{class:"item-total-amount"},{default:f(()=>[_(l,{class:"txt"},{default:f(()=>[b(x(t.$t("合计"))+"：",1)]),_:1}),_(u,{"show-text":!1,"price-data":lt.value.discountAfter,"font-style":{fontWeight:"bold",fontSize:"30rpx"},"currency-style":{fontSize:"22rpx",fontWeight:"bold"},"decimals-style":{fontSize:"22rpx",fontWeight:"bold"}},null,8,["price-data"])]),_:1}),_(s,{class:"item-total-desc"},{default:f(()=>[_(s,{class:""},{default:f(()=>[b(x(t.$t("共优惠"))+"：",1),_(u,{"show-text":!1,"is-bottom":!1,"price-data":lt.value.discounts},null,8,["price-data"])]),_:1}),_(s,{class:"discounts-btn",onClick:Dt},{default:f(()=>[b(x(t.$t("优惠明细"))+" ",1),_(l,{class:I(["iconfont-h5 icon-xiajiantou1-copy",{"icon-active":jt.value}])},null,8,["class"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}))]),_:1},8,["style"])],64)):y("",!0),0!==et.value.length||ft.value?y("",!0):(m(),d(H,{key:1})),_(J,{onCallback:kt})]),_:1}))],64)),_(F,{modelValue:jt.value,"onUpdate:modelValue":a[1]||(a[1]=t=>jt.value=t),total:lt.value},null,8,["modelValue","total"]),_(Q,{modelValue:It.value,"onUpdate:modelValue":a[2]||(a[2]=t=>It.value=t),detail:wt.value},null,8,["modelValue","detail"])]),_:1})}}}),[["__scopeId","data-v-972f3663"]]);export{tt as default};
