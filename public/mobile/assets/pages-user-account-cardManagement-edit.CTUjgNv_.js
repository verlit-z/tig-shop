import{d as e,K as a,r as l,k as t,a4 as u,s as o,af as r,l as c,c as n,w as s,a9 as d,aa as i,B as m,E as p,o as v,g as f,i as y,a as b,bD as _,f as g,t as h,Q as $,ap as N,ar as T,_ as V}from"./index-DE5OqlOG.js";import{_ as k,a as j}from"./uni-forms.DRg_j8ip.js";import{_ as q}from"./uni-easyinput.Cpml7ZWU.js";import{_ as x,e as w}from"./tig-layout.fowSnIDi.js";import{_ as U}from"./tig-fixed-placeholder.OF5rBWLr.js";import{f as D,h as M}from"./account.2c1rkbIz.js";import"./uni-icons.BITEJ68A.js";const A=V(e({__name:"edit",setup(e){const{t:V}=a(),A=l("添加账号"),C=l(),F=l(0),I=l([V("银行卡"),V("支付宝"),V("微信")]),R=e=>{F.value=e.detail.value,E.value.accountType=e.detail.value+1,B()},B=()=>{E.value={accountName:"",identity:"",accountNo:"",accountType:F.value+1,bankName:""}},E=l({accountType:1}),K=t(()=>{switch(E.value.accountType){case 1:return"银行卡";case 2:return"支付宝";case 3:return"微信";default:return""}}),L={accountName:{rules:[{required:!0,errorMessage:V("请输入真实姓名")}]},identity:{rules:[{required:!0,errorMessage:V("请输入身份证号码")},{validateFunction:function(e,a,l,t){return/^[1-9]\d{5}[1-9]\d{3}((0\d)|(1[0-2]))(([0|1|2]\d)|3[0-1])\d{3}([0-9]|X)$/.test(a)||t(V("请输入正确的身份证号码")),!0}}]},accountNo:{rules:[{required:!0,errorMessage:`${V("请输入正确的"+K.value+"账号")}`},{validateFunction:function(e,a,l,t){return/^\d{6,}$/.test(a)||1!==E.value.accountType||t(`${V("请输入正确的"+K.value+"账号")}`),!0}}]}},O=u(),Q=e=>{O.value.validate().then(()=>{C.value?z():X()}).catch(e=>{console.error("表单错误信息：",e)})},X=async()=>{try{await M({...E.value},"createAccount");$({title:V("添加成功"),icon:"success",duration:1e3}),setTimeout(()=>{N({success:function(e){T("refreshData",{type:E.value.accountType})}})},1e3)}catch(e){$({title:e.message,icon:"none",duration:1e3})}},z=async()=>{try{const e=await M({...E.value},"updateAccount");e.message&&$({title:e.message,icon:"success",duration:1e3}),setTimeout(()=>{N({success:function(e){T("refreshData",{type:E.value.accountType})}})},1e3)}catch(e){$({title:e.message,icon:"none",duration:1e3})}};return o(()=>{r(()=>{O.value.setRules(L)})}),c(e=>{e.id&&(C.value=e.id,A.value="编辑账号",(async()=>{d({title:V("加载中")});try{const e=await D({accountId:C.value});F.value=e.accountType-1,Object.assign(E.value,e)}catch(e){console.error(e.message)}finally{i()}})())}),(e,a)=>{const l=y,t=_,u=m(p("uni-forms-item"),k),o=m(p("uni-easyinput"),q),r=m(p("uni-forms"),j),c=m(p("tig-button"),w),d=m(p("tig-fixed-placeholder"),U),i=m(p("tig-layout"),x);return v(),n(i,{title:A.value},{default:s(()=>[f(l,{class:"card-edit-main"},{default:s(()=>[f(r,{ref_key:"formRef",ref:O,"model-value":E.value,"label-width":"170rpx"},{default:s(()=>[f(l,{class:"card-edit-content"},{default:s(()=>[C.value?(v(),n(u,{key:1,label:e.$t("卡片类型"),name:"accountType",required:""},{default:s(()=>[f(o,{"input-border":!1,placeholder:K.value,disabled:""},null,8,["placeholder"])]),_:1},8,["label"])):(v(),n(u,{key:0,label:e.$t("卡片类型"),name:"accountType",required:""},{default:s(()=>[f(t,{range:I.value,value:F.value,mode:"selector",onChange:R},{default:s(()=>[f(l,{class:"card-idx"},{default:s(()=>[g(h(I.value[F.value]),1)]),_:1})]),_:1},8,["range","value"])]),_:1},8,["label"])),f(u,{label:e.$t("真实姓名"),name:"accountName",required:""},{default:s(()=>[f(o,{modelValue:E.value.accountName,"onUpdate:modelValue":a[0]||(a[0]=e=>E.value.accountName=e),"input-border":!1,placeholder:e.$t("请输入真实姓名"),"primary-color":"rgb(192, 196, 204)"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),f(u,{label:e.$t("身份证号"),name:"identity",required:""},{default:s(()=>[f(o,{modelValue:E.value.identity,"onUpdate:modelValue":a[1]||(a[1]=e=>E.value.identity=e),"input-border":!1,placeholder:e.$t("请输入身份证号码"),"primary-color":"rgb(192, 196, 204)"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),f(u,{label:`${e.$t(K.value+"号")}`,name:"accountNo",required:""},{default:s(()=>[f(o,{modelValue:E.value.accountNo,"onUpdate:modelValue":a[2]||(a[2]=e=>E.value.accountNo=e),"input-border":!1,placeholder:`${e.$t("请输入"+K.value+"账号")}`,"primary-color":"rgb(192, 196, 204)"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),1===E.value.accountType?(v(),n(u,{key:2,label:e.$t("银行卡详情"),name:"bankName"},{default:s(()=>[f(o,{modelValue:E.value.bankName,"onUpdate:modelValue":a[3]||(a[3]=e=>E.value.bankName=e),"input-border":!1,placeholder:e.$t("请输入银行卡详情"),"primary-color":"rgb(192, 196, 204)"},null,8,["modelValue","placeholder"])]),_:1},8,["label"])):b("",!0)]),_:1})]),_:1},8,["model-value"])]),_:1}),f(d,{"background-color":"#fff"},{default:s(()=>[f(l,{class:"btn-box"},{default:s(()=>[f(c,{class:"btn",onClick:Q},{default:s(()=>[g(h(C.value?e.$t("保存修改"):e.$t("新增账号")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["title"])}}}),[["__scopeId","data-v-823a497d"]]);export{A as default};
