import{d as e,c as a,o as t,i as l,w as n,g as o,bc as r,I as u,O as i,a as s,b as c,F as d,G as p,f as y,t as f,bd as m,J as v,_ as g,r as _,V as h,ai as I,K as w,j as T,l as k,Q as b,S as x,n as S,be as C,B as P,E as $,aD as L,h as V}from"./index-DE5OqlOG.js";import{_ as j,c as W,e as X}from"./tig-layout.fowSnIDi.js";import{_ as A}from"./format-price.Cc34639m.js";import{_ as q}from"./tig-fixed-placeholder.OF5rBWLr.js";import{o as B,r as U,c as J,a as M,b as Y,d as D}from"./pay.BBOrkwEb.js";const E=g(e({__name:"payment",props:{paymentList:{},modelValue:{}},emits:["update:modelValue"],setup(e,{emit:g}){const _=g,h={wechat:"微信支付",alipay:"支付宝支付",paypal:"PayPal支付",offline:"线下支付",yabanpayWechat:"微信支付",yabanpayAlipay:"支付宝支付",yunpayWechat:"微信支付",yunpayAlipay:"支付宝支付",yunpayYunshanfu:"云闪付"},I=e=>{_("update:modelValue",e.detail.value)};return(e,g)=>{const _=c,w=l,T=m,k=r;return t(),a(w,{class:"paymentType"},{default:n(()=>[o(w,{class:"pay-list"},{default:n(()=>[o(k,{class:"radio-group",onChange:I},{default:n(()=>[(t(!0),u(v,null,i(e.paymentList,(l,r)=>(t(),a(w,{key:r,class:"item"},{default:n(()=>[o(w,{class:"payment-info"},{default:n(()=>["offline"!==l?(t(),a(_,{key:0,class:"payment-info-img",src:d(p)("payment/pay_"+l+".png")},null,8,["src"])):s("",!0),o(w,{class:"payment-info-text"},{default:n(()=>[y(f(e.$t(h[l])),1)]),_:2},1024)]),_:2},1024),o(T,{value:l,"active-background-color":"var(--general)",checked:l===e.modelValue,style:{"margin-right":"20rpx",transform:"scale(0.9)"}},null,8,["value","checked"])]),_:2},1024))),128))]),_:1})]),_:1})]),_:1})}}}),[["__scopeId","data-v-0edb26df"]]),F=g(e({__name:"offline",props:{offlinePaymentList:{}},setup(e){const r=e=>{u.value=e},u=_("银行汇款");return(e,i)=>{const c=l,d=I;return t(),a(c,{class:"offline-warp"},{default:n(()=>[o(c,{class:"offline-menu"},{default:n(()=>[o(c,{class:h(["offline-menu-item",{active:"银行汇款"===u.value}]),onClick:i[0]||(i[0]=e=>r("银行汇款"))},{default:n(()=>[y(f(e.$t("银行汇款")),1)]),_:1},8,["class"]),o(c,{class:h(["offline-menu-item",{active:"企业汇款"===u.value}]),onClick:i[1]||(i[1]=e=>r("企业汇款"))},{default:n(()=>[y(f(e.$t("企业汇款")),1)]),_:1},8,["class"])]),_:1}),"银行汇款"===u.value?(t(),a(c,{key:0,class:"offline-content"},{default:n(()=>{var a;return[o(d,{nodes:null==(a=e.offlinePaymentList)?void 0:a.offlinePayBank},null,8,["nodes"])]}),_:1})):s("",!0),"企业汇款"===u.value?(t(),a(c,{key:1,class:"offline-content"},{default:n(()=>{var a;return[o(d,{nodes:null==(a=e.offlinePaymentList)?void 0:a.offlinePayCompany},null,8,["nodes"])]}),_:1})):s("",!0)]),_:1})}}}),[["__scopeId","data-v-4ba0db91"]]),G=g(e({__name:"pay",setup(e){const{t:r}=w(),u=T(),i=_("订单支付"),c=_(!1),d=_([]),p=_(!1),m=_({}),v=_("wechat"),g=_(),h=_(null),I=_(""),G=_(""),H=_(null);k(e=>{e&&e.orderId&&(e.type?(I.value=e.type,i.value="充值支付",N(e.orderId)):K(e.orderId))});const K=async e=>{c.value=!0;try{const a=await B(e);g.value=a.order,d.value=a.paymentList,v.value=d.value[0],m.value=a.offlinePaymentList,H.value=a.order.orderId,G.value=3===a.order.payTypeId?"线下支付":"在线支付"}catch(a){b({title:a.message,duration:1500,icon:"none"}),setTimeout(function(){x({url:"/pages/user/order/list",mode:"redirectTo"})},1500)}finally{c.value=!1}},N=async e=>{try{const a=await U({orderId:e});g.value=a.order,d.value=a.paymentList,v.value=d.value[0],H.value=a.order.orderId}catch(a){b({title:a.message,duration:1500,icon:"none"}),setTimeout(function(){S({url:"/pages/user/account/index"})},1500)}finally{c.value=!1}};let O=null;const Q=_(0),R=async()=>{p.value=!0;try{if(H.value){let e;e="recharge"===I.value?await z():await Z(),e&&("alipay"===v.value&&("h5"===u.XClientType&&ne(e.payInfo.html),"app"===u.XClientType&&ue(e.payInfo)),"wechat"!==v.value&&"yunpayWechat"!==v.value||("h5"===u.XClientType&&window.open(e.payInfo.url,"_blank"),"miniProgram"===u.XClientType&&oe(e.payInfo),"wechat"===u.XClientType&&re(e.payInfo),"app"===u.XClientType&&ue(e.payInfo)),"yabanpayWechat"===v.value&&(window.location.href=e.payInfo.url),"yabanpayAlipay"===v.value&&(window.location.href=e.payInfo.url),"paypal"===v.value&&(window.location.href=e.payInfo.url),"yunpayAlipay"===v.value&&(window.location.href=e.payInfo.codeUrl),"yunpayYunshanfu"===v.value&&(window.location.href=e.payInfo.codeUrl),O=setInterval(()=>{"recharge"===I.value?le():te(),Q.value++,50===Q.value&&(clearInterval(O),b({title:r("支付已超时"),duration:1500,icon:"none"}),"recharge"===I.value?x({url:"/pages/user/account/index",mode:"redirectTo"}):x({url:"/pages/user/order/list",mode:"redirectTo"}))},2e3))}}catch(e){b({title:e.message,duration:1500,icon:"none"})}finally{p.value=!1}},z=async()=>{let e;return e=await ae(),e},Z=async()=>{let e;return e=await ee(),e},ee=async e=>{let a;try{const e={id:H.value,type:v.value};a=await J(e)}catch(t){b({title:t.message,duration:1500,icon:"none"})}finally{return a}},ae=async e=>{let a;try{const e={id:H.value,type:v.value};a=await M(e)}catch(t){b({title:t.message,duration:1500,icon:"none"})}finally{return a}},te=async()=>{try{1==await Y({id:H.value})&&(clearInterval(O),setTimeout(function(){x({url:`/pages/order/payStatus?id=${H.value}`,mode:"redirectTo"})},1500))}catch(e){}},le=async()=>{try{1==await D({id:H.value})&&(clearInterval(O),b({title:r("支付成功"),duration:1500,icon:"none"}),setTimeout(function(){x({url:"/pages/user/account/index",mode:"redirectTo"})},1500))}catch(e){}},ne=e=>{if(h.value){h.value.innerHTML=e;const a=document.forms;a&&a[0].submit()}},oe=e=>{wx.requestPayment({timeStamp:String(e.timeStamp),nonceStr:e.nonceStr,package:e.package,signType:e.signType,paySign:e.paySign,success(e){b({title:r("支付成功"),duration:1500}),setTimeout(function(){"recharge"===I.value?x({url:"/pages/user/account/index",mode:"redirectTo"}):x({url:`/pages/order/payStatus?id=${H.value}`,mode:"redirectTo"})},1500)},fail(e){b({title:r("支付失败"),duration:1500,icon:"none"}),setTimeout(()=>{"recharge"===I.value?x({url:"/pages/user/account/index",mode:"redirectTo"}):x({url:"/pages/user/order/list",mode:"redirectTo"})},1500)}})},re=e=>{WeixinJSBridge.invoke("getBrandWCPayRequest",{...e},function(e){e.errMsg})},ue=e=>{"wechat"!==v.value?uni.requestPayment({provider:e.provider,orderInfo:e.orderInfo,success(){b({title:r("支付成功"),duration:1500,icon:"none"})},fail(){b({title:r("支付失败"),duration:1500,icon:"none"}),O&&clearInterval(O)},complete(){}}):uni.requestPayment({provider:"wxpay",orderInfo:{appid:e.appId,noncestr:e.nonceStr,package:e.package,partnerid:String(e.partnerId),prepayid:e.prepayId,timestamp:e.timeStamp,sign:e.sign},success(){b({title:r("支付成功"),duration:1500,icon:"none"})},fail(){b({title:r("支付失败"),duration:1500,icon:"none"}),O&&clearInterval(O)},complete(){}})};return C(()=>{I.value="",clearInterval(O)}),(e,r)=>{const u=P($("tig-navbar"),W),_=l,w=P($("format-price"),A),T=V,k=P($("tig-button"),X),b=P($("tig-fixed-placeholder"),q),x=P($("tig-layout"),j);return t(),a(x,null,{default:n(()=>[o(u,{title:i.value},null,8,["title"]),c.value?(t(),a(_,{key:0,class:"page-loading"},{default:n(()=>[o(_,{class:"ico"})]),_:1})):s("",!0),g.value?(t(),a(_,{key:1,class:"order-pay-warp"},{default:n(()=>[o(_,{class:"order_infos"},{default:n(()=>[o(_,{class:"order_amount"},{default:n(()=>["recharge"!==I.value?(t(),a(w,{key:0,"is-bootom":!1,"price-data":g.value.unpaidAmount},null,8,["price-data"])):(t(),a(w,{key:1,"is-bootom":!1,"price-data":g.value.amount},null,8,["price-data"]))]),_:1}),"recharge"!==I.value?(t(),a(_,{key:0,class:"order_sn"},{default:n(()=>[y(f(e.$t("订单号"))+"： ",1),o(T,null,{default:n(()=>[y(f(g.value.orderSn),1)]),_:1})]),_:1})):s("",!0)]),_:1}),3!==g.value.payTypeId?(t(),a(E,{key:0,modelValue:v.value,"onUpdate:modelValue":r[0]||(r[0]=e=>v.value=e),"payment-list":d.value},null,8,["modelValue","payment-list"])):s("",!0),3===g.value.payTypeId?(t(),a(F,{key:1,"offline-payment-list":m.value},null,8,["offline-payment-list"])):s("",!0),"recharge"!==I.value?(t(),a(_,{key:2,class:"other-info"},{default:n(()=>[o(_,{class:"tit"},{default:n(()=>[y(f(e.$t("其它信息")),1)]),_:1}),o(_,{class:"item"},{default:n(()=>[y(f(e.$t("支付方式："))+" ",1),o(T,null,{default:n(()=>[y(f(e.$t(G.value)),1)]),_:1})]),_:1}),o(_,{class:"item"},{default:n(()=>[y(f(e.$t("配送方式"))+"： ",1),o(T,null,{default:n(()=>[y(f(g.value.shippingTypeName||e.$t("专线物流")),1)]),_:1})]),_:1}),o(_,{class:"item"},{default:n(()=>[y(f(e.$t("下单时间"))+"： ",1),o(T,null,{default:n(()=>[y(f(g.value.addTime),1)]),_:1})]),_:1})]),_:1})):s("",!0),3!==g.value.payTypeId?(t(),a(b,{key:3,"background-color":"#fff"},{default:n(()=>[o(_,{class:"btn-box"},{default:n(()=>[o(k,{disabled:p.value,onClick:R},{default:n(()=>[y(f(e.$t("立即支付")),1)]),_:1},8,["disabled"])]),_:1})]),_:1})):s("",!0)]),_:1})):s("",!0),L("div",{ref_key:"formContainer",ref:h},null,512)]),_:1})}}}),[["__scopeId","data-v-0ca19161"]]);export{G as default};
