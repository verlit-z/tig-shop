import{d as e,K as a,r as l,k as t,l as o,ak as s,U as u,m as c,al as n,s as r,Q as i,q as d,c as p,w as f,a9 as v,aa as m,B as y,E as _,a6 as b,G as k,a7 as g,o as h,I as x,a as C,J as $,g as S,i as j,b as z,F as N,f as w,t as I,V as A,h as M,O as D,W as O,X as P,n as T,S as q,_ as E}from"./index-DE5OqlOG.js";import{_ as R}from"./format-price.Cc34639m.js";import{_ as U}from"./tig-image.h_tgFjnN.js";import{_ as V}from"./empty-box.vue_vue_type_script_setup_true_lang.tb7lKy_c.js";import{_ as W}from"./tig-fixed-placeholder.OF5rBWLr.js";import{_ as B}from"./tig-back-top.vue_vue_type_script_setup_true_lang.Dshf9tCI.js";import{u as F,_ as G}from"./tig-layout.fowSnIDi.js";import{c as H,d as J,a as K}from"./coupon.cwyGQYgg.js";import{g as L}from"./search.BFVjb5qq.js";import{s as Q}from"./specification.BJJ9B7ka.js";import"./uni-icons.BITEJ68A.js";import"./uni-number-box.JWQxtRhY.js";import"./product.xxdbZFp6.js";const X=E(e({__name:"detail",setup(e){b(e=>({"72e277a4":be.value}));const{t:E}=a(),{scrollTop:X}=F(),Y=l({}),Z=l(),ee=l(),ae=async()=>{v({title:E("加载中")});try{if(Z.value){const e=await J({id:Z.value});Y.value=e}}catch(e){console.error(e)}finally{m()}},le=t(()=>0===Y.value.limitNum?1===Y.value.isReceive?"已领取":"马上领":0===Y.value.isReceive?"马上领":Y.value.receiveNum>=Y.value.limitNum?"已领取":"再次领取");o(e=>{s("coupon-search-return",e=>{oe.keyword=e,oe.keyword=e,ce(),de()}),e&&(e.id&&(Z.value=Number(e.id),oe.couponId=Z.value),de())}),c(()=>{n("coupon-search-return")}),r(()=>{Z.value&&(ae(),me())});const te=async()=>{if("已领取"===le.value)return i({title:E("已领取"),icon:"none",duration:1500});try{Z.value&&(await K({couponId:Z.value}),ae(),i({title:E("领取成功"),duration:1500}))}catch(e){i({title:e.message,icon:"none",duration:1500}),console.error(e)}},oe=u({page:1,size:20,sort:"",order:"asc",keyword:"",couponId:0}),se=l("default"),ue=l([{label:"默认",value:"default"},{label:"销量",value:"sale"},{label:"价格",value:"price",order:"desc"}]),ce=()=>{ie.value=[],oe.page=1},ne=l(0),re=l(!0),ie=l([]),de=async()=>{try{const e=await L({...oe});ne.value=e.total,e.records.forEach(e=>e.isCheck=!1),ie.value=[...ie.value,...e.records]}catch(e){i({title:e.message,icon:"none"})}finally{re.value=!1}},pe=()=>{T({url:"/pages/coupon/search"})},fe=l({minOrderAmount:"0",couponMoney:"0",productPrice:"0",discountMoney:"0",couponUnit:0,quantityCount:0}),ve=t(()=>{let e="";return e=0==Number(fe.value.productPrice)?E("快去选购商品参与优惠活动"):1===fe.value.couponUnit?Number(fe.value.productPrice)>Number(fe.value.minOrderAmount)?`已满足优惠条件，用券下单立减${fe.value.discountMoney}元`:`还需${Number(fe.value.minOrderAmount)-Number(fe.value.productPrice)}元，即可用券下单立减${fe.value.discountMoney}元，快去选购商品参与优惠活动`:Number(fe.value.quantityCount)>=Number(fe.value.minOrderAmount)?`已满足优惠条件，用券下单立减${fe.value.discountMoney}元`:`还差${Number(fe.value.minOrderAmount)-Number(fe.value.quantityCount)}件，即可用券下单立减${fe.value.discountMoney}元，快去选购商品参与优惠活动`,e}),me=async()=>{try{const e=await H(Z.value);fe.value=e}catch(e){i({title:e.message,icon:"none"}),console.error(e)}},ye=()=>{q({url:"/pages/cart/index"})},_e=e=>{T({url:`/pages/product/index?id=${e}`})},be=t(()=>`url(${k("coupon/coupon-bg2.png")})`);d(()=>{oe.page<Math.ceil(ne.value/oe.size)&&(oe.page++,de())});const ke=l(0),ge=l(),he=l({}),xe=()=>{ge.value.handleShowPopup(),he.value.isCheck=!1},Ce=()=>{ke.value=0},$e=()=>{me()};return(e,a)=>{const l=z,t=j,o=y(_("format-price"),R),s=M,u=y(_("tig-image"),U),c=y(_("up-loading-icon"),g),n=y(_("empty-box"),V),r=y(_("tig-fixed-placeholder"),W),i=y(_("tig-back-top"),B),d=y(_("tig-layout"),G);return h(),p(d,{ref_key:"layoutRef",ref:ee},{default:f(()=>[Y.value?(h(),x($,{key:0},[S(t,{class:"coupon-detail-title"},{default:f(()=>[S(t,{class:"detail-title-box"},{default:f(()=>[S(l,{class:"img-box",src:N(k)("coupon/coupon-bg1.png")},null,8,["src"]),S(t,{class:"coupon-box"},{default:f(()=>[S(t,{class:"coupon-item"},{default:f(()=>[S(t,{class:"left"},{default:f(()=>[2===Y.value.couponType?(h(),p(t,{key:0,class:"zhekou-box"},{default:f(()=>[S(t,{class:"zhekou"},{default:f(()=>[w(I(Y.value.couponDiscount),1)]),_:1}),S(t,{class:"zhe"},{default:f(()=>[w(I(e.$t("折")),1)]),_:1})]),_:1})):(h(),p(o,{key:1,"show-text":!1,"currency-style":{selfAlign:"end",fontSize:"24rpx"},"decimals-style":{selfAlign:"end",fontSize:"28rpx"},"font-style":{fontSize:"48rpx",lineHeight:1},"price-data":Y.value.couponMoney},null,8,["price-data"])),S(t,{class:"left-name line1"},{default:f(()=>[w(I(Y.value.couponName),1)]),_:1})]),_:1}),S(t,{class:"middle"},{default:f(()=>[S(t,{class:"middle-title"},{default:f(()=>[w(I(e.$t("优惠券")),1)]),_:1}),1===Y.value.sendType?(h(),p(t,{key:0,class:"sub"},{default:f(()=>[w(I(e.$t("有效期"))+"："+I(Y.value.useEndDate),1)]),_:1})):C("",!0),0===Y.value.sendType&&Y.value.delayDay>0?(h(),p(t,{key:1,class:"sub"},{default:f(()=>[w(I(`领券${Y.value.delayDay}天后生效，有效期${Y.value.useDay}天`),1)]),_:1})):C("",!0),0===Y.value.sendType&&0===Y.value.delayDay?(h(),p(t,{key:2,class:"sub"},{default:f(()=>[w(I(`领券当日起${Y.value.useDay}天内可用`),1)]),_:1})):C("",!0)]),_:1}),S(t,{class:A(["coupon-btn",{disabled:"已领取"===le.value}]),onClick:te},{default:f(()=>[w(I(e.$t(le.value)),1)]),_:1},8,["class"])]),_:1})]),_:1})]),_:1})]),_:1}),S(t,{class:"sticky"},{default:f(()=>[S(t,{class:"coupon-menu"},{default:f(()=>[S(t,{class:"coupon-search",onClick:pe},{default:f(()=>[S(t,{class:"coupon-search-box"},{default:f(()=>[oe.keyword?(h(),p(t,{key:1,class:"search-text is-value"},{default:f(()=>[S(s,{class:"iconfont-h5 icon-sousuo sousuo-icon"}),w(I(oe.keyword),1)]),_:1})):(h(),p(t,{key:0,class:"search-text"},{default:f(()=>[S(s,{class:"iconfont-h5 icon-sousuo sousuo-icon"}),w(I(e.$t("搜索")),1)]),_:1}))]),_:1})]),_:1}),S(t,{class:"coupon-content"},{default:f(()=>[(h(!0),x($,null,D(ue.value,(a,l)=>(h(),p(t,{key:l,class:A(["coupon-item",{active:se.value===a.value}]),onClick:e=>(e=>{"price"==e.value?e.order="desc"===e.order?"asc":"desc":e.order="",se.value=e.value,oe.sort=e.value,oe.order=e.order,ce(),de()})(a)},{default:f(()=>[S(s,null,{default:f(()=>[w(I(e.$t(a.label)),1)]),_:2},1024),O(S(t,{class:"price-ico-box flex flex-column"},{default:f(()=>[S(s,{class:A(["iconfont-h5 icon-shangjiantou price-icon",{order:"price"===se.value&&"asc"===a.order}])},null,8,["class"]),S(s,{class:A(["iconfont-h5 icon-xiajiantou price-icon",{order:"price"===se.value&&"desc"===a.order}])},null,8,["class"])]),_:2},1536),[[P,"price"===a.value]])]),_:2},1032,["class","onClick"]))),128))]),_:1})]),_:1})]),_:1}),ie.value.length>0?(h(),p(t,{key:0,class:"product-list"},{default:f(()=>[(h(!0),x($,null,D(ie.value,a=>(h(),p(t,{key:a.productId,class:"product-item"},{default:f(()=>[S(t,{class:"item-left",onClick:e=>_e(a.productId)},{default:f(()=>[S(u,{src:a.picThumb},null,8,["src"]),S(t,{class:"product-status-box"},{default:f(()=>[0==a.productStock||0==a.productStatus?(h(),p(t,{key:0,class:"outsale"},{default:f(()=>[w(I(0==a.productStock?e.$t("已售罄"):e.$t("已下架")),1)]),_:2},1024)):C("",!0)]),_:2},1024)]),_:2},1032,["onClick"]),S(t,{class:"item-right"},{default:f(()=>[S(t,{class:"item-right-title line2",onClick:e=>_e(a.productId)},{default:f(()=>[w(I(a.productName),1)]),_:2},1032,["onClick"]),S(t,{class:"item-right-price"},{default:f(()=>[S(o,{"decimals-style":{fontSize:"24rpx",fontWeight:"bold"},"currency-style":{fontSize:"23rpx",fontWeight:"bold"},"font-style":{fontSize:"32rpx"},"price-data":a.price},null,8,["price-data"])]),_:2},1024),S(t,{class:"buy_icon"},{default:f(()=>[S(t,{class:"buy_btn",onClick:e=>(e=>{e.isCheck||(ke.value=e.productId,e.isCheck=!0,he.value=e)})(a)},{default:f(()=>[a.isCheck?(h(),p(c,{key:0,mode:"circle"})):(h(),p(s,{key:1,class:"iconfont-h5 icon-gouwuche3 buy_btn_icon"}))]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})):C("",!0),re.value||0!==ne.value?C("",!0):(h(),p(n,{key:1,text:"好狠的筛选条件啊，把相关的商品都埋没了！"})),S(r,{"background-color":"#fff"},{default:f(()=>[S(t,{class:"btn-box"},{default:f(()=>[S(t,{class:"btn-box-left"},{default:f(()=>[S(t,{class:"left-text"},{default:f(()=>[w(I(e.$t("合计"))+"： ",1)]),_:1}),S(t,{class:"total-money"},{default:f(()=>[S(o,{"decimals-style":{fontSize:"26rpx"},"currency-style":{fontSize:"23rpx"},"font-style":{fontSize:"36rpx"},"price-data":fe.value.productPrice.toString()},null,8,["price-data"])]),_:1})]),_:1}),S(t,{class:"btn-box-right",onClick:ye},{default:f(()=>[w(I(e.$t("去购物车")),1)]),_:1}),S(t,{class:"tip line2"},{default:f(()=>[w(I(ve.value),1)]),_:1})]),_:1})]),_:1}),S(Q,{ref_key:"specificationRef",ref:ge,modelValue:ke.value,"onUpdate:modelValue":a[0]||(a[0]=e=>ke.value=e),onAddCardSucceed:$e,onLoadEnd:xe,onClose:Ce},null,8,["modelValue"]),S(i,{"scroll-top":N(X),bottom:90},null,8,["scroll-top"])],64)):C("",!0)]),_:1},512)}}}),[["__scopeId","data-v-b0be2097"]]);export{X as default};
