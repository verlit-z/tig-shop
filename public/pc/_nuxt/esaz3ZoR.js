import{dg as e,dh as t,di as a,_ as i,bR as l,a8 as o,z as s,r as n,h as r,v as u,H as c,y as d,aC as v,c as h,o as p,i as f,a as g,q as m,b,ad as y,w as S,ae as k,x as w,t as z,aD as x,V as B,aN as C,dj as I,e as W,n as T,j as $,an as H,f as E,B as _,F as O,aj as j,p as L}from"./BoLQ9Xhu.js";import{s as N}from"./DSXY0Md2.js";const M={style:{position:"relative"}},A=["src"],F=["textContent"],q=["textContent"],J=["src"];const R=i({name:"VerifySlide",props:{captchaType:{type:String},type:{type:String,default:"1"},mode:{type:String,default:"fixed"},vSpace:{type:Number,default:5},explain:{type:String,default:"向右拖动滑块填充拼图"},imgSize:{type:Object,default:()=>({width:"310px",height:"155px"})},blockSize:{type:Object,default:()=>({width:"50px",height:"50px"})},barSize:{type:Object,default:()=>({width:"310px",height:"40px"})}},setup(e,t){const{mode:a,captchaType:i,vSpace:v,imgSize:h,barSize:p,type:f,blockSize:g,explain:m}=l(e),{proxy:b}=o(),{t:y}=s();let S=n(""),k=n(""),w=n(""),z=n(""),x=n(""),W=n(""),T=n(""),$=n(""),H=n(""),E=n(""),_=n(""),O=r({imgHeight:0,imgWidth:0,barHeight:0,barWidth:0}),j=n(0),L=n(0),N=n(void 0),M=n(void 0),A=n(void 0),F=n("#ddd"),q=n("#d1e0f1"),J=n(void 0),R=n("icon-right"),X=n(!1),D=n(!1),V=n(!0),Z=n(""),K=n(""),P=n(0);const U=u(()=>b.$el.querySelector(".verify-bar-area"));function G(){E.value=m.value,te(),B(()=>{let{imgHeight:e,imgWidth:t,barHeight:a,barWidth:i}=function(e){let t,a,i,l;const o=e.$el.parentNode.offsetWidth||window.innerWidth,s=e.$el.parentNode.offsetHeight||window.innerHeight;return t=e.imgSize.width.includes("%")?parseInt(e.imgSize.width,10)/100*o+"px":e.imgSize.width,a=e.imgSize.height.includes("%")?parseInt(e.imgSize.height,10)/100*s+"px":e.imgSize.height,i=e.barSize.width.includes("%")?parseInt(e.barSize.width,10)/100*o+"px":e.barSize.width,l=e.barSize.height.includes("%")?parseInt(e.barSize.height,10)/100*s+"px":e.barSize.height,{imgWidth:t,imgHeight:a,barWidth:i,barHeight:l}}(b);O.imgHeight=e,O.imgWidth=t,O.barHeight=a,O.barWidth=i,b.$emit("ready",b)}),window.removeEventListener("touchmove",function(e){Q(e)}),window.removeEventListener("mousemove",function(e){Q(e)}),window.removeEventListener("touchend",function(){Y()}),window.removeEventListener("mouseup",function(){Y()}),window.addEventListener("touchmove",function(e){Q(e)}),window.addEventListener("mousemove",function(e){Q(e)}),window.addEventListener("touchend",function(){Y()}),window.addEventListener("mouseup",function(){Y()})}function Q(e){if(e=e||window.event,X.value&&0==D.value){let t=(e.touches?e.touches[0].pageX:e.clientX)-U.value.getBoundingClientRect().left;t>=U.value.offsetWidth-parseInt(parseInt(g.value.width)/2)-2&&(t=U.value.offsetWidth-parseInt(parseInt(g.value.width)/2)-2),t<=0&&(t=parseInt(parseInt(g.value.width)/2)),N.value=t-P.value+"px",t-P.value<0&&(N.value="0px"),M.value=t-P.value+40+"px"}}function Y(){if(T.value=+new Date,X.value&&0==D.value){var e=parseInt((N.value||"").replace("px",""));e=310*e/parseInt(O.imgWidth);let t={captchaType:i.value,pointJson:S.value?I(JSON.stringify({x:e,y:5}),S.value):JSON.stringify({x:e,y:5}),token:x.value};C({url:"common/verification/check",method:"post",data:t}).then(t=>{A.value="#52ccba",F.value="#52ccba",q.value="#d2f4ef",J.value="#fff",R.value="icon-check",V.value=!1,D.value=!0,"pop"==a.value&&setTimeout(()=>{b.$parent.clickShow=!1,ee()},1500),k.value=!0,H.value=`${((T.value-W.value)/1e3).toFixed(2)}s${y("验证成功")}`;var i=S.value?I(x.value+"---"+JSON.stringify({x:e,y:5}),S.value):x.value+"---"+JSON.stringify({x:e,y:5});setTimeout(()=>{H.value="",b.$emit("close"),b.$emit("success",{verifyToken:i})},1e3)}).catch(e=>{A.value="#d9534f",F.value="#d9534f",q.value="#fce1e1",J.value="#fff",R.value="icon-close",k.value=!1,setTimeout(function(){ee()},1e3),b.$emit("error",b),H.value=$t("验证失败"),setTimeout(()=>{H.value=""},1e3)}),X.value=!1}}c(f,()=>{G()}),d(()=>{G(),b.$el.onselectstart=function(){return!1}});const ee=()=>{V.value=!0,_.value="",Z.value="left .3s",N.value=0,M.value=void 0,K.value="width .3s",F.value="#ddd",q.value="#d1e0f1",A.value="#fff",J.value="#666",R.value="icon-right",D.value=!1,te(),setTimeout(()=>{K.value="",Z.value="",E.value=m.value},300)};function te(){let e={captchaType:i.value};C({url:"common/verification/captcha",method:"post",data:e}).then(e=>{w.value=e.originalImageBase64,z.value=e.jigsawImageBase64,x.value=e.token,S.value=e.secretKey}).catch(e=>{H.value=e.message})}return{secretKey:S,passFlag:k,backImgBase:w,blockBackImgBase:z,backToken:x,startMoveTime:W,endMovetime:T,tipsBackColor:$,tipWords:H,text:E,finishText:_,setSize:O,top:j,left:L,moveBlockLeft:N,leftBarWidth:M,moveBlockBackgroundColor:A,leftBarBorderColor:F,leftBarBackgroundColor:q,iconColor:J,iconClass:R,status:X,isEnd:D,showRefresh:V,transitionLeft:Z,transitionWidth:K,barArea:U,refresh:ee,start:function(e){if((e=e||window.event).touches)t=e.touches[0].pageX;else var t=e.clientX;P.value=Math.floor(t-U.value.getBoundingClientRect().left),W.value=+new Date,0==D.value&&(E.value="",A.value="#1991fa",F.value="#1991fa",q.value="#d1e0f1",J.value="#fff",e.stopPropagation(),X.value=!0)}}}},[["render",function(e,t,a,i,l,o){const s=v("a-spin");return p(),h("div",M,["2"===a.type?(p(),h("div",{key:0,class:"verify-img-out",style:m({height:parseInt(i.setSize.imgHeight)+a.vSpace+"px"})},[g("div",{class:"verify-img-panel",style:m({width:i.setSize.imgWidth,height:i.setSize.imgHeight})},[b(s,{spinning:!i.backImgBase,style:"width:100%;padding-top:39px"},{default:S(()=>[i.backImgBase?(p(),h("img",{key:0,src:"data:image/png;base64,"+i.backImgBase,alt:"",style:{width:"100%",height:"100%",display:"block"}},null,8,A)):f("",!0)]),_:1},8,["spinning"]),i.backImgBase?y((p(),h("div",{key:0,class:"verify-refresh",onClick:t[0]||(t[0]=(...e)=>i.refresh&&i.refresh(...e))},t[3]||(t[3]=[g("i",{class:"iconfont-pc icon-refresh"},null,-1)]),512)),[[k,i.showRefresh]]):f("",!0),b(x,{name:"tips"},{default:S(()=>[(p(),h("span",{key:0,class:w("verify-tips "+(i.tipWords?"show ":"")+(i.passFlag?"suc-bg":"err-bg"))},z(i.tipWords),3))]),_:1})],4)],4)):f("",!0),g("div",{class:"verify-bar-area",style:m({width:i.setSize.imgWidth,height:a.barSize.height,"line-height":a.barSize.height})},[g("span",{class:"verify-msg",textContent:z(e.$t(i.text))},null,8,F),g("div",{class:"verify-left-bar",style:m({width:void 0!==i.leftBarWidth?i.leftBarWidth:a.barSize.height,height:a.barSize.height,"border-color":i.leftBarBorderColor,"background-color":i.leftBarBackgroundColor,transaction:i.transitionWidth})},[g("span",{class:"verify-msg",textContent:z(i.finishText)},null,8,q),g("div",{class:"verify-move-block",onTouchstart:t[1]||(t[1]=(...e)=>i.start&&i.start(...e)),onMousedown:t[2]||(t[2]=(...e)=>i.start&&i.start(...e)),style:m({width:a.barSize.height,height:a.barSize.height,"background-color":i.moveBlockBackgroundColor,left:i.moveBlockLeft,transition:i.transitionLeft})},[g("i",{class:w(["verify-icon iconfont-pc",i.iconClass]),style:m({color:i.iconColor})},null,6),"2"===a.type?(p(),h("div",{key:0,class:"verify-sub-block",style:m({width:Math.floor(47*parseInt(i.setSize.imgWidth)/310)+"px",height:i.setSize.imgHeight,top:"-"+(parseInt(i.setSize.imgHeight)+a.vSpace)+"px","background-size":i.setSize.imgWidth+" "+i.setSize.imgHeight})},[i.blockBackImgBase?(p(),h("img",{key:0,src:"data:image/png;base64,"+i.blockBackImgBase,alt:"",style:{width:"100%",height:"100%",display:"block","-webkit-user-drag":"none"}},null,8,J)):f("",!0)],4)):f("",!0)],36)],4)],4)])}]]),X=W({__name:"Verify",props:{captchaType:{type:String,required:!0},figure:{type:Number},arith:{type:Number},mode:{type:String,default:"pop"},vSpace:{type:Number},explain:{type:String},imgSize:{type:Object,default:()=>({width:"310px",height:"155px"})},blockSize:{type:Object},barSize:{type:Object},close:{type:Function}},emits:["okCallback"],setup(e,{expose:t,emit:a}){const i=e,{captchaType:o,figure:s,arith:r,mode:u,vSpace:c,explain:d,imgSize:v,blockSize:h,barSize:f}=l(i);n(!1),n(void 0);const g=n(void 0),m=n({}),y=a,k=n(!1),w=()=>{k.value=!1,m.value.refresh&&m.value.refresh()},z=e=>{y("okCallback",e)};return t({show:()=>{document.body.style.overflow="hidden",k.value=!0}}),(e,t)=>(p(),T($(H),{class:"verifybox",open:k.value,"onUpdate:open":t[0]||(t[0]=e=>k.value=e),centered:"",width:parseInt($(v).width)+30+"px",title:e.$t("请完成安全验证"),destroyOnClose:!1,footer:null},{default:S(()=>[b(R,{is:g.value,captchaType:$(o),type:"2",figure:$(s),arith:$(r),mode:$(u),vSpace:$(c),explain:$(d),imgSize:$(v),blockSize:$(h),barSize:$(f),ref_key:"instance",ref:m,onClose:w,onSuccess:z},null,8,["is","captchaType","figure","arith","mode","vSpace","explain","imgSize","blockSize","barSize"])]),_:1},8,["open","width","title"]))}}),D={key:1,class:"code-text"},V=i(W({__name:"MobileCode",props:{class:String,email:{type:String,default:""},mobileCodeSended:{type:Boolean,default:!1},showMessage:{type:Boolean,default:!1},mobile:{type:String,default:""},requestApi:{type:Function,default:function(i,l,o){var s=-1,n=(l=e(l,i)).length;for(n||(n=1,i=void 0);++s<n;){var r=null==i?void 0:i[t(l[s])];void 0===r&&(s=n,r=o),i=a(r)?r.call(i):r}return i}},event:{type:String,default:"login"}},emits:["mobileErrorCallback","update:mobileCodeSended"],setup(e,{emit:t}){const a=E(),{t:i}=s(),o=e,{mobile:r}=l(o),c=t,d=n("获取验证码"),v=n(!0),m=n(),y=n(null),S=n(60),k=async()=>{if(o.email){if(""==o.email)return void c("mobileErrorCallback",i("邮箱不能为空！"));if(!B(o.email))return void c("mobileErrorCallback",i("邮箱格式错误"))}else{if(""==r.value)return void c("mobileErrorCallback",i("手机号不能为空！"));if(!x(r.value))return void c("mobileErrorCallback",i("手机号格式错误"))}if(y.value)try{await o.requestApi({mobile:r.value,email:o.email,verifyToken:y.value,event:o.event}),L.success(i("验证码已发送")),v.value=!1,c("update:mobileCodeSended",!0),W()}catch(e){v.value=!0,o.showMessage&&L.error(e.message),c("mobileErrorCallback",e.message)}finally{y.value=null}else m.value.show()},x=e=>!!(a.isOpenMobileAreaCode?/^(\+?[1-9]\d{1,14})$/:/^(?:\+?86)?1[3-9]\d{9}$/).test(e),B=e=>/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(e),C=u(()=>`${S.value}秒后重发`),I=n(),W=()=>{I.value=N(()=>{S.value--,S.value<=0&&(clearInterval(I.value),v.value=!0,S.value=60)},1e3)},T=e=>{y.value=e.verifyToken,k()};return _(()=>{clearInterval(I.value)}),(e,t)=>(p(),h(O,null,[g("div",{class:w(o.class)},[v.value?(p(),h("div",{key:0,class:"code-btn",onClick:j(k,["stop"])},z(e.$t(d.value)),1)):f("",!0),v.value?f("",!0):(p(),h("div",D,z(C.value),1))],2),b(X,{ref_key:"verify",ref:m,mode:"pop",captchaType:"blockPuzzle",imgSize:{width:"310px",height:"155px"},onOkCallback:T},null,512)],64))}}),[["__scopeId","data-v-aeeb28b8"]]);export{V as M,X as _};
