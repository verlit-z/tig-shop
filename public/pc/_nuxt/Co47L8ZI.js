import{_ as e}from"./BDziKWme.js";import{_ as l}from"./Dkgx1KFS.js";import{E as a}from"./7KO-WwAc.js";import{_ as o}from"./CUjxzVkc.js";import{E as s}from"./CqjQ_mIo.js";import{E as i}from"./BYBCH-HF.js";import{e as t,z as n,f as r,g as c,aA as d,r as u,h as A,v as m,G as v,aB as p,B as g,y as b,H as k,aC as h,c as w,o as f,a as y,b as C,w as R,ad as V,i as U,F as B,m as F,x as E,j as S,t as I,aD as L,n as M,aE as G,aF as x,d as j,ae as z,q as N,E as O,aG as T,aH as Z,aI as D,ah as Y,aJ as X,aK as J,p as H,_ as K,aL as q,l as W,k as Q,aM as P}from"./BoLQ9Xhu.js";import{M as _,_ as $}from"./esaz3ZoR.js";import"./DCawybvr.js";import"./7ACzQoE5.js";import{Q as ee}from"./NdJU2u_O.js";import{s as le}from"./DSXY0Md2.js";import{_ as ae}from"./1aEO9UvO.js";import{_ as oe,e as se}from"./DFo55n29.js";import"./oOeuh3JC.js";import"./Cy_EVX_n.js";import"./DEVzVrts.js";import"./k79prmI0.js";import"./C_oH9tmG.js";import"./nqCHxoJt.js";import"./BmDvg8bE.js";import"./D5wp6cRH.js";import"./MzbMzCCn.js";import"./C4BNlK69.js";const ie="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGoAAABqCAYAAABUIcSXAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2hpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMTM4IDc5LjE1OTgyNCwgMjAxNi8wOS8xNC0wMTowOTowMSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDpDRUJDNUJGMUNGRDlFNDExQjEyNUNBNjVFNTJGM0U4QiIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDpDNTREQjI3NDNERTgxMUU3OTE2OUZBMDQ1MTdFNTJGRCIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDpDNTREQjI3MzNERTgxMUU3OTE2OUZBMDQ1MTdFNTJGRCIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M2IChNYWNpbnRvc2gpIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6MDE4MDExNzQwNzIwNjgxMTgyMkFCNzNBRTc2REZEOUIiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6Q0VCQzVCRjFDRkQ5RTQxMUIxMjVDQTY1RTUyRjNFOEIiLz4gPC9yZGY6RGVzY3Jp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",te=""+new URL("google.BMBUbSLn.png",import.meta.url).href,ne=""+new URL("Facebook.C_w-5oy9.png",import.meta.url).href,re={class:"overseas-login-box flex align-center justify-end"},ce={class:"login-content"},de={class:"login-main"},ue={class:"menu"},Ae=["onClick"],me={class:"content"},ve={key:0,class:"form-box"},pe={class:"form-item"},ge={class:"form-item-label"},be={class:"form-item-input"},ke={class:"form-item"},he={class:"form-item-label"},we={class:"form-item-input"},fe={key:0,class:"form-box"},ye={class:"form-item"},Ce={class:"form-item-label"},Re={class:"form-item-input"},Ve={class:"form-item"},Ue={class:"form-item-label"},Be={class:"form-item-input"},Fe={key:0,class:"error-notice"},Ee={class:"agreement-box"},Se={class:"btn-box"},Ie={key:0,class:"text"},Le={class:"other-login-img"},Me={class:"register"},Ge={class:"register-text"},xe={class:"wechat-main-back-text"},je={class:"tow-title"},ze={class:"wechat-desc"},Ne={class:"two-image-box"},Oe={key:0,class:"refresh-con"},Te={class:"refresh-text"},Ze=K(t({__name:"OverseasLogin",props:{csrfToken:{},csrfTokenModifiers:{}},emits:["update:csrfToken"],setup(e){const{t:l}=n(),t=r(),K=c(),q=d(e,"csrfToken"),W=[{name:"账号登录",value:"password"},{name:"手机号登录",value:"mobile"}],Q=u("password"),P=A({username:"",password:""}),ae=A({mobile:"",mobileCode:""}),oe=u(!0),se=u("86"),Ze=u(!1),De=u(""),Ye=u(!1),Xe=e=>{De.value=e},Je=u(!0),He=u(),Ke=u(""),qe=e=>{Ke.value=e.verifyToken,$e()},We=u(!1),Qe=m(()=>"password"===Q.value?""==P.username||""==P.password:""==ae.mobile||""==ae.mobileCode||0==Ze.value),Pe=v(),_e=Pe.query.returnUrl?String(Pe.query.returnUrl):"/",$e=()=>{if(!Ye.value)return De.value=l("请同意服务协议和隐私政策");(async()=>{try{We.value=!0;const e=await X({loginType:Q.value,username:P.username,password:P.password,mobile:t.isOpenMobileAreaCode?se.value+ae.mobile:ae.mobile,mobileCode:ae.mobileCode,verifyToken:Ke.value},{"X-CSRF-Token":q.value});K.setToken(e.token),K.userInfoLoaded=!1,Y(_e,{replace:!0})}catch(e){1002==e.code?He.value&&He.value.show():e.code>0&&(De.value=e.message)}finally{We.value=!1}})()},el=p("oauthPath"),ll=async e=>{el.value=e;try{const l=await T(e,window.location.href);window.open(l,"_blank","width=500,height=700,top="+(screen.height/2-350))}catch(l){console.error(l)}},al=u(""),ol=u(""),sl=u(0),il=u(!1),tl=u(!1);let nl;const rl=async e=>{try{const l=await Z();nl&&clearInterval(nl),ol.value=l.url,al.value=l.ticket,await cl(l.url),oe.value=e,il.value=!0,tl.value=!1,sl.value=0,nl=le(()=>{sl.value++,sl.value>30&&(tl.value=!0,clearInterval(nl)),dl()},1e3)}catch(l){}},cl=async e=>{const l=e;ol.value=await ee.toDataURL(l,{margin:4})},dl=async()=>{const e=await D({key:al.value});(e.type>0||!1===il.value)&&ul(),1==e.type&&(K.setToken(e.token),K.userInfoLoaded=!1,Y("/member",{replace:!0})),2==e.type&&1===t.wechatRegisterBindPhone&&(K.openData=e.openData,Y("/member/BindMobilePhone"))},ul=()=>{il.value=!1,clearInterval(nl),nl=null,sl.value=0},Al=()=>{oe.value=!1,ul()};g(()=>{nl&&ul()});const ml=u(0);return b(()=>{const e=document.querySelector(".login-main");ml.value=e?e.clientHeight:0,console.log("height",ml.value)}),k(Pe.query,()=>{Pe.query.code&&(async e=>{try{const l=await J(el.value,window.location.href,e);K.setToken(l.token),K.userInfoLoaded=!1,Y(_e,{replace:!0})}catch(a){console.error(a),H.error(l("授权失败"))}})(Pe.query)},{immediate:!0}),(e,l)=>{const n=a,r=h("MobileAreaCode"),c=o,d=s,u=i,A=O;return f(),w(B,null,[y("div",re,[y("div",ce,[C(L,{name:"slide-fade",onAfterLeave:l[15]||(l[15]=e=>oe.value=!0)},{default:R(()=>[V(y("div",de,[y("div",ue,[(f(),w(B,null,F(W,(l,a)=>y("div",{key:a,class:E(["menu-item",{active:l.value===S(Q)}]),onClick:e=>{return a=l.value,Q.value=a,void(Je.value=!1);var a}},I(e.$t(l.name)),11,Ae)),64))]),y("div",me,[C(L,{name:"slide-fade",onAfterLeave:l[3]||(l[3]=e=>Je.value=!0)},{default:R(()=>["password"===S(Q)&&S(Je)?(f(),w("div",ve,[y("div",pe,[y("div",ge,I(e.$t("用户名/手机")),1),y("div",be,[C(n,{modelValue:S(P).username,"onUpdate:modelValue":l[0]||(l[0]=e=>S(P).username=e),clearable:"",placeholder:e.$t(1===S(t).openEmailRegister?"用户名/手机/邮箱":"用户名/手机"),type:"text"},null,8,["modelValue","placeholder"])])]),y("div",ke,[y("div",he,[y("div",null,I(e.$t("密码")),1),y("div",{class:"special",onClick:l[1]||(l[1]=l=>e.$router.push("reset"))},I(e.$t("忘记密码？")),1)]),y("div",we,[C(n,{modelValue:S(P).password,"onUpdate:modelValue":l[2]||(l[2]=e=>S(P).password=e),clearable:"",placeholder:e.$t("密码"),"show-password":"",type:"password"},null,8,["modelValue","placeholder"])])])])):U("",!0)]),_:1}),C(L,{name:"slide-fade2",onAfterLeave:l[9]||(l[9]=e=>Je.value=!0)},{default:R(()=>["mobile"===S(Q)&&S(Je)?(f(),w("div",fe,[y("div",ye,[y("div",Ce,I(e.$t("手机号")),1),y("div",Re,[C(n,{modelValue:S(ae).mobile,"onUpdate:modelValue":l[5]||(l[5]=e=>S(ae).mobile=e),clearable:"",placeholder:e.$t("您的手机号"),type:"text"},{prefix:R(()=>[S(t).isOpenMobileAreaCode?(f(),M(r,{key:0,modelValue:S(se),"onUpdate:modelValue":l[4]||(l[4]=e=>G(se)?se.value=e:null)},null,8,["modelValue"])):U("",!0)]),_:1},8,["modelValue","placeholder"])])]),y("div",Ve,[y("div",Ue,I(e.$t("验证码")),1),y("div",Be,[C(n,{modelValue:S(ae).mobileCode,"onUpdate:modelValue":l[8]||(l[8]=e=>S(ae).mobileCode=e),placeholder:e.$t("请输入验证码"),type:"text"},{suffix:R(()=>[C(S(_),{mobile:S(t).isOpenMobileAreaCode?S(se)+S(ae).mobile:S(ae).mobile,mobileCode:S(ae).mobileCode,"onUpdate:mobileCode":l[6]||(l[6]=e=>S(ae).mobileCode=e),mobileCodeSended:S(Ze),"onUpdate:mobileCodeSended":l[7]||(l[7]=e=>G(Ze)?Ze.value=e:null),requestApi:S(x),class:"mobile-code-text",onMobileErrorCallback:Xe},null,8,["mobile","mobileCode","mobileCodeSended","requestApi"])]),_:1},8,["modelValue","placeholder"])])])])):U("",!0)]),_:1})]),S(De)?(f(),w("div",Fe,I(S(De)),1)):U("",!0),y("div",Ee,[C(d,{modelValue:S(Ye),"onUpdate:modelValue":l[10]||(l[10]=e=>G(Ye)?Ye.value=e:null)},{default:R(()=>[l[18]||(l[18]=y("span",null,"我已阅读并同意",-1)),C(c,{class:"agreement-link",target:"_blank",to:"/article/issue/info?articleSn=fwxy"},{default:R(()=>[j("《"+I(e.$t("服务协议"))+"》 ",1)]),_:1}),l[19]||(l[19]=y("span",null,"和",-1)),C(c,{class:"agreement-link",target:"_blank",to:"/article/issue/info?articleSn=ysxy"},{default:R(()=>[j("《"+I(e.$t("隐私协议"))+"》 ",1)]),_:1})]),_:1,__:[18,19]},8,["modelValue"])]),y("div",Se,[C(u,{disabled:S(Qe),loading:S(We),class:"login-btn",type:"primary",onClick:$e},{default:R(()=>[j(I(e.$t("登录")),1)]),_:1},8,["disabled","loading"]),1===S(t).openWechatOauth&&1===S(t).openWechatRegister||1===S(t).googleLoginOn||1===S(t).facebookLoginOn?(f(),w("div",Ie,I(e.$t("或")),1)):U("",!0),y("div",Le,[1===S(t).openWechatOauth&&1===S(t).openWechatRegister?(f(),w("div",{key:0,class:"login-img",onClick:l[11]||(l[11]=e=>rl(!1))},l[20]||(l[20]=[y("img",{src:ie,alt:"",class:"login-img"},null,-1)]))):U("",!0),S(t).googleLoginOn?(f(),w("div",{key:1,class:"login-img googleRight",onClick:l[12]||(l[12]=e=>ll("google"))},l[21]||(l[21]=[y("img",{src:te,alt:"",class:"login-img"},null,-1)]))):U("",!0),S(t).facebookLoginOn?(f(),w("div",{key:2,class:"login-img",onClick:l[13]||(l[13]=e=>ll("facebook"))},l[22]||(l[22]=[y("img",{src:ne,alt:"",class:"login-img"},null,-1)]))):U("",!0)])]),y("div",Me,[y("div",Ge,I(e.$t("还没有账号？")),1),y("div",{class:"register-btn",onClick:l[14]||(l[14]=l=>e.$router.push("register"))},I(e.$t("去注册")),1)])],512),[[z,!1===S(il)&&S(oe)]])]),_:1}),C(L,{name:"slide-fade2",onAfterLeave:l[17]||(l[17]=e=>oe.value=!0)},{default:R(()=>[V(y("div",{style:N({height:`${S(ml)}px`}),class:"wechat-main"},[y("div",{class:"wechat-main-back",onClick:Al},[l[23]||(l[23]=y("span",{class:"iconfont-pc icon-shangjiantou"},null,-1)),y("span",xe,I(e.$t("返回")),1)]),y("div",je,I(e.$t("扫码登录")),1),y("div",ze,I(e.$t("请使用微信移动端扫描二维码")),1),y("div",Ne,[S(tl)?(f(),w("div",Oe,[y("div",Te,I(e.$t("二维码已失效")),1)])):U("",!0),C(A,{fit:"cover",class:"two-image",src:S(ol)},null,8,["src"])]),y("div",{class:"refresh-qecode",onClick:l[16]||(l[16]=e=>rl(!0))},[l[24]||(l[24]=y("span",{class:"iconfont-pc icon-svg27"},null,-1)),y("span",null,I(e.$t("刷新二维码")),1)]),y("div",{onClick:ul,class:"qiehuan"})],4),[[z,S(il)&&S(oe)]])]),_:1})])]),C($,{ref_key:"verify",ref:He,imgSize:{width:"310px",height:"155px"},captchaType:"blockPuzzle",mode:"pop",onOkCallback:qe},null,512)],64)}}}),[["__scopeId","data-v-297534ab"]]),De={class:"login-center flex align-center justify-end"},Ye={class:"login_border"},Xe={key:0,class:"login-main"},Je={class:"login-title-box"},He={class:"login-title"},Ke={key:0,class:"register-box"},qe={class:""},We={class:"login-top flex align-center justify-between"},Qe={class:"login-tab flex align-center hand-pointer"},Pe={class:"login-body"},_e={key:0,class:"login-mode-normal"},$e={class:"login-input flex align-center"},el={class:"login-input flex align-center"},ll={class:"login-mode-normal"},al={class:"login-input flex align-center"},ol={key:1,src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAAbwAAAG8B8aLcQwAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAFzSURBVFiF7ZexSwMxFMa/3F3a0kLVrZubFAfRraNr15KCtEv/BHVydXBw0a5uXa5Ic7eJ4OZ/IDi5ScGhmyI91Avec2nB4Xq9XNU65JsC+fK9H8kb8hgRYZly5hl6vV6hVCqtZgkPguCl0+m8J3lY0g1IKQ8BHAD4zAIAwAZw3mw2z7QB+v3+Guf8LgzDrXa7/Zqluuu65Vwud6+U2mm1Ws9xnplPwDlfBzDK5/M1KeUFAKZZP3IcRwAYTbL0AL5pE8AVgBOd6kR0atv2xrwmTwMAxlgghBjpAAwGg7c0Pksn9DdkAAyAATAABsAAGIClA6T6kBBRTUp5pBPMGNsGcLswgGVZXhRFK1EUFTQBrsMwvOGc7y8E0Gg0ngAcx+15nrcHAEKIy1nnpZSJ+Zl7wPf9KhF1iajr+341a06qHohTsVh8HI/HD9P1jwMopYac84rruuW4waRer38A2E0KnwwmFaXUcJbn/45mUy11OP0LfQH1UI9HR+JVhwAAAABJRU5ErkJggg=="},sl={class:"login-input flex align-center"},il={key:1,class:"error-notice"},tl={class:"agreement-box"},nl={class:"login_last"},rl={key:2,class:"forget-text"},cl={key:3,class:"login_bottom"},dl={class:"tit"},ul={class:"other-login"},Al={key:1,class:"login-main wechat-main"},ml={class:"tow-title"},vl=K(t({__name:"BaseLogin",props:{csrfToken:{},csrfTokenModifiers:{}},emits:["update:csrfToken"],setup(e){const l=d(e,"csrfToken"),t=c(),n=v(),A=n.query.returnUrl?String(n.query.returnUrl):"/",p=r();p.loadNav();const k=u(1),h=u(""),B=u(""),F=u(""),L=u(""),G=u(!1),N=u(!1),T=u(""),J=u(),H=u(""),K=u(0),W=u(0),Q=u(!1),P=u("86");b(()=>{de()});const oe=()=>{if(!Q.value)return H.value="请同意服务协议和隐私政策";se()},se=async()=>{try{N.value=!0;const e=await X({loginType:1===k.value?"password":"mobile",username:h.value,password:B.value,mobile:p.isOpenMobileAreaCode?P.value+F.value:F.value,mobileCode:L.value,verifyToken:T.value},{"X-CSRF-Token":l.value});t.setToken(e.token),t.userInfoLoaded=!1,Y(A,{replace:!0})}catch(e){1002==e.code?J.value.show():e.code>0&&(H.value=e.message)}finally{N.value=!1}},te=e=>{T.value=e.verifyToken,oe()},ne=m(()=>1==k.value?""==h.value||""==B.value:""==F.value||""==L.value||0==G.value),re=e=>{k.value=e,H.value=""},ce=e=>{H.value=e},de=async()=>{const e=await q();K.value=e.showOauth,W.value=e.wechatLogin},ue=u(!1),Ae=u(1),me=u(""),ve=u(0),pe=u("");let ge;const be=async()=>{ue.value=!0,Ae.value=2;try{const e=await Z();e.url&&(pe.value=e.ticket,await he(e.url),ge&&clearInterval(ge),ve.value=0,ge=le(()=>{ve.value++,we()},1e3))}catch(e){console.log(e)}finally{ue.value=!1}},ke=()=>{Ae.value=1,clearInterval(ge),ge=null,ve.value=0},he=async e=>{const l=e;me.value=await ee.toDataURL(l,{margin:10})},we=async()=>{const e=await D({key:pe.value});(e.type>0||2!==Ae.value)&&(clearInterval(ge),ge=null,ve.value=0),1==e.type&&(t.setToken(e.token),t.userInfoLoaded=!1,Y("/member",{replace:!0})),2==e.type&&1===p.wechatRegisterBindPhone&&(t.openData=e.openData,Y("/member/BindMobilePhone"))};function fe(e){"Enter"!==e.key||ne.value||(console.log("Enter key pressed"),oe())}return b(()=>{document.addEventListener("keydown",fe)}),g(()=>{document.removeEventListener("keydown",fe),ge&&clearInterval(ge)}),(e,l)=>{const t=o,n=a,r=s,c=i,d=O;return f(),w("div",De,[y("div",Ye,[1==Ae.value?(f(),w("div",Xe,[y("div",Je,[y("div",He,I(e.$t("欢迎登录")),1),0===S(p).shopRegClosed?(f(),w("div",Ke,[y("span",qe,I(e.$t("没有账号？")),1),C(t,{class:"register-main-text",to:"/member/register/"},{default:R(()=>[j(I(e.$t("去注册")),1)]),_:1})])):U("",!0)]),y("div",We,[y("div",Qe,[y("div",{class:E([1==k.value?"login-on":"","login_mode"]),onClick:l[0]||(l[0]=e=>re(1))},I(e.$t("普通登录")),3),y("div",{class:E([2==k.value?"login-on":"","login_mode"]),onClick:l[1]||(l[1]=e=>re(2))},I(e.$t("手机登录")),3)])]),y("div",Pe,[1==k.value?(f(),w("div",_e,[y("div",$e,[C(n,{modelValue:h.value,"onUpdate:modelValue":l[2]||(l[2]=e=>h.value=e),clearable:"",placeholder:e.$t(1===S(p).openEmailRegister?"用户名/手机/邮箱":"用户名/手机"),type:"text"},{prefix:R(()=>l[12]||(l[12]=[y("img",{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAAbwAAAG8B8aLcQwAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAN/SURBVFiFxZdBaBxVGMd/30wgbSwm1/SwRKlaE0HM1kKVoiB4WlTCPMISYk8qaOnFYluwhIVIa2lP1V56SS2BWd6yRBFaBClStFJLqCBJhaJuD01LKIg0LSk783nYt5KmndnOJMXvNsz3//9/7817M29EVfk/qyuPqFKpeIODg1tFZBuAql6am5u7MjExEWf1kiwzUKvV3lTVT4Fh4IlVt5eAWRGZDILgu3UFmJ6efrK7u/uoqr4HxMAVEZmN43gWwPO8YVUdBrYCnoicXF5e3js2NvbPmgGstVuA74EC8Fscx7tGR0dnH9ZbrVaHPc87BbwAXAPeMMZcTfP30m5WKhUPmAIKqnoMKCaFA7h7RddbAKacR2KlzkCtVvtYVY8CXxtj3kkzWl3W2hngbRHZGwTBsaS+RDprbUFVJ4FbzWbzgyzhAE5zS1UnrbWFzAAi8jqwQVUPl8vlm1kByuXyTVU9DGxwXtkAgKID+TlreLtWaIuZAVS1SGvLXc4L4LSx88oGADwPLBhjbudNd9oF55UZYBHot9ZuygvgtP3OKzPAn7Teai/lBXBaz3llBjgLEMfxK3kBVmjP5gGoApGI7A/DcHPW8DAMN4vIfiByXtkAjDE3RGQf0Of7/smsAE7TJyL7jDE3kvoe5WP0FTAOfAF8Yoy526F/I3AE2A2cNsa8m9af+qEAWFpaeh+46AwvW2t3pITvoLX3dwMXnTa1Op6IGo3GvaGhoXOquh14FvjJWntVVS+JyC8AqvqyOx1taetE5Fyj0bjXyT/1EVhrnwJOATuBpqqeFpGn3fXq2YuB86r6h4iMu8GdB3YZYxK3YSKAtfY14FtgE/ANref/O0C9Xu+PouhFVR1wo/3L9/1fR0ZGFpz2OVrr4C3gNlAyxvzwyADW2kHgR1qr+KMgCE4kjSCtarXah6r6JfA38KoxZm51zwOLsF6v9wNnXPievOEAQRCcEJE9QB9wxnmnAzSbzc9oHcEOBUFwPG/4CojjqnoIKDjvZIAwDAfcArre09Mzudbwdjmv6yIyHobhQCKA7/sHgC5VPVgqle6sF0CpVLqjqgeBLpfxUAABRoHF+fn5qfUKb5fzXHQZ8gBAtVp9BugFLuT5xepUzvMC0Ouy7gfwPG8brO0M2Kna3u0suP9VvCgin0dRNPO4AKIomvF9v1dV/zshZfo5fRz1L43KgKdhFrX9AAAAAElFTkSuQmCC"},null,-1)])),_:1},8,["modelValue","placeholder"])]),y("div",el,[C(n,{modelValue:B.value,"onUpdate:modelValue":l[3]||(l[3]=e=>B.value=e),placeholder:e.$t("密码"),"show-password":"",type:"password"},{prefix:R(()=>l[13]||(l[13]=[y("img",{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAAbwAAAG8B8aLcQwAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAJbSURBVFiFxdc9iBZXGAXgZ6NoYRAFQUUkQZAYLMSEaBYLRUJA7WJeLBX8KwRJFRL8wwhqK4KIGqys3iZE0SaKFusvrqiNiaAWEcVgowgGDGsxs/Jp5tv9ZnZiTjPcO3fOOXPmvXfu7RsaGtIEmTkbCzEXv+N6RDyqy9NX10BmrsN+TK+4/Sd+iIgTrRvIzFk4ihV4hrO4jj/wKRZhGSbhF2yOiCetGMjMiaXYfJzGpoh4WDHuY/yM5RjE4oh4NRL3B6OqF9hdiu+LiFVV4hARD/AVDuAz/Dga8agJZOZCXMMN9I/2RuUzw4nNxYKIuNNtbC8JrMI4bOhFHCLib2zBBEXNdEUvBr7A04i42Yt4BwbwEp+P1cAiRZy1UKZ1qw0DM3C/roES9zFzrAb+U/zvBrpOw8zsV6xse3Eb5xrwr8BH2IXfIuJftVRpIDP3YHsDwZEwhG0RsW9EA5k5X/HG6zUvvip8gkOYFxF3hzvHVwxcir6ION6iuMy8jMNYjDcGqopwcpvCFfiws1GVQE8oNyQ7FL/i2/gpIh7X5Wk0DTNzBs7jL3yP5xjIzGl1uZom8B1ORcS2sn2pFN+KnXWImi5EcxQJdOKsotJroamBQXzzTt8aXKlL1PQTHMSFzPwVJ7EaUxTzvBYaJRARL/Al7uCIYse0JCJevhcDpYlXuFg2ByLinyY8Y/0bXsEZDTYsw2i8EEF5Elo5Fo6qBGp/x5p4i78qgauQmUsUR622MKe8DnZ2dtsPJL5tUXwYxyJiY2dHtxpYg7X4GlNbEL6HoxFx490btU/HbeM1FHm9Y65npM0AAAAASUVORK5CYII="},null,-1)])),_:1},8,["modelValue","placeholder"])])])):U("",!0),V(y("div",ll,[y("div",al,[C(n,{modelValue:F.value,"onUpdate:modelValue":l[5]||(l[5]=e=>F.value=e),clearable:"",placeholder:e.$t("您的手机号"),type:"text"},{prefix:R(()=>[S(p).isOpenMobileAreaCode?(f(),M(ae,{key:0,modelValue:P.value,"onUpdate:modelValue":l[4]||(l[4]=e=>P.value=e)},null,8,["modelValue"])):(f(),w("img",ol))]),_:1},8,["modelValue","placeholder"])]),y("div",sl,[C(n,{modelValue:L.value,"onUpdate:modelValue":l[8]||(l[8]=e=>L.value=e),placeholder:e.$t("请输入验证码"),type:"text"},{prefix:R(()=>l[14]||(l[14]=[y("img",{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAAbwAAAG8B8aLcQwAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAIjSURBVFiF7ZY/iBNBFMa/mb0YEPFSbCIniNeJpSCx3avtkp1FBK84MNjFQvCsrQSLAyuDFopIkreLKQK2C6KQCFrEwkoQ5K7YgOk23MZ9FncLm5hczB9MwHzlzPC+38x782YEM2ORkgt1XwGsAACsDRsslUqJVCqVlVIm5mEShmHQ6XSahUIhGJwTg9eQiG4CeAxgYx7mMR0AuKeUej0SwHXdNc/zvgM4YOY9IcQfxNOImRNCiLsANtLp9EXDMHrRXF8K2u12FsB5ALuWZb2ah3kkIhIAXh57fIjGB4vwFABEOyeidSLKTmtaLpc3iehSPGbkMQqgT8y8BaBBRDYRrU9ibtv2tqZpXwA8PWndiQCZTKYuhHgEIAfgk+M4V8cZ1+v107ZtP2fmFwC+SSnvTA1gGEbPNM1dIcR1AGfDMHxPRMVR6yuVymXf9xvMvMPMzwBcy+fzX6cGiGSa5ltN064AaALYI6I3tVotFV9j2/a2lPIjgE1mvmVZ1m2llD8u9tBGNEy5XO6H67pbnuc9BHA/CILPjuPcSCaTrW63+4SZdwC0pJTWuF3HNVErNgyjp5R6cJySM2EYvvN9vzXJkc8EECmWkgaAc5Mc+VwAgKOUADCCILgwS9P66xoYJqXULwA/Z4mx8Od46QAOgaPXa95GsZiH8fG+GtB1vel53j6AYrVa5Tk/x0UA+7quN+Nzy/UhibTQL9m/1tLdghXA/wfwG5UF+daMCa/TAAAAAElFTkSuQmCC"},null,-1)])),suffix:R(()=>[C(S(_),{mobile:S(p).isOpenMobileAreaCode?P.value+F.value:F.value,mobileCode:L.value,"onUpdate:mobileCode":l[6]||(l[6]=e=>L.value=e),mobileCodeSended:G.value,"onUpdate:mobileCodeSended":l[7]||(l[7]=e=>G.value=e),requestApi:S(x),class:"mobile-code-text",onMobileErrorCallback:ce},null,8,["mobile","mobileCode","mobileCodeSended","requestApi"])]),_:1},8,["modelValue","placeholder"])])],512),[[z,2===k.value]]),H.value?(f(),w("div",il,I(H.value),1)):U("",!0),y("div",tl,[C(r,{modelValue:Q.value,"onUpdate:modelValue":l[9]||(l[9]=e=>Q.value=e)},{default:R(()=>[y("span",null,I(e.$t("我已阅读并同意")),1),C(t,{class:"agreement-link",target:"_blank",to:"/article/issue/info?articleSn=fwxy"},{default:R(()=>[j("《"+I(e.$t("服务协议"))+"》 ",1)]),_:1}),y("span",null,I(e.$t("和")),1),C(t,{class:"agreement-link",target:"_blank",to:"/article/issue/info?articleSn=ysxy"},{default:R(()=>[j("《"+I(e.$t("隐私协议"))+"》 ",1)]),_:1})]),_:1},8,["modelValue"])]),y("div",nl,[C(c,{disabled:S(ne),loading:N.value,class:"login_btn submit_btn",type:"primary",onClick:oe},{default:R(()=>[j(I(e.$t("登录")),1)]),_:1},8,["disabled","loading"])]),1===k.value?(f(),w("div",rl,[y("a",{onClick:l[10]||(l[10]=l=>e.$router.push("/member/reset"))},I(e.$t("忘记密码？")),1)])):U("",!0),1===K.value&&1===S(p).openWechatOauth&&1===S(p).openWechatRegister?(f(),w("div",cl,[y("div",dl,I(e.$t("合作网站账号登录")),1),y("li",ul,[1==W.value?(f(),w("a",{key:0,onClick:be},l[15]||(l[15]=[y("img",{height:"32",src:ie,width:"32"},null,-1)]))):U("",!0)])])):U("",!0),C($,{ref_key:"verify",ref:J,imgSize:{width:"310px",height:"155px"},captchaType:"blockPuzzle",mode:"pop",onOkCallback:te},null,512)]),1===S(p).openWechatOauth&&1===S(p).openWechatRegister?(f(),w("div",{key:0,onClick:be,class:"qiehuan1"})):U("",!0)])):U("",!0),2==Ae.value?(f(),w("div",Al,[y("div",ml,I(e.$t("使用微信扫码安全登录")),1),y("div",null,[C(d,{fit:"cover",class:"two-image",src:me.value},{placeholder:R(()=>l[16]||(l[16]=[y("div",{class:"image-text"},"加载中...",-1)])),error:R(()=>l[17]||(l[17]=[y("div",{class:"image-text"},"加载中...",-1)])),_:1},8,["src"])]),y("div",null,[C(c,{style:{width:"140px"},type:"primary",onClick:l[11]||(l[11]=e=>be())},{default:R(()=>[j(I(e.$t("刷新二维码")),1)]),_:1})]),y("div",{onClick:ke,class:"qiehuan"})])):U("",!0)])])}}}),[["__scopeId","data-v-f73a12ad"]]),pl=K(t({__name:"Login",setup(a){c().isAuthenticated&&Y("/",{replace:!0});const o=u("");(async()=>{try{const e=await se({decorateSn:"pcUserLogin"});o.value=e.data.backgroundPic.picUrl}catch(e){}})();const s=u("");return(async()=>{try{const e=await P();s.value=e}catch(e){console.error("获取CSRF Token失败:",e)}})(),(a,i)=>{const t=e,n=l,r=Ze,c=vl,d=oe;return f(),w(B,null,[C(t,{title:"登录"}),C(n,{type:"login"}),y("div",{style:N({backgroundImage:`url(${S(Q)(S(o))})`}),class:"login-warp"},[S(W)()?(f(),M(r,{key:0,"csrf-token":S(s),"onUpdate:csrfToken":i[0]||(i[0]=e=>G(s)?s.value=e:null)},null,8,["csrf-token"])):(f(),M(c,{key:1,"csrf-token":S(s),"onUpdate:csrfToken":i[1]||(i[1]=e=>G(s)?s.value=e:null)},null,8,["csrf-token"]))],4),C(d,{type:2})],64)}}}),[["__scopeId","data-v-35778488"]]);export{pl as default};
