import{a as e,E as l}from"./CSNhwhPs.js";import{E as a}from"./7KO-WwAc.js";import{E as o}from"./BYBCH-HF.js";import{E as d}from"./mHIovD83.js";import{aN as i,aR as r,e as s,f as t,z as u,r as m,v as p,I as b,h as n,g as v,c,o as C,F as w,b as f,a as y,w as h,j as g,i as M,d as V,t as _,av as E,a6 as $,p as U,_ as k}from"./BoLQ9Xhu.js";import"./DwsKuIG7.js";import{M as x}from"./esaz3ZoR.js";import"./DCawybvr.js";import"./7ACzQoE5.js";import{_ as q}from"./1aEO9UvO.js";import"./Cy_EVX_n.js";import"./DEVzVrts.js";import"./BmDvg8bE.js";import"./k79prmI0.js";import"./C_oH9tmG.js";import"./nqCHxoJt.js";import"./D5wp6cRH.js";import"./DSXY0Md2.js";const z=e=>i({url:"user/user/sendMobileCodeByMobileValidate",method:"post",data:e}),A=e=>i({url:"user/user/sendMobileCodeByModifyMobile",method:"post",data:e}),S=e=>i({url:"user/user/sendMobileCodeByModifyPassword",method:"post",data:e}),j=e=>r({url:"user/user/sendEmailCodeByEmailValidate",method:"post",data:e}),O=e=>r({url:"user/user/sendEmailCodeByModifyEmail",method:"post",data:e}),F=e=>r({url:"user/user/modifyEmail",method:"post",data:e}),P={style:{padding:"10px"}},B=k(s({__name:"VerificationSecurity",props:{params:{type:Object,default:{}}},emits:["loadFilter"],setup(s,{emit:k}){const B=t(),{t:I}=u(),R=m(""),Z=m(!1),N=p(()=>""==Y.value.mobile||""==Y.value.mobileCode||0==Z.value),T=m(!1),W=p(()=>""==Y.value.newMobile||""==Y.value.newMobileCode||0==T.value),D=m(!1),G=p(()=>""==Y.value.mobile||""==Y.value.mobileCode||0==D.value),H=p(()=>""==Y.value.email||""==Y.value.newEmail),J=()=>{Y.value.email=Y.value.newEmail},K=s,L=m(!1),Q=m(!0),X=m(!0),Y=m({}),ee=b(),le=async()=>{L.value=!0,Q.value=!0,ee.value&&await ee.value.resetFields(),console.log(K.params),Y.value.mobile=K.params.mobile,Y.value.email=K.params.email},ae=async()=>{await ee.value.validate();try{let l={mobile:Y.value.mobile,code:Y.value.mobileCode};await(e={...l},i({url:"user/user/mobileValidate",method:"post",data:e}));Q.value=!1}catch(l){l.message&&U.error(l.message)}var e},oe=async()=>{await ee.value.validate();try{let l={email:Y.value.email,code:Y.value.emailCode};await(e={...l},r({url:"user/user/emailValidateNew",method:"post",data:e})),X.value=!1}catch(l){l.message&&U.error(l.message)}var e},de=k,ie=async()=>{await ee.value.validate();try{let l={mobile:B.isOpenMobileAreaCode?R.value+Y.value.newMobile:Y.value.newMobile,code:Y.value.newMobileCode};await(e={...l},i({url:"user/user/modifyMobile",method:"post",data:e}));U.success(I("修改成功")),L.value=!1,de("loadFilter")}catch(l){l.message&&U.error(l.message)}var e},re=async()=>{await ee.value.validate();try{let e={email:Y.value.newEmail,code:Y.value.newEmailCode};await F({...e});U.success(I("修改成功")),L.value=!1,de("loadFilter")}catch(e){e.message&&U.error(e.message)}},se=async()=>{await ee.value.validate();try{let e={email:Y.value.email,code:Y.value.emailCode};await F({...e}),U.success(I("绑定成功")),L.value=!1,de("loadFilter")}catch(e){e.message&&U.error(e.message)}},te=n({password:[{validator:(e,l,a)=>l?l.length>20||l.length<6?a(new Error(I("密码应为6-20位字符"))):/\s/.test(l)?a(new Error(I("密码中不允许有空格"))):/^\d+$/.test(l)?a(new Error(I("密码不能全为数字"))):/^(?=.*[\d\W]).+$/.test(l)?/^(?=.*[a-zA-Z0-9]).+$/.test(l)?/^(?!([a-zA-Z0-9])\1*$).+$/.test(l)?void a():a(new Error(I("密码不能全为相同字符或数字"))):a(new Error(I("密码不能全为符号"))):a(new Error(I("密码不能全为字母"))):a(new Error(I("密码不能为空"))),trigger:"blur",required:!0}],confirmPassword:[{validator:(e,l,a)=>l?l!=Y.value.password?a(new Error(I("两次密码不一致"))):void a():a(new Error(I("请再次输入密码"))),trigger:"change",required:!0}],newMobile:[{validator:(e,l,a)=>{const o=B.isOpenMobileAreaCode?/^(\+?[1-9]\d{1,14})$/:/^(?:\+86)?1(?:3[0-9]|4[5-9]|5[0-35-9]|6[5-7]|7[0-8]|8[0-9]|9[189])\d{8}$/;return l?o.test(l)?void a():a(new Error(I("格式错误，请输入正确的手机号码"))):a(new Error(I("手机号不能为空")))},required:!0}]}),ue=async()=>{await ee.value.validate();try{let l={password:Y.value.password,code:Y.value.mobileCode};await(e={...l},i({url:"user/user/checkModifyPasswordMobileCode",method:"post",data:e})),U.success(I("修改成功")),await me.loginOut(),L.value=!1}catch(l){l.message&&U.error(l.message)}var e},me=v();me.getUserInfo();const pe=m(""),be=e=>{pe.value=e};return(i,r)=>{const t=l,u=a,m=o,p=e,b=d;return C(),c(w,null,[f(b,{modelValue:L.value,"onUpdate:modelValue":r[31]||(r[31]=e=>L.value=e),"close-on-click-modal":!1,title:s.params.title,"z-index":900,width:"450"},{default:h(()=>[y("div",P,[f(p,{ref_key:"formRef",ref:ee,model:Y.value,rules:g(te),class:"form-body","label-suffix":"："},{default:h(()=>[1==s.params.type?(C(),c(w,{key:0},[Q.value?(C(),c(w,{key:0},[f(t,{label:i.$t("原手机号")},{default:h(()=>[V(_(Y.value.mobile),1)]),_:1},8,["label"]),f(t,{rules:[{required:!0,message:i.$t("请输入验证码")}],label:"",prop:"mobileCode"},{default:h(()=>[f(u,{modelValue:Y.value.mobileCode,"onUpdate:modelValue":r[3]||(r[3]=e=>Y.value.mobileCode=e),placeholder:i.$t("请输入验证码"),type:"text",size:"large"},{suffix:h(()=>[f(g(x),{mobile:Y.value.mobile,"onUpdate:mobile":r[0]||(r[0]=e=>Y.value.mobile=e),mobileCode:Y.value.mobileCode,"onUpdate:mobileCode":r[1]||(r[1]=e=>Y.value.mobileCode=e),mobileCodeSended:Z.value,"onUpdate:mobileCodeSended":r[2]||(r[2]=e=>Z.value=e),requestApi:g(z),showMessage:!0,class:"mobile-code-text",onMobileErrorCallback:be},null,8,["mobile","mobileCode","mobileCodeSended","requestApi"])]),_:1},8,["modelValue","placeholder"])]),_:1},8,["rules"]),f(m,{disabled:g(N),style:{width:"100%"},type:"primary",onClick:ae,size:"large"},{default:h(()=>[V(_(i.$t("下一步")),1)]),_:1},8,["disabled"])],64)):(C(),c(w,{key:1},[f(t,{label:"",prop:"newMobile"},{default:h(()=>[f(u,{modelValue:Y.value.newMobile,"onUpdate:modelValue":r[5]||(r[5]=e=>Y.value.newMobile=e),clearable:"",placeholder:i.$t("请输入手机号码"),size:"large"},E({_:2},[g(B).isOpenMobileAreaCode?{name:"prefix",fn:h(()=>[f(q,{modelValue:R.value,"onUpdate:modelValue":r[4]||(r[4]=e=>R.value=e)},null,8,["modelValue"])]),key:"0"}:void 0]),1032,["modelValue","placeholder"])]),_:1}),f(t,{rules:[{required:!0,message:i.$t("请输入验证码")}],label:"",prop:"newMobileCode"},{default:h(()=>[f(u,{modelValue:Y.value.newMobileCode,"onUpdate:modelValue":r[8]||(r[8]=e=>Y.value.newMobileCode=e),placeholder:i.$t("请输入验证码"),type:"text",size:"large"},{suffix:h(()=>[f(g(x),{mobile:g(B).isOpenMobileAreaCode?R.value+Y.value.newMobile:Y.value.newMobile,mobileCode:Y.value.newMobileCode,"onUpdate:mobileCode":r[6]||(r[6]=e=>Y.value.newMobileCode=e),mobileCodeSended:T.value,"onUpdate:mobileCodeSended":r[7]||(r[7]=e=>T.value=e),requestApi:g(A),showMessage:!0,class:"mobile-code-text",onMobileErrorCallback:be},null,8,["mobile","mobileCode","mobileCodeSended","requestApi"])]),_:1},8,["modelValue","placeholder"])]),_:1},8,["rules"]),f(m,{disabled:g(W),style:{width:"100%"},type:"primary",onClick:ie,size:"large"},{default:h(()=>[V(_(i.$t("提交")),1)]),_:1},8,["disabled"])],64))],64)):2==s.params.type?(C(),c(w,{key:1},[f(t,{label:i.$t("手机号")},{default:h(()=>[V(_(Y.value.mobile),1)]),_:1},8,["label"]),f(t,{rules:[{required:!0,message:i.$t("请输入验证码")}],label:"",prop:"mobileCode"},{default:h(()=>[f(u,{modelValue:Y.value.mobileCode,"onUpdate:modelValue":r[12]||(r[12]=e=>Y.value.mobileCode=e),placeholder:i.$t("请输入验证码"),type:"text",size:"large"},{suffix:h(()=>[f(g(x),{mobile:Y.value.mobile,"onUpdate:mobile":r[9]||(r[9]=e=>Y.value.mobile=e),mobileCode:Y.value.mobileCode,"onUpdate:mobileCode":r[10]||(r[10]=e=>Y.value.mobileCode=e),mobileCodeSended:D.value,"onUpdate:mobileCodeSended":r[11]||(r[11]=e=>D.value=e),requestApi:g(S),showMessage:!0,class:"mobile-code-text",onMobileErrorCallback:be},null,8,["mobile","mobileCode","mobileCodeSended","requestApi"])]),_:1},8,["modelValue","placeholder"])]),_:1},8,["rules"]),f(t,{label:"",prop:"password"},{default:h(()=>[f(u,{modelValue:Y.value.password,"onUpdate:modelValue":r[13]||(r[13]=e=>Y.value.password=e),clearable:"",placeholder:i.$t("请输入新密码"),size:"large"},null,8,["modelValue","placeholder"])]),_:1}),f(t,{label:"",prop:"confirmPassword"},{default:h(()=>[f(u,{modelValue:Y.value.confirmPassword,"onUpdate:modelValue":r[14]||(r[14]=e=>Y.value.confirmPassword=e),clearable:"",placeholder:i.$t("请再次输入新密码"),size:"large"},null,8,["modelValue","placeholder"])]),_:1}),f(m,{disabled:g(G),style:{width:"100%"},type:"primary",size:"large",onClick:ue},{default:h(()=>[V(_(i.$t("提交")),1)]),_:1},8,["disabled"])],64)):3==s.params.type?(C(),c(w,{key:2},[f(t,{label:"",prop:"newMobile"},{default:h(()=>[f(u,{modelValue:Y.value.newMobile,"onUpdate:modelValue":r[16]||(r[16]=e=>Y.value.newMobile=e),clearable:"",placeholder:i.$t("请输入手机号码"),size:"large"},E({_:2},[g(B).isOpenMobileAreaCode?{name:"prefix",fn:h(()=>[f(q,{modelValue:R.value,"onUpdate:modelValue":r[15]||(r[15]=e=>R.value=e)},null,8,["modelValue"])]),key:"0"}:void 0]),1032,["modelValue","placeholder"])]),_:1}),f(t,{rules:[{required:!0,message:i.$t("验证码不能为空")}],label:"",prop:"newMobileCode"},{default:h(()=>[f(u,{modelValue:Y.value.newMobileCode,"onUpdate:modelValue":r[19]||(r[19]=e=>Y.value.newMobileCode=e),placeholder:i.$t("请输入验证码"),type:"text",size:"large"},{suffix:h(()=>[f(g(x),{mobile:g(B).isOpenMobileAreaCode?R.value+Y.value.newMobile:Y.value.newMobile,mobileCode:Y.value.newMobileCode,"onUpdate:mobileCode":r[17]||(r[17]=e=>Y.value.newMobileCode=e),mobileCodeSended:T.value,"onUpdate:mobileCodeSended":r[18]||(r[18]=e=>T.value=e),requestApi:g(A),showMessage:!0,class:"mobile-code-text",onMobileErrorCallback:be},null,8,["mobile","mobileCode","mobileCodeSended","requestApi"])]),_:1},8,["modelValue","placeholder"])]),_:1},8,["rules"]),f(m,{disabled:g(W),style:{width:"100%"},type:"primary",onClick:ie,size:"large"},{default:h(()=>[V(_(i.$t("提交")),1)]),_:1},8,["disabled"])],64)):4==s.params.type?(C(),c(w,{key:3},[X.value?(C(),c(w,{key:0},[f(t,{label:i.$t("原邮箱")},{default:h(()=>[V(_(Y.value.email),1)]),_:1},8,["label"]),f(t,{rules:[{required:!0,message:i.$t("验证码不能为空")}],label:"",prop:"emailCode"},{default:h(()=>[f(u,{modelValue:Y.value.emailCode,"onUpdate:modelValue":r[22]||(r[22]=e=>Y.value.emailCode=e),placeholder:i.$t("请输入验证码"),type:"text",size:"large"},{suffix:h(()=>[f(g(x),{email:Y.value.email,mobileCode:Y.value.emailCode,"onUpdate:mobileCode":r[20]||(r[20]=e=>Y.value.emailCode=e),mobileCodeSended:T.value,"onUpdate:mobileCodeSended":r[21]||(r[21]=e=>T.value=e),requestApi:g(j),showMessage:!0,class:"mobile-code-text",onMobileErrorCallback:be},null,8,["email","mobileCode","mobileCodeSended","requestApi"])]),_:1},8,["modelValue","placeholder"])]),_:1},8,["rules"]),f(m,{disabled:g(H),style:{width:"100%"},type:"primary",onClick:oe,size:"large"},{default:h(()=>[V(_(i.$t("下一步")),1)]),_:1},8,["disabled"])],64)):(C(),c(w,{key:1},[f(t,{label:"",prop:"newEmail"},{default:h(()=>[f(u,{modelValue:Y.value.newEmail,"onUpdate:modelValue":r[23]||(r[23]=e=>Y.value.newEmail=e),clearable:"",placeholder:i.$t("请输入邮箱"),size:"large",onInput:J},null,8,["modelValue","placeholder"])]),_:1}),f(t,{rules:[{required:!0,message:i.$t("请输入验证码")}],label:"",prop:"newEmailCode"},{default:h(()=>[f(u,{modelValue:Y.value.newEmailCode,"onUpdate:modelValue":r[26]||(r[26]=e=>Y.value.newEmailCode=e),placeholder:i.$t("请输入验证码"),type:"text",size:"large"},{suffix:h(()=>[f(g(x),{email:Y.value.newEmail,mobileCode:Y.value.newEmailCode,"onUpdate:mobileCode":r[24]||(r[24]=e=>Y.value.newEmailCode=e),mobileCodeSended:T.value,"onUpdate:mobileCodeSended":r[25]||(r[25]=e=>T.value=e),requestApi:g(O),showMessage:!0,class:"mobile-code-text",onMobileErrorCallback:be},null,8,["email","mobileCode","mobileCodeSended","requestApi"])]),_:1},8,["modelValue","placeholder"])]),_:1},8,["rules"]),f(m,{style:{width:"100%"},type:"primary",onClick:re,size:"large"},{default:h(()=>[V(_(i.$t("提交")),1)]),_:1})],64))],64)):5==s.params.type?(C(),c(w,{key:4},[f(t,{label:"",prop:"email"},{default:h(()=>[f(u,{modelValue:Y.value.email,"onUpdate:modelValue":r[27]||(r[27]=e=>Y.value.email=e),clearable:"",placeholder:i.$t("请输入邮箱"),size:"large"},null,8,["modelValue","placeholder"])]),_:1}),f(t,{rules:[{required:!0,message:i.$t("请输入验证码")}],label:"",prop:"emailCode"},{default:h(()=>[f(u,{modelValue:Y.value.emailCode,"onUpdate:modelValue":r[30]||(r[30]=e=>Y.value.emailCode=e),placeholder:i.$t("请输入验证码"),type:"text",size:"large"},{suffix:h(()=>[f(g(x),{email:Y.value.email,mobileCode:Y.value.emailCode,"onUpdate:mobileCode":r[28]||(r[28]=e=>Y.value.emailCode=e),mobileCodeSended:T.value,"onUpdate:mobileCodeSended":r[29]||(r[29]=e=>T.value=e),requestApi:g(O),showMessage:!0,class:"mobile-code-text",onMobileErrorCallback:be},null,8,["email","mobileCode","mobileCodeSended","requestApi"])]),_:1},8,["modelValue","placeholder"])]),_:1},8,["rules"]),f(m,{style:{width:"100%"},type:"primary",onClick:se,size:"large"},{default:h(()=>[V(_(i.$t("提交")),1)]),_:1})],64)):M("",!0)]),_:1},8,["model","rules"])])]),_:1},8,["modelValue","title"]),y("span",{onClick:le},[$(i.$slots,"default",{},void 0,!0)])],64)}}}),[["__scopeId","data-v-6d2b4183"]]);export{B as default};
