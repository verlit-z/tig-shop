import{p as te}from"./format-CpNC4fsQ.js";import{d as ae,r as f,a as oe,a2 as le,o as ie,J as Q,e as u,f as y,g as c,h as k,j as U,k as C,y as a,l as i,K as _,i as V,F as A,m as F,t as T,_ as ne}from"./index-BGgofOm4.js";import{c as se,h as re}from"./order-BPrSE32N.js";/* empty css                                                                    */import{P as ue}from"./ProductCard-BI6ohnfl.js";import"./SelectTimeInterval.vue_vue_type_style_index_0_scoped_207fe586_lang-CdQ8MEGg.js";import"./index-BdoKLCH8.js";/* empty css                                                                              */import{S as de}from"./SelectLogisticsCompany-BzS5cxgb.js";import{M as pe}from"./index-BS7Hjr9I.js";import"./time-BL_Iz6xX.js";import"./logisticsCompany-6jh7zrIw.js";const ce={class:"container"},me={class:"content_wrapper"},ve={class:"lyecs-form-table"},fe={key:0},ye={style:{"margin-top":"20px",border:"1px solid #e8e8e8",padding:"10px"}},_e={class:"flex flex-justify-between"},ge={key:1},he=ae({__name:"BatchShip",props:{ids:{type:Array,default:[]},act:{type:String,default:""},isDialog:Boolean},emits:["submitCallback","update:confirmLoading","close","okType"],setup(L,{expose:j,emit:O}){const g=O;g("okType",!1);const x=L,b=f(!0),$=oe().currentRoute.value.query,P=f(x.isDialog?x.act:String($.act)),J=f(x.ids),M=le(),n=f({items:[],shippingMethod:1,shippingTypeId:1}),h=f(!1),K=f([]),s=f([]);ie(()=>{H()});const B=t=>{t===1?(n.value.items.forEach(e=>{e.items.forEach(l=>{e.orderStatus===1&&l.allowDeliverNum>0&&s.value.push({id:e.orderId,itemId:l.itemId,toDeliveryQuantity:l.toDeliveryQuantity,quantity:l.allowDeliverNum})})}),I()):(s.value=[],I())},z=t=>s.value.some(e=>e.itemId===t),G=t=>{const e=s.value.findIndex(l=>l.itemId===t.itemId);e===-1?s.value.push({id:t.orderId,itemId:t.itemId,toDeliveryQuantity:t.toDeliveryQuantity,quantity:t.allowDeliverNum}):s.value.splice(e,1),I()},q=f([]),H=async()=>{try{b.value=!0,(await se(P.value,{ids:J.value.join(",")})).forEach(e=>{e.orderStatus==1&&n.value.items.push(e)}),n.value.items&&n.value.items.forEach(e=>{e.items.forEach(l=>{l.toDeliveryQuantity=l.allowDeliverNum,q.value.push(l.itemId)})})}catch(t){Q.error(t.message),g("close")}finally{b.value=!1}},W=t=>{const e=s.value.findIndex(l=>l.itemId===t.itemId);e!==-1&&(s.value[e].toDeliveryQuantity=t.toDeliveryQuantity,I())},I=()=>{const t=[];h.value=!1,s.value.length>0&&s.value.forEach(e=>{e.toDeliveryQuantity<e.allowDeliverNum&&(h.value=!0),t.push({id:e.id,itemId:e.itemId,toDeliveryQuantity:e.toDeliveryQuantity,quantity:e.allowDeliverNum})}),s.value=t,h.value===!1&&(h.value=s.value.length<q.value.length),g("okType",s.value.length>0)},E=()=>{const t={};let e=[];const l=new Set;return s.value.forEach(m=>{const p=m.id,D=n.value.items.find(N=>N.orderId===p),S=D?D.trackingNo:"",d={itemId:m.itemId,toDeliveryQuantity:m.toDeliveryQuantity};l.add(p),t[p]||(t[p]={id:p,trackingNo:S,deliverInfo:[]}),t[p].deliverInfo.push(d)}),e=Array.from(l),{ids:e,type:"deliver",data:{logisticsId:n.value.logisticsId,shippingMethod:n.value.shippingMethod,deliverData:Object.values(t)}}},X=async()=>{h.value===!1?w(E()):pe.confirm({title:"您当前只选择了部份商品发货，系统将会自动将订单进行拆分，是否确认继续发货？",onOk:async()=>{w(E())}})},w=async t=>{await M.value.validate();try{g("update:confirmLoading",!0);const e=await re(t);g("submitCallback",e),Q.success("操作成功")}catch(e){Q.error(e.message)}finally{g("update:confirmLoading",!1)}};return j({onFormSubmit:()=>{X()}}),(t,e)=>{const l=u("el-radio"),R=u("el-radio-group"),m=u("el-form-item"),p=u("el-button"),D=u("TigInput"),S=u("el-checkbox"),d=u("el-table-column"),N=u("el-input-number"),Y=u("el-table"),Z=u("el-form"),ee=u("a-spin");return c(),y("div",ce,[k("div",me,[k("div",ve,[e[9]||(e[9]=k("div",{class:"button-card babyBlue pd15"},"提示：如果订单分开发货，系统会自动将订单拆分为不同订单！",-1)),b.value?C("",!0):(c(),U(Z,{key:0,ref_key:"formRef",ref:M,model:n.value,"label-width":"auto"},{default:i(()=>[a(m,{label:"配送方式",prop:"shippingMethod"},{default:i(()=>[a(R,{modelValue:n.value.shippingMethod,"onUpdate:modelValue":e[0]||(e[0]=r=>n.value.shippingMethod=r)},{default:i(()=>[a(l,{value:1},{default:i(()=>e[4]||(e[4]=[_("物流配送",-1)])),_:1,__:[4]}),a(l,{value:2},{default:i(()=>e[5]||(e[5]=[_("商家配送",-1)])),_:1,__:[5]}),a(l,{value:3},{default:i(()=>e[6]||(e[6]=[_("无需配送",-1)])),_:1,__:[6]})]),_:1},8,["modelValue"])]),_:1}),n.value.shippingMethod===1?(c(),y("div",fe,[a(m,{label:"物流公司",prop:"logisticsId",rules:[{required:!0,message:"请选择物流公司!"}]},{default:i(()=>[a(V(de),{logisticsId:n.value.logisticsId,"onUpdate:logisticsId":e[1]||(e[1]=r=>n.value.logisticsId=r)},null,8,["logisticsId"])]),_:1})])):C("",!0),a(p,{onClick:e[2]||(e[2]=r=>B(1))},{default:i(()=>e[7]||(e[7]=[_("全选",-1)])),_:1,__:[7]}),a(p,{onClick:e[3]||(e[3]=r=>B(0))},{default:i(()=>e[8]||(e[8]=[_("取消全部选择",-1)])),_:1,__:[8]}),(c(!0),y(A,null,F(n.value.items,(r,Ie)=>(c(),y("div",ye,[k("div",_e,[a(m,{label:"订单编号",prop:"orderSn"},{default:i(()=>[_(T(r.orderSn),1)]),_:2},1024),n.value.shippingMethod===1?(c(),U(m,{key:0,label:"快递单号"},{default:i(()=>[a(D,{modelValue:r.trackingNo,"onUpdate:modelValue":o=>r.trackingNo=o,width:"500px",disabled:r.orderStatus!=1},null,8,["modelValue","onUpdate:modelValue","disabled"])]),_:2},1024)):C("",!0)]),a(Y,{data:r.items,style:{width:"100%"},selection:K.value},{default:i(()=>[a(d,{prop:"check",width:"50"},{default:i(({row:o})=>[a(S,{"model-value":z(o.itemId),onChange:v=>G(o),disabled:r.orderStatus!=1||o.toDeliveryQuantity<=0},null,8,["model-value","onChange","disabled"])]),_:2},1024),a(d,{label:"商品名称",prop:"productId",width:"230"},{default:i(({row:o})=>[a(V(ue),{picThumb:o.picThumb,productId:o.productId,productName:o.productName,productType:o.productType,url:o.url},null,8,["picThumb","productId","productName","productType","url"])]),_:1}),a(d,{label:"属性",prop:"productAttr"},{default:i(({row:o})=>[_(T(o.skuValue||"无属性"),1)]),_:1}),a(d,{label:"附加规格",prop:"extraSkuData"},{default:i(({row:o})=>[o.extraSkuData&&o.extraSkuData.length>0?(c(!0),y(A,{key:0},F(o.extraSkuData,v=>(c(),y("div",{class:"extraskudata",key:v},T(v.attrName+v.attrValue+V(te)(v.totalAttrPrice)),1))),128)):(c(),y("div",ge,"无附加规格"))]),_:2},1024),a(d,{label:"商品信息",prop:"productSn"}),a(d,{label:"库存",prop:"productStock"}),a(d,{label:"数量",prop:"quantity"}),a(d,{label:"待发货数量",prop:"toDeliveryQuantity",width:"120"},{default:i(({row:o})=>[a(N,{class:"input-number","controls-position":"right",modelValue:o.toDeliveryQuantity,"onUpdate:modelValue":v=>o.toDeliveryQuantity=v,onChange:v=>W(o),type:"number",min:0,max:o.allowDeliverNum,disabled:r.orderStatus!=1||o.toDeliveryQuantity<=0},null,8,["modelValue","onUpdate:modelValue","onChange","max","disabled"])]),_:2},1024)]),_:2},1032,["data","selection"])]))),256))]),_:1},8,["model"])),a(ee,{spinning:b.value,style:{width:"100%","margin-top":"100px"}},null,8,["spinning"])])])])}}}),Ee=ne(he,[["__scopeId","data-v-2683cd12"]]);export{Ee as default};
