import{d as M,Z as G,r as u,e as d,f as i,g as l,y as s,l as t,h as g,F as P,m as $,j as I,t as H,K as C,E as J,aH as K,i as q,G as Z,J as B,_ as z}from"./index-BGgofOm4.js";const Q={class:"lyecs-popedit"},W={key:0,class:"table-product-box"},X={key:1,class:"table-product-inp"},Y={class:"table-btn-box"},ee=M({__name:"ProductStockPop",props:{params:{type:Object,default:{id:null,productInfo:{}}},requestApi:{type:Function,default:G}},emits:["callback"],setup(F,{emit:N}){var R;const p=u(!1),V=u(),f=u(!1),T=a=>{p.value&&!q(V).popperRef.contentRef.contains(a.target)&&(p.value=!1)},m=F,r=u({skuList:m.params.productInfo.productSku||[],productStock:m.params.productInfo.productStock||0}),h=u((R=r.value.skuList[0])==null?void 0:R.skuData),_=u({skuStock:[{required:!0,message:"不能为空",trigger:"blur"}],productStock:[{required:!0,message:"不能为空",trigger:"blur"}]}),j=N,b=u();u(!1);const k=u(m.params.productInfo.productSku||[]),x=a=>(f.value=!0,new Promise((e,n)=>{b.value.validate().then(()=>{let c=null;a.field=="productSku"?c=A(k.value):c=r.value.productStock,m.requestApi({id:m.params.id,field:a.field,val:c}).then(v=>{j("callback"),B.success("操作成功"),f.value=!1,p.value=!1,e(!0)}).catch(v=>{f.value=!1,B.error(v.message),n()})})}));function A(a){let e=[];return a.forEach(n=>{e.push({skuId:n.skuId,skuStock:Number(n.skuStock)})}),e}return(a,e)=>{const n=d("el-table-column"),c=d("TigInput"),v=d("el-form-item"),E=d("el-table"),w=d("el-form"),S=d("el-button"),O=d("el-popover");return l(),i("div",Q,[s(O,{visible:p.value,ref_key:"popoverRef",ref:V,placement:"left",width:0},{reference:t(()=>[J((l(),i("div",{class:"lyecs-popedit-con",onClick:e[0]||(e[0]=o=>p.value=!0)},[K(a.$slots,"default",{},void 0,!0),e[5]||(e[5]=g("span",{class:"lyecs-popedit-btn iconfont icon-bianji1"},null,-1))])),[[q(Z),T]])]),default:t(()=>[k.value&&k.value.length>0?(l(),i("div",W,[s(w,{model:r.value,rules:_.value,ref_key:"formRef",ref:b,class:"formDiv"},{default:t(()=>[s(E,{data:r.value.skuList,style:{width:"100%"},border:""},{default:t(()=>[(l(!0),i(P,null,$(h.value,o=>(l(),I(n,{label:o.name},{default:t(({row:y,$index:D})=>[g("ul",null,[(l(!0),i(P,null,$(y.skuData,(L,U)=>(l(),i("li",{key:U},H(o.name==L.name?L.value:""),1))),128))])]),_:2},1032,["label"]))),256)),s(n,{label:"库存",width:"100px"},{default:t(({row:o,$index:y})=>[s(v,{prop:"skuList."+y+".skuStock",rules:_.value.skuStock},{default:t(()=>[s(c,{type:"integer",modelValue:o.skuStock,"onUpdate:modelValue":D=>o.skuStock=D,modelModifiers:{trim:!0},placeholder:"请输入商品库存"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["prop","rules"])]),_:1})]),_:1},8,["data"])]),_:1},8,["model","rules"])])):(l(),i("div",X,[s(w,{model:r.value,rules:_.value,ref_key:"formRef",ref:b,class:"formDiv"},{default:t(()=>[s(v,{prop:"productStock",rules:_.value.productStock},{default:t(()=>[s(c,{type:"integer",modelValue:r.value.productStock,"onUpdate:modelValue":e[1]||(e[1]=o=>r.value.productStock=o),modelModifiers:{trim:!0},placeholder:"请输入商品库存"},null,8,["modelValue"])]),_:1},8,["rules"])]),_:1},8,["model","rules"])])),g("div",Y,[s(S,{ref:"buttonRef",onClick:e[2]||(e[2]=o=>p.value=!1)},{default:t(()=>e[6]||(e[6]=[C("取消",-1)])),_:1,__:[6]},512),k.value&&k.value.length>0?(l(),I(S,{key:0,type:"primary",onClick:e[3]||(e[3]=o=>x({field:"productSku"})),loading:f.value},{default:t(()=>e[7]||(e[7]=[C("保存",-1)])),_:1,__:[7]},8,["loading"])):(l(),I(S,{key:1,type:"primary",onClick:e[4]||(e[4]=o=>x({field:"productStock"})),loading:f.value},{default:t(()=>e[8]||(e[8]=[C("保存",-1)])),_:1,__:[8]},8,["loading"]))])]),_:3},8,["visible"])])}}}),oe=z(ee,[["__scopeId","data-v-95abbc70"]]);export{oe as default};
