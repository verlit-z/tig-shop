import{d as M,r as y,a as q,a2 as F,o as E,e as f,f as G,g as m,h as o,y as t,j as c,k as v,l as n,i as d,t as b,K as S,J as s,_ as J}from"./index-BGgofOm4.js";import{b as K,u as z,c as H}from"./refundApply-CMjlW3-7.js";import"./index-BdoKLCH8.js";import{O as Q}from"./OrderMoney-CAEPMuJ3.js";/* empty css                                                                    */import{P as W}from"./ProductCard-BI6ohnfl.js";import{p as w}from"./format-CpNC4fsQ.js";import{F as X}from"./UploadAvatar.vue_vue_type_style_index_0_scoped_3ec2e0ca_lang-CloSefEz.js";import"./vuedraggable.umd-CLczY9wy.js";import{_ as C}from"./DialogForm.vue_vue_type_script_setup_true_lang-BTf40oxg.js";import"./index-BS7Hjr9I.js";import"./Image.vue_vue_type_script_setup_true_lang-oDjiJjwB.js";import"./BusinessImg-Dt_2PeVb.js";const Y={class:"container"},Z={class:"content_wrapper"},ee={class:"lyecs-form-table"},ae={class:"flex"},le={class:"btn-link"},te={class:"btn-link"},ne={class:"extra"},oe={class:"extra"},ue={class:"extra"},re={class:"btn-box"},se=M({__name:"Info",props:{id:{type:Number,default:0},act:{type:String,default:""},isDialog:Boolean},emits:["submitCallback","update:confirmLoading","close"],setup(R,{emit:P}){const p=P,B=y([]),g=R,_=y(!0),h=q().currentRoute.value.query,U=y(g.isDialog?g.act:String(h.act)),A=y(g.isDialog?g.id:Number(h.id)),x=F(),e=y({effectiveBalance:0,refundBalance:0,effectiveOnlineBalance:0,onlineBalance:0,offlineBalance:0,refundAmount:0,paidAmount:0,onlinePaidAmount:0}),V=(u,a)=>{Number(e.value[u])>Number(a)&&s.error("退款金额不能超过最多可操作金额")},D=async()=>{try{const u=await K(U.value,{id:A.value});Object.assign(e.value,u),u.aftersales&&u.aftersales.refundAmount&&(e.value.refundAmount=u.aftersales.refundAmount)}catch(u){s.error(u.message),p("close")}finally{_.value=!1}},T=async()=>{try{const u=await z({refundId:A.value});p("submitCallback",u),s.success("操作成功")}catch(u){s.error(u.message),p("close")}finally{_.value=!1}};E(()=>{D()});const $=async u=>{await x.value.validate();{if(Number(e.value.refundBalance)>Number(e.value.refundAmount)){s.error("退款余额不能大于最多可操作金额");return}if(Number(e.value.onlineBalance)>Number(e.value.onlinePaidAmount)){s.error("线上退款金额不能大于最多可操作金额");return}if(Number(e.value.offlineBalance)>Number(e.value.refundAmount)){s.error("线下退款金额不能大于实收金额");return}if(Number(e.value.refundBalance)+Number(e.value.onlineBalance)+Number(e.value.offlineBalance)!=e.value.refundAmount){s.error("总退款金额必须等于最多可操作金额");return}}let a=[];B.value.length>0&&B.value.forEach(r=>{a.push(r.picUrl)});try{p("update:confirmLoading",!0);let r={refundId:A.value,refundNote:e.value.refundNote,onlineBalance:e.value.onlineBalance,offlineBalance:e.value.offlineBalance,refundBalance:e.value.refundBalance,paymentVoucher:a.join(","),refundStatus:u};const k=await H(r);p("submitCallback",k),s.success("操作成功")}catch(r){s.error(r.message)}finally{p("update:confirmLoading",!1)}};return(u,a)=>{const r=f("el-table-column"),k=f("el-table"),i=f("el-form-item"),N=f("TigInput"),I=f("el-button"),j=f("el-form"),L=f("a-spin");return m(),G("div",Y,[o("div",Z,[o("div",ee,[a[14]||(a[14]=o("div",{class:"notice-warp"},[o("p",null,"最终退款金额可根据实际需要填写，该金额会展示在会员用户的订单详情页面中（如果退款类型为商品，订单会统计所有该订单下商品的最终退款总额）；"),o("p",null,"处理状态为未处理或已处理时，佣金等相关功能不会计算最终退款金额；"),o("p",null,"处理状态为取消时，佣金等相关功能会忽略该退款；"),o("p",null,"积分、优惠券等退还与本操作无关，取消订单或商品退货操作确认后会自动退还！")],-1)),t(k,{data:e.value.items,style:{width:"100%","margin-bottom":"20px"},border:""},{default:n(()=>[t(r,{label:"商品信息",width:"400"},{default:n(({row:l})=>[o("div",ae,[t(d(W),{picThumb:l.picThumb,productId:l.productId,productName:l.productName},null,8,["picThumb","productId","productName"])])]),_:1}),t(r,{label:"商品价格",align:"center"},{default:n(({row:l})=>[o("div",null,b(d(w)(l.price)),1)]),_:1}),t(r,{prop:"quantity",label:"商品数量",align:"center"}),t(r,{prop:"number",label:"退货数量",align:"center"})]),_:1},8,["data"]),_.value?v("",!0):(m(),c(j,{key:0,ref_key:"formRef",ref:x,model:e.value,"label-width":"auto"},{default:n(()=>[t(i,{label:"售后编号",prop:"orderSn"},{default:n(()=>{var l;return[t(d(C),{params:{act:"detail",id:(l=e.value.aftersales)==null?void 0:l.aftersaleId},isDrawer:"",path:"order/aftersales/Info",title:"查看售后信息",width:"700px",showClose:!1,showOnOk:!1},{default:n(()=>{var O;return[o("a",le,b((O=e.value.aftersales)==null?void 0:O.aftersalesSn),1)]}),_:1},8,["params"])]}),_:1}),t(i,{label:"订单编号",prop:"orderSn"},{default:n(()=>[t(d(C),{params:{act:"detail",id:e.value.orderId},isDrawer:"",showClose:!1,showOnOk:!1,path:"order/order/Info",title:"查看订单信息",width:"880px"},{default:n(()=>[o("a",te,b(e.value.orderSn),1)]),_:1},8,["params"])]),_:1}),e.value.aftersales?(m(),c(i,{key:0,label:"订单金额",prop:"aftersales"},{default:n(()=>[t(d(Q),{style:{width:"100%"},modelValue:e.value.aftersales.orders,"onUpdate:modelValue":a[0]||(a[0]=l=>e.value.aftersales.orders=l)},null,8,["modelValue"])]),_:1})):v("",!0),t(i,{label:"余额退款金额",prop:"refundBalance"},{default:n(()=>[t(N,{width:"100%",type:"decimal",modelValue:e.value.refundBalance,"onUpdate:modelValue":a[1]||(a[1]=l=>e.value.refundBalance=l),onInput:a[2]||(a[2]=l=>V("refundBalance",e.value.refundAmount)),disabled:e.value.refundStatus!=0||e.value.isOffline==1},null,8,["modelValue","disabled"]),o("div",ne,"请根据实际情况填写金额, 最多可操作总金额 "+b(d(w)(e.value.refundAmount)),1)]),_:1}),e.value.onlinePaidAmount>0?(m(),c(i,{key:1,label:"线上退款金额",prop:"onlineBalance"},{default:n(()=>[t(N,{width:"100%",type:"decimal",modelValue:e.value.onlineBalance,"onUpdate:modelValue":a[3]||(a[3]=l=>e.value.onlineBalance=l),onInput:a[4]||(a[4]=l=>V("onlineBalance",e.value.onlinePaidAmount)),disabled:e.value.refundStatus!=0||e.value.isOffline==1},null,8,["modelValue","disabled"]),o("div",oe,"请根据实际情况填写金额, 最多可操作金额 "+b(d(w)(e.value.onlinePaidAmount)),1)]),_:1})):v("",!0),t(i,{label:"线下退款金额",prop:"offlineBalance"},{default:n(()=>[t(N,{width:"100%",type:"decimal",modelValue:e.value.offlineBalance,"onUpdate:modelValue":a[5]||(a[5]=l=>e.value.offlineBalance=l),onInput:a[6]||(a[6]=l=>V("offlineBalance",e.value.refundAmount)),disabled:e.value.refundStatus!=0||e.value.isOffline==1},null,8,["modelValue","disabled"]),o("div",ue,"请根据实际情况填写金额, 最多可操作总金额 "+b(d(w)(e.value.refundAmount)),1)]),_:1}),t(i,{label:"上传附件",prop:"paymentVoucher"},{default:n(()=>[_.value?v("",!0):(m(),c(d(X),{key:0,photos:B.value,"onUpdate:photos":a[7]||(a[7]=l=>B.value=l),isMultiple:!0,disabled:e.value.refundStatus!=0||e.value.isOffline==1},null,8,["photos","disabled"])),a[11]||(a[11]=o("div",{class:"extra"},"您可以通过拖拽来调整相册图片顺序，第一张图将作为商品主图展示",-1))]),_:1,__:[11]}),t(i,{label:"本次操作备注",prop:"refundNote"},{default:n(()=>[t(N,{width:"100%",modelValue:e.value.refundNote,"onUpdate:modelValue":a[8]||(a[8]=l=>e.value.refundNote=l),rows:4,type:"textarea",disabled:e.value.refundStatus!=0||e.value.isOffline==1},null,8,["modelValue","disabled"])]),_:1}),t(i,null,{default:n(()=>[o("div",re,[e.value.refundStatus==0&&e.value.isOffline!=1?(m(),c(I,{key:0,ref:"submitBtn",class:"form-submit-btn",type:"primary",onClick:a[9]||(a[9]=l=>$(1))},{default:n(()=>a[12]||(a[12]=[S("同意退款",-1)])),_:1,__:[12]},512)):v("",!0),e.value.isOffline==1?(m(),c(I,{key:1,ref:"submitBtn",class:"form-submit-btn",type:"primary",onClick:a[10]||(a[10]=l=>T())},{default:n(()=>a[13]||(a[13]=[S("确认已线下转账",-1)])),_:1,__:[13]},512)):v("",!0)])]),_:1})]),_:1},8,["model"])),t(L,{spinning:_.value,style:{width:"100%","margin-top":"100px"}},null,8,["spinning"])])])])}}}),we=J(se,[["__scopeId","data-v-67d071d5"]]);export{we as default};
