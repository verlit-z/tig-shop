import{_ as H}from"./AdvancedInfo.vue_vue_type_script_setup_true_lang-9FSWiSTe.js";import Q from"./BasicInfo-CYAoiV_R.js";import{_ as W}from"./DescInfo.vue_vue_type_script_setup_true_lang-BfsCGKXn.js";import X from"./LogisticsInfo-CTYQnnYH.js";import{_ as Y}from"./PriceInfo.vue_vue_type_script_setup_true_lang-CglLmDUn.js";import{d as Z,P as ee,r as l,a as te,a2 as ae,R as ie,o as oe,J as f,e as w,f as U,g as h,h as o,y as I,l as C,F as re,m as se,n as q,t as le,j as T,k as N,K as k,i as L,q as R,_ as ne}from"./index-BGgofOm4.js";import{e as ue,f as de,h as ce,i as pe}from"./product-DiKWBvyV.js";/* empty css                                                                  */import"./Checkbox.vue_vue_type_script_setup_true_lang-DPw77KJQ.js";import"./SelectTimeInterval.vue_vue_type_style_index_0_scoped_207fe586_lang-CdQ8MEGg.js";import"./time-BL_Iz6xX.js";import"./index-BdoKLCH8.js";import"./index-BS7Hjr9I.js";import"./SelectProduct-DqHrlW58.js";import"./format-CpNC4fsQ.js";/* empty css                                                                    */import"./Pagination-Nz0PhK3s.js";import"./DialogForm.vue_vue_type_script_setup_true_lang-BTf40oxg.js";import"./article-BXudWWKl.js";/* empty css                                                                              */import"./UploadAvatar.vue_vue_type_style_index_0_scoped_3ec2e0ca_lang-CloSefEz.js";import"./vuedraggable.umd-CLczY9wy.js";import"./Image.vue_vue_type_script_setup_true_lang-oDjiJjwB.js";import"./BusinessImg-Dt_2PeVb.js";import"./RadioType-BLsVTk5U.js";import"./SelectBrand-DSwX5rvc.js";import"./brand-JXPhU1RM.js";import"./SelectCategory.vue_vue_type_script_setup_true_lang-DH07CGtZ.js";import"./category-0ZzOrTFu.js";import"./SelectShopProductCategory.vue_vue_type_script_setup_true_lang-CrgZMQ3v.js";import"./shopProductCategory-o4waiUa_.js";import"./BusinessData-Dur53bjV.js";import"./ProductDesc-DeCzXEit.js";import"./Editor.vue_vue_type_style_index_0_lang-CJqyZ8fW.js";import"./PriceInput.vue_vue_type_script_setup_true_lang-3H48udRD.js";import"./Attr-WTLZJgXu.js";import"./PopSelect.vue_vue_type_style_index_0_scoped_5832cf6b_lang-DhDNvZWl.js";const me={class:"product-container"},ve={class:"anchor"},fe={class:"tab-row"},ge={id:"part1",class:"form-warp"},ye={id:"part2",class:"form-warp"},he={id:"part3",class:"form-warp"},Ie={id:"part4",class:"form-warp"},ke={id:"part5",class:"form-warp"},Le=Z({__name:"Info",props:{id:{type:Number,default:0},shopId:{type:Number,default:0},act:{type:String,default:""},type:{type:String,default:""},examine:{type:Number,default:0},isDialog:Boolean},emits:["submitCallback","update:confirmLoading","close","closeConfirm"],setup(s,{expose:F,emit:A}){ee();const p=A,u=s,E=[{title:"基本信息",id:"part1"},{title:"价格及库存",id:"part2"},{title:"物流及配送",id:"part3"},{title:"商品详情",id:"part4"},{title:"高级信息",id:"part5"}],d=l(u.type),P=l(null),g=l(""),$=t=>{t.preventDefault()},j=t=>{g.value=t},n=l(!0),_=te().currentRoute.value.query,m=l(u.isDialog?u.act:String(_.act)),c=l(u.isDialog?u.id:Number(_.id)),z=m.value==="add"?"create":m.value==="copy"?"copy":"update",V=ae(),y=l(!1),a=l({snType:1,productType:1,freeShipping:0,shopCategoryId:0,productStatus:1,giveIntegral:-1,rankIntegral:-1,integral:0,isSupportCod:0,productVideoInfo:[],productDescArr:[],productRelated:[],serviceList:[],eCardList:[],productList:[],limitNumber:"",virtualSample:"",paidContent:[],noShipping:0,fixedShippingType:1,attrList:{normal:[],spe:[],extra:[]},vendorProductId:0});ie(a.value,t=>{t.productType!=1&&(a.value.noShipping=1)});const M=l([]);oe(async()=>{await K(!1),M.value=[{key:1,title:"普通商品"}],m.value==="detail"||m.value==="copy"||m.value==="again"?await J():n.value=!1,setTimeout(()=>{p("closeConfirm",!0)},1e4)});const B=l([]),J=async()=>{try{const t=await ue("detail",{id:c.value});t.productRelated==null&&(t.productRelated=[]),t.brandId==0&&(t.brandId=""),t.shippingTplId==0&&(t.shippingTplId=""),t.limitNumber===0?(t.limitNumber="",y.value=!1):y.value=!0,t.vendorId&&(d.value="vendor"),a.value.serviceList=a.value.serviceList.map(e=>{var i;return{...e,check:(i=t.productServiceIds)!=null&&i.includes(e.productServiceId)?1:0}}),Object.assign(a.value,t,t)}catch(t){f.error(t.message),p("close")}finally{n.value=!1}},K=async(t=!0)=>{var e;try{const i=await de({shopId:u.shopId});B.value=i.attrTplList,a.value.serviceList=i.serviceList,a.value.serviceList=(e=i.serviceList)==null?void 0:e.map(v=>{var S;return{...v,check:(S=i.item.productServiceIds)!=null&&S.includes(v.productServiceId)?1:0}}),a.value.suppliersList=i.suppliersList,a.value.shippingTplList=i.shippingTplList,a.value.eCardList=i.eCardList}catch(i){f.error(i.message),p("close")}finally{n.value=!1}};function O(t){for(let e=0;e<t.length;e++){const i=t[e];if(!i.attrValues||i.attrValues.length===0||i.attrValues.some(v=>v==="")||i.skuStock===null||i.skuStock===void 0)return console.error("请填写完整的规格信息"),!1}return!0}const x=l(),G=async()=>{try{if(await V.value.validate(),a.value.productType==4&&a.value.paidContent.length==0){f.error("付费内容信息不能为空!"),await R(),b(".goods-info-edit-row");return}a.value.productType!==3&&(!O(a.value.productList)&&d.value!=="vendor"?(f.error("请将商品规格的信息填写完整!"),x.value.skuErrorText="请将商品规格的信息填写完整",await R(),b(".sku-error")):x.value.skuErrorText="",await x.value.attrForm.validateProductSku()),a.value.attrList.spe.length>0&&(a.value.productStock=0);try{p("update:confirmLoading",!0),a.value.productServiceIds=a.value.serviceList.filter(e=>e.check===1).map(e=>e.productServiceId),a.value.limitNumber=y.value?a.value.limitNumber:0;const t=await ce(z,{...a.value});u.act==="again"&&await pe({id:c.value}),p("submitCallback",t),f.success(t)}catch(t){f.error(t.message)}finally{console.log("提交完成"),p("update:confirmLoading",!1)}}catch(t){await R(),b(),console.error("表单验证失败:",t)}},b=(t=".el-form-item.is-error")=>{const e=document.querySelector(t);if(e){e.scrollIntoView({behavior:"instant",block:"center"});const i=e.querySelector("input, textarea, select");i&&(i==null||i.focus())}};return F({onFormSubmit:()=>{G()}}),(t,e)=>{const i=w("el-anchor-link"),v=w("el-anchor"),S=w("el-form");return h(),U("div",me,[o("div",ve,[I(v,{container:P.value,offset:10,direction:"horizontal",onChange:j,onClick:$},{default:C(()=>[o("div",fe,[(h(),U(re,null,se(E,(r,D)=>I(i,{key:r.id,class:q({active:g.value===""&&D===0?!0:g.value==="#"+r.id}),href:"#"+r.id},{default:C(()=>[o("div",{class:q([{active:g.value===""&&D===0?!0:g.value==="#"+r.id},"item"])},le(r.title),3)]),_:2},1032,["class","href"])),64))])]),_:1},8,["container"])]),o("div",{ref_key:"containerRef",ref:P,class:"form-container"},[n.value?N("",!0):(h(),T(S,{key:0,ref_key:"formRef",ref:V,model:a.value,"label-width":"110px",name:"form_in_modal"},{default:C(()=>[o("div",ge,[e[6]||(e[6]=o("div",{class:"title"},[o("p",{class:"xian"}),k(" 基本信息 ")],-1)),I(L(Q),{type:d.value,id:c.value,shopId:s.shopId,examine:s.examine,loading:n.value,action:m.value,"form-state":a.value,"onUpdate:formState":e[0]||(e[0]=r=>a.value=r)},null,8,["type","id","shopId","examine","loading","action","form-state"])]),o("div",ye,[e[7]||(e[7]=o("div",{class:"title"},[o("p",{class:"xian"}),k(" 价格及库存 ")],-1)),d.value!=="vendor"?(h(),T(L(Y),{key:0,ref_key:"priceInfoRef",ref:x,id:c.value,shopId:s.shopId,act:s.act,examine:s.examine,attrTplList:B.value,isLimit:y.value,"onUpdate:isLimit":e[1]||(e[1]=r=>y.value=r),loading:n.value,"form-state":a.value,"onUpdate:formState":e[2]||(e[2]=r=>a.value=r)},null,8,["id","shopId","act","examine","attrTplList","isLimit","loading","form-state"])):N("",!0)]),o("div",he,[e[8]||(e[8]=o("div",{class:"title"},[o("p",{class:"xian"}),k(" 物流及配送 ")],-1)),d.value!=="vendor"||d.value=="vendor"&&a.value.vendorProductId>0?(h(),T(L(X),{key:0,id:c.value,shopId:s.shopId,examine:s.examine,loading:n.value,"form-state":a.value,"onUpdate:formState":e[3]||(e[3]=r=>a.value=r)},null,8,["id","shopId","examine","loading","form-state"])):N("",!0)]),o("div",Ie,[e[9]||(e[9]=o("div",{class:"title"},[o("p",{class:"xian"}),k(" 商品详情 ")],-1)),I(L(W),{type:d.value,id:c.value,shopId:s.shopId,examine:s.examine,loading:n.value,"form-state":a.value,"onUpdate:formState":e[4]||(e[4]=r=>a.value=r)},null,8,["type","id","shopId","examine","loading","form-state"])]),o("div",ke,[e[10]||(e[10]=o("div",{class:"title"},[o("p",{class:"xian"}),k(" 高级信息 ")],-1)),I(L(H),{id:c.value,shopId:s.shopId,examine:s.examine,loading:n.value,"form-state":a.value,"onUpdate:formState":e[5]||(e[5]=r=>a.value=r)},null,8,["id","shopId","examine","loading","form-state"])])]),_:1},8,["model"]))],512)])}}}),st=ne(Le,[["__scopeId","data-v-4cdc9a45"]]);export{st as default};
