import"./index-BdoKLCH8.js";import{i as W}from"./format-CpNC4fsQ.js";import{a as X}from"./product-DiKWBvyV.js";import{d as Y,cf as Z,cU as U,o as ee,r as m,v as le,a9 as te,J as O,e as V,f as n,g as s,F as _,h as o,y as k,k as f,l as c,j as g,i as F,K as r,t as w,m as se,_ as ae}from"./index-BGgofOm4.js";/* empty css                                                                    */import{P as oe}from"./Pagination-Nz0PhK3s.js";import{_ as de}from"./DialogForm.vue_vue_type_script_setup_true_lang-BTf40oxg.js";import"./SelectTimeInterval.vue_vue_type_style_index_0_scoped_207fe586_lang-CdQ8MEGg.js";const ue={class:"lyecs-product-select-group"},ie={key:2,class:"ml10"},ne={key:0,class:"lyecs-product-selected-con"},ce={class:"product-selected-list"},re={class:"product-selected-list-tr product-selected-list-th"},ve={key:0,class:"col col3"},ke={class:"col col1"},fe={class:"col col4 product-info"},pe=["src"],me={class:"product-name"},ye={key:0,class:"product-sku"},ge={key:0,class:"col col3"},Se={key:1,class:"col col3"},be={key:2,class:"col col3"},Ie={class:"col col3"},xe={key:0,class:"pagination-con"},Me={class:"dialog-footer"},Ce=Y({__name:"SelectProduct",props:Z({max:{type:Number,default:-1},isMultiple:{type:Boolean,default:!0},disabled:{type:Boolean,default:!1},isSku:{type:Boolean,default:!1},isGift:{type:Boolean,default:!1},isSelf:{type:Number,default:0}},{ids:{type:Array,default:[]},idsModifiers:{},skuId:{type:String,default:""},skuIdModifiers:{},skuStock:{type:Number,default:0},skuStockModifiers:{}}),emits:["update:ids","update:skuId","update:skuStock"],setup(l,{expose:$}){const S=l,a=U(l,"ids"),v=U(l,"skuId"),b=U(l,"skuStock");ee(async()=>{a.value&&a.value.length>0&&await P(a.value)});const p=m([]),z=m(0),j=le(),N=m(!0),I=te({page:1,size:j.get("pageSize"),sortField:"",sortOrder:"",keyword:""}),L=m(""),P=async d=>{N.value=!0;try{L.value=Array.isArray(d)?d.join(","):"";const e=await X({ids:L.value,...I});p.value=e.records,z.value=e.total}catch(e){O.error(e.message)}finally{N.value=!1}},D=d=>{let e=a.value;if(v.value="",b.value=0,S.isMultiple==!1&&(e=[]),S.isSku)e.push(d[0].productId),d[0].skuIds&&(v.value=d[0].skuIds[0]);else for(let i in d)e.push(d[i]);a.value=e,P(e)},R=()=>{p.value=[],a.value=[]},E=d=>{let e=p.value[d].productId;a.value=a.value.filter(i=>i!==e),p.value.splice(d,1),z.value--},h=m(),y=m(!1),B=m({}),J=d=>{d.skuIds=[v.value],B.value=d,y.value=!0},T=()=>{B.value="",y.value=!1},K=()=>{h.value.skuIds.length>0?(v.value=h.value.skuIds[0],B.value="",y.value=!1):O.error("请选择规格")};return $({ids:a,productList:p}),(d,e)=>{var G;const i=V("el-button"),q=V("el-space"),A=V("TigInput"),H=V("SelectSku"),Q=V("el-dialog");return s(),n(_,null,[o("div",ue,[k(q,null,{default:c(()=>{var t,x,M,C;return[l.disabled?(s(),g(i,{key:1,disabled:l.max>0&&((t=a.value)==null?void 0:t.length)>=l.max||l.disabled,type:"primary"},{default:c(()=>e[6]||(e[6]=[r("选择商品",-1)])),_:1,__:[6]},8,["disabled"])):(s(),g(F(de),{key:0,params:{selectedIds:a.value,isMultiple:S.isMultiple,isSku:S.isSku,isSelf:S.isSelf},isDrawer:"",path:"product/product/src/SelectProduct",title:"选择商品",width:"600px",onOkCallback:D},{default:c(()=>{var u;return[k(i,{disabled:l.max>0&&((u=a.value)==null?void 0:u.length)>=l.max,type:"primary"},{default:c(()=>e[5]||(e[5]=[r("选择商品",-1)])),_:1,__:[5]},8,["disabled"])]}),_:1},8,["params"])),l.isMultiple&&((x=a.value)==null?void 0:x.length)>0?(s(),n("span",ie,[e[7]||(e[7]=r("已选择 ",-1)),o("b",null,w((M=a.value)==null?void 0:M.length),1),e[8]||(e[8]=r(" 个商品",-1))])):f("",!0),l.isMultiple&&((C=a.value)==null?void 0:C.length)>0?(s(),g(i,{key:3,disabled:l.disabled,onClick:R},{default:c(()=>e[9]||(e[9]=[r("清空",-1)])),_:1,__:[9]},8,["disabled"])):f("",!0)]}),_:1}),p.value.length>0&&!N.value?(s(),n("div",ne,[o("div",ce,[o("div",re,[e[10]||(e[10]=o("div",{class:"col col1"},"商品编号",-1)),e[11]||(e[11]=o("div",{class:"col col4"},"商品信息",-1)),e[12]||(e[12]=o("div",{class:"col col3"},"商品库存",-1)),l.isSku&&l.isGift?(s(),n("div",ve,"赠品库存")):f("",!0),e[13]||(e[13]=o("div",{class:"col col3"},"操作",-1))]),(s(!0),n(_,null,se(p.value,(t,x)=>{var M,C;return s(),n("div",{key:x,class:"product-selected-list-tr"},[o("div",ke,w(t.productSn),1),o("div",fe,[o("div",null,[o("img",{src:F(W)(t.picThumb),height:"50",width:"50"},null,8,pe)]),o("div",null,[o("div",me,w(t.productName),1),l.isSku&&v.value?(s(),n("div",ye,[k(i,{disabled:l.disabled,link:"",size:"mini",onClick:u=>J(t)},{default:c(()=>e[14]||(e[14]=[r("+ 已选1个规格",-1)])),_:2,__:[14]},1032,["disabled","onClick"])])):f("",!0)])]),l.isSku&&v.value&&t.productSku!==null?(s(),n("div",ge,w((M=t.productSku.find(u=>u.skuId==v.value))==null?void 0:M.skuStock),1)):(s(),n("div",Se,w(t.productStock),1)),l.isSku&&l.isGift?(s(),n("div",be,[t.productSku!==null?(s(),g(A,{key:0,disabled:l.disabled,min:0,type:"integer",max:(C=t.productSku.find(u=>u.skuId==v.value))==null?void 0:C.skuStock,modelValue:b.value,"onUpdate:modelValue":e[0]||(e[0]=u=>b.value=u),width:"100%"},null,8,["disabled","max","modelValue"])):(s(),g(A,{key:1,disabled:l.disabled,min:0,type:"integer",max:t.productStock,modelValue:b.value,"onUpdate:modelValue":e[1]||(e[1]=u=>b.value=u),width:"100%"},null,8,["disabled","max","modelValue"]))])):f("",!0),o("div",Ie,[k(i,{link:"",type:"primary",class:"del-btn",onClick:u=>E(x),disabled:l.disabled},{default:c(()=>e[15]||(e[15]=[r("删除",-1)])),_:2,__:[15]},1032,["onClick","disabled"])])])}),128))]),l.isMultiple&&((G=a.value)==null?void 0:G.length)>0&&z.value>0?(s(),n("div",xe,[k(F(oe),{page:I.page,"onUpdate:page":e[2]||(e[2]=t=>I.page=t),size:I.size,"onUpdate:size":e[3]||(e[3]=t=>I.size=t),total:z.value,onCallback:P,layout:"slot ,prev, pager, next",background:!1},null,8,["page","size","total"])])):f("",!0)])):f("",!0)]),k(Q,{modelValue:y.value,"onUpdate:modelValue":e[4]||(e[4]=t=>y.value=t),title:"选择规格",width:"500","before-close":T,"close-on-click-modal":!1},{footer:c(()=>[o("div",Me,[k(i,{onClick:T},{default:c(()=>e[16]||(e[16]=[r("取消",-1)])),_:1,__:[16]}),k(i,{type:"primary",onClick:K},{default:c(()=>e[17]||(e[17]=[r("保存",-1)])),_:1,__:[17]})])]),default:c(()=>[y.value?(s(),g(H,{key:0,ref_key:"skuRef",ref:h,productInfo:B.value,isMultiple:l.isMultiple},null,8,["productInfo","isMultiple"])):f("",!0)]),_:1},8,["modelValue"])],64)}}}),Fe=ae(Ce,[["__scopeId","data-v-cdabae10"]]);export{Fe as S};
