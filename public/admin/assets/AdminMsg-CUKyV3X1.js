import{d as P,s as E,v as $,r as i,a9 as D,o as J,A as K,e as A,f as n,g as a,y as f,l as T,h as o,F as S,m as z,k as d,n as L,t as h,j as O,i as q,K as G,J as H,_ as Q}from"./index-BGgofOm4.js";/* empty css                                                                    */import{P as W}from"./Pagination-Nz0PhK3s.js";import X from"./Collapse-CpULPDMt.js";import{a as Y,b as Z,c as ee}from"./adminMsg-gG9brnJg.js";import"./Image.vue_vue_type_script_setup_true_lang-oDjiJjwB.js";import"./format-CpNC4fsQ.js";import"./order-BPrSE32N.js";import"./DetailBtn.vue_vue_type_script_setup_true_lang-ELYGUIHh.js";import"./index-BdoKLCH8.js";import"./index-BS7Hjr9I.js";import"./DialogForm.vue_vue_type_script_setup_true_lang-BTf40oxg.js";import"./aftersales-CDgWk3jn.js";const te="/admin/assets/empty-bg-CEmUzxL0.png",se={class:"message_center"},ae={class:"tab_box tab_box1"},ne=["onClick"],oe={key:0,class:"num"},le={class:"tab_box tab_box2"},ie=["onClick"],ue={key:0,class:"num"},ce={class:"list_box"},re={style:{"min-height":"200px"}},de={key:0,class:"item"},pe={key:1,class:"table-empty"},me={key:0,class:"pagination-con"},ge={class:"btn"},ve=P({__name:"AdminMsg",emits:["callback","update:confirmLoading","close"],setup(_e,{emit:M}){const I=E(),b=M,N=$(),c=i([]),C=i([]),r=i(0),g=i(0),v=i(!0),_=i(!0),l=D({page:1,size:N.get("pageSize"),msgType:11}),u=i([]),k=i(0),p=async()=>{b("callback"),_.value=!0;try{const t=await Y({...l}),s=await Z();u.value=t.records,c.value=s,C.value=x(c.value[r.value].child),k.value=t.total,v.value=!1}catch(t){H.error(t.message)}finally{_.value=!1}},w=()=>{b("close")};J(()=>{localStorage.setItem("lastOpenTime",String(K().unix())),p()});const B=async()=>{await ee(),b("callback",!1),p()},R=t=>{r.value=t,g.value=0,u.value.length=0,l.msgType=x(c.value[r.value].child)[0].msgType,p()},U=t=>{l.page=1,g.value=t,u.value.length=0,l.msgType=x(c.value[r.value].child)[t].msgType,p()},V=()=>{c.value[r.value].unreadCount-=1,C.value[g.value].unreadCount-=1,I.messageCount-=1},x=t=>{if(typeof t=="object"){var s=[];for(let y in t)s.push(t[y]);return s}else return t};return(t,s)=>{const y=A("a-spin"),j=A("el-button");return a(),n("div",null,[f(y,{spinning:v.value},{default:T(()=>[o("div",se,[o("div",ae,[(a(!0),n(S,null,z(c.value,(e,m)=>(a(),n("div",null,[e.catId!=4?(a(),n("div",{key:0,class:L(["tab",r.value==m?"current":""]),onClick:F=>R(m)},[o("p",null,h(e.catName),1),e.unreadCount>0?(a(),n("p",oe,h(e.unreadCount),1)):d("",!0)],10,ne)):d("",!0)]))),256))]),o("div",le,[(a(!0),n(S,null,z(C.value,(e,m)=>(a(),n("div",{class:L(["tab",g.value==m?"current":""]),onClick:F=>U(m)},[o("p",null,h(e.name),1),e.unreadCount>0?(a(),n("p",ue,h(e.unreadCount),1)):d("",!0)],10,ie))),256))]),o("div",ce,[f(y,{spinning:_.value&&!v.value,style:{width:"100%"}},{default:T(()=>[o("div",re,[u.value.length>0?(a(),n("div",de,[(a(!0),n(S,null,z(u.value,e=>(a(),O(X,{item:e,msgType:e.msgType,key:e.msgType,onSetReadedCallback:V,onClose:w},null,8,["item","msgType"]))),128))])):d("",!0),u.value.length===0&&!_.value&&!v.value?(a(),n("div",pe,s[2]||(s[2]=[o("img",{src:te,alt:""},null,-1),o("p",null,"当前暂无消息哟",-1)]))):d("",!0)])]),_:1},8,["spinning"]),u.value.length>0&&k.value>0?(a(),n("div",me,[f(q(W),{page:l.page,"onUpdate:page":s[0]||(s[0]=e=>l.page=e),size:l.size,"onUpdate:size":s[1]||(s[1]=e=>l.size=e),background:!1,total:k.value,onCallback:p},null,8,["page","size","total"])])):d("",!0)]),o("div",ge,[f(j,{onClick:B},{default:T(()=>s[3]||(s[3]=[G("全部已读",-1)])),_:1,__:[3]})])])]),_:1},8,["spinning"])])}}}),Ie=Q(ve,[["__scopeId","data-v-cd9cbfaf"]]);export{Ie as default};
