import{d as X,r,a as Y,a2 as Z,o as $,J as D,e as s,f as b,g as p,h as f,j as Q,k as B,y as t,l as i,E as R,K as g,i as S,I as q,t as F,F as ee,m as te,_ as ae}from"./index-BGgofOm4.js";import{c as oe,q as le}from"./order-BPrSE32N.js";/* empty css                                                                    */import{P as ie}from"./ProductCard-BI6ohnfl.js";import"./SelectTimeInterval.vue_vue_type_style_index_0_scoped_207fe586_lang-CdQ8MEGg.js";import"./index-BdoKLCH8.js";import{p as se}from"./format-CpNC4fsQ.js";/* empty css                                                                              */import{S as ne}from"./SelectLogisticsCompany-BzS5cxgb.js";import{M as re}from"./index-BS7Hjr9I.js";import"./time-BL_Iz6xX.js";import"./logisticsCompany-6jh7zrIw.js";const ue={class:"container"},de={class:"content_wrapper"},pe={class:"lyecs-form-table"},ce={key:1},me=X({__name:"ToShip",props:{id:{type:Number,default:0},act:{type:String,default:""},isDialog:Boolean},emits:["submitCallback","update:confirmLoading","close","okType"],setup(L,{expose:U,emit:E}){const u=E;u("okType",!1);const c=L,_=r(!0),I=Y().currentRoute.value.query,N=r(c.isDialog?c.act:String(I.act)),T=r(c.isDialog?c.id:Number(I.id));N.value;const V=Z(),o=r({items:[],shippingMethod:1,shippingTypeId:1}),m=r(!1),v=r([]),h=r(),x=r(!1);$(()=>{P()});const O=(l,e)=>l.toDeliveryQuantity>0,P=async()=>{try{_.value=!0;const l=await oe(N.value,{id:T.value});Object.assign(o.value,l),o.value.items&&(o.value.items.forEach(e=>{e.toDeliveryQuantity=e.allowDeliverNum}),o.value.items.length===1&&o.value.items[0].productType!==1&&(o.value.shippingMethod=3,x.value=!0))}catch(l){D.error(l.message),u("close")}finally{_.value=!1}},w=()=>{const l=[];m.value=!1,v.value.length>0&&v.value.forEach(e=>{console.log(e),e.toDeliveryQuantity<e.allowDeliverNum&&(m.value=!0),l.push({itemId:e.itemId,toDeliveryQuantity:e.toDeliveryQuantity})}),h.value=l,m.value===!1&&(m.value=v.value.length<o.value.items.length)},C=async()=>{m.value===!1?M():re.confirm({title:"您当前只选择了部份商品发货，系统将会自动将订单进行拆分，是否确认继续发货？",onOk:async()=>{M()}})},M=async()=>{await V.value.validate();try{u("update:confirmLoading",!0),console.log(h.value);const l=await le({id:T.value,deliverData:h.value,shippingMethod:o.value.shippingMethod,logisticsId:o.value.logisticsId,trackingNo:o.value.trackingNo});u("submitCallback",l),D.success("操作成功")}catch(l){D.error(l.message)}finally{u("update:confirmLoading",!1)}},j=l=>{v.value=l,w(),u("okType",v.value.length>0)};return U({onFormSubmit:()=>{C()}}),(l,e)=>{const k=s("el-radio"),A=s("el-radio-group"),y=s("el-form-item"),J=s("TigInput"),n=s("el-table-column"),K=s("el-input-number"),z=s("el-table"),G=s("el-button"),H=s("el-form"),W=s("a-spin");return p(),b("div",ue,[f("div",de,[f("div",pe,[e[7]||(e[7]=f("div",{class:"button-card babyBlue pd15"},"提示：如果订单分开发货，系统会自动将订单拆分为不同订单！",-1)),_.value?B("",!0):(p(),Q(H,{key:0,ref_key:"formRef",ref:V,model:o.value,"label-width":"auto"},{default:i(()=>[t(y,{label:"配送方式",prop:"shippingMethod"},{default:i(()=>[f("div",null,[t(A,{modelValue:o.value.shippingMethod,"onUpdate:modelValue":e[0]||(e[0]=a=>o.value.shippingMethod=a),disabled:x.value},{default:i(()=>[t(k,{value:1},{default:i(()=>e[3]||(e[3]=[g("物流配送",-1)])),_:1,__:[3]}),t(k,{value:2},{default:i(()=>e[4]||(e[4]=[g("商家配送",-1)])),_:1,__:[4]}),t(k,{value:3},{default:i(()=>e[5]||(e[5]=[g("无需配送",-1)])),_:1,__:[5]})]),_:1},8,["modelValue","disabled"])])]),_:1}),R(f("div",null,[t(y,{label:"物流公司",prop:"logisticsId",rules:[{required:!1,message:"请选择物流公司"}]},{default:i(()=>[t(S(ne),{logisticsId:o.value.logisticsId,"onUpdate:logisticsId":e[1]||(e[1]=a=>o.value.logisticsId=a)},null,8,["logisticsId"])]),_:1}),o.value.shippingMethod===1?(p(),Q(y,{key:0,label:"快递单号",prop:"trackingNo"},{default:i(()=>[t(J,{width:"100%",modelValue:o.value.trackingNo,"onUpdate:modelValue":e[2]||(e[2]=a=>o.value.trackingNo=a)},null,8,["modelValue"])]),_:1})):B("",!0)],512),[[q,o.value.shippingMethod===1]]),t(z,{data:o.value.items,style:{width:"100%"},onSelectionChange:j},{default:i(()=>[t(n,{type:"selection",width:"50",selectable:O}),t(n,{label:"商品名称",prop:"productId",width:"250"},{default:i(({row:a})=>[t(S(ie),{picThumb:a.picThumb,productId:a.productId,productName:a.productName,productType:a.productType,url:a.url},null,8,["picThumb","productId","productName","productType","url"])]),_:1}),t(n,{label:"属性",prop:"productAttr"},{default:i(({row:a})=>[g(F(a.skuValue||"无属性"),1)]),_:1}),t(n,{label:"附加规格",prop:"extraSkuData"},{default:i(({row:a})=>[a.extraSkuData&&a.extraSkuData.length>0?(p(!0),b(ee,{key:0},te(a.extraSkuData,d=>(p(),b("div",{class:"extraskudata",key:d},F(d.attrName+d.attrValue+S(se)(d.totalAttrPrice)),1))),128)):(p(),b("div",ce,"无附加规格"))]),_:1}),t(n,{label:"商品编号",prop:"productSn"}),t(n,{label:"库存",prop:"stock"}),t(n,{label:"数量",prop:"quantity"}),t(n,{label:"待发货数量",prop:"toDeliveryQuantity",width:"120"},{default:i(({row:a})=>[t(K,{class:"input-number","controls-position":"right",modelValue:a.toDeliveryQuantity,"onUpdate:modelValue":d=>a.toDeliveryQuantity=d,onChange:w,type:"number",min:1,max:a.allowDeliverNum},null,8,["modelValue","onUpdate:modelValue","max"])]),_:1})]),_:1},8,["data"]),R(t(y,{"wrapper-col":{offset:4,span:16}},{default:i(()=>[t(G,{ref:"submitBtn",class:"form-submit-btn",type:"primary",onClick:C},{default:i(()=>e[6]||(e[6]=[g("提交 ",-1)])),_:1,__:[6]},512)]),_:1},512),[[q,!c.isDialog]])]),_:1},8,["model"])),t(W,{spinning:_.value,style:{width:"100%","margin-top":"100px"}},null,8,["spinning"])])])])}}}),Ve=ae(me,[["__scopeId","data-v-7f4e6c5c"]]);export{Ve as default};
