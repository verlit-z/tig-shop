import{v as p,r,a9 as P,c as w,i as C,J as i}from"./index-BGgofOm4.js";function B(s,u=[]){const f=p(),h=s.getPageSize?s.getPageSize():f.get("pageSize"),m=s.idKey||"id",c={page:1,size:h,...s.defaultParams},g=r([]),l=r(!1),d=r(0),o=r([]),a=P({...c}),v=w(()=>{const e=C(s.apiFunction);return typeof e=="function"?e:()=>Promise.reject("API function is invalid")}),y=()=>{if(u.length==0)Object.assign(a,c);else for(let e in c)u.includes(e)||(a[e]=c[e]);n()},n=async()=>{l.value=!0;try{a.keyword&&(a.keyword=a.keyword.trim(),console.log(a.keyword,"：没用？"));const e=await v.value(a);g.value=e.records,d.value=e.total}catch(e){i.error(e.message||"请求失败")}finally{l.value=!1}};return{listData:g,loading:l,total:d,selectedIds:o,filterParams:a,loadData:n,onSearchSubmit:()=>{a.page=1,n()},onSortChange:({prop:e,order:t})=>{a.sortField=e,a.sortOrder=t==="ascending"?"asc":t==="descending"?"desc":"",n()},onPageChange:(e,t)=>{a.page=e,a.size=t,n()},onSelectChange:e=>{o.value=e.map(t=>t[m])},onBatchAction:async(e,t)=>{if(o.value.length===0){i.warning("请至少选择一项");return}try{await t(e,{ids:o.value}),i.success("操作成功"),n(),o.value=[]}catch(S){i.error(S.message||"操作失败")}},resetParams:y}}export{B as u};
