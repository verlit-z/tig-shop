import{d as le,r as y,a as ae,a2 as oe,ac as x,o as te,J as _,a9 as ue,e as f,f as g,g as n,h as o,j as m,k as i,l as u,y as t,E as se,n as k,t as C,K as r,i as q,F as de,m as ne,I as re,_ as ie}from"./index-BGgofOm4.js";import{R as pe}from"./RadioType-BLsVTk5U.js";import{a as me,c as ve,e as ye}from"./coupon-CE2JR07k.js";import"./SelectTimeInterval.vue_vue_type_style_index_0_scoped_207fe586_lang-CdQ8MEGg.js";import"./index-BdoKLCH8.js";/* empty css                                                                    */import{S as fe}from"./SelectGoodsRange-B8YVMxyz.js";/* empty css                                                                              */import{S as ge}from"./SelectTimeInterval-B3x_Nno7.js";import{f as D}from"./time-BL_Iz6xX.js";import{B}from"./BusinessData-Dur53bjV.js";/* empty css                                                                  */import"./index-BS7Hjr9I.js";import"./SelectBrand-DSwX5rvc.js";import"./brand-JXPhU1RM.js";import"./SelectCategory.vue_vue_type_script_setup_true_lang-DH07CGtZ.js";import"./category-0ZzOrTFu.js";import"./SelectProduct-DqHrlW58.js";import"./format-CpNC4fsQ.js";import"./product-DiKWBvyV.js";import"./Pagination-Nz0PhK3s.js";import"./DialogForm.vue_vue_type_script_setup_true_lang-BTf40oxg.js";const be={class:"container"},De={class:"content_wrapper"},ce={class:"lyecs-form-table"},Ve={class:"tig-radio"},Te={class:"flex mb20"},we={class:"flex"},Ue={class:"check-box"},Ne={key:0,class:"flex"},xe={key:1,class:"flex disabled"},_e={class:"mr10"},ke={class:"flex mb20"},Ye={class:"flex"},Re={class:"mr10"},Me={class:"tig-radio"},Se={class:"flex mb20"},Ce={class:"flex flex-align-center"},Ie={class:"flex mb20"},Ee={class:"flex"},He={key:0,class:"extra"},Oe={class:"extra"},Ae={key:0},qe={key:0,class:"extra red"},Be={class:"flex",style:{"align-items":"flex-end"}},Le=le({__name:"Info",props:{id:{type:Number,default:0},couponType:{type:Number,default:0},isNewUser:{type:Number,default:0},act:{type:String,default:""},isDialog:{type:Boolean,default:!1}},emits:["submitCallback","update:confirmLoading","close"],setup(L,{expose:P,emit:$}){const c=$,I=y([]),v=L,V=y(!0),T=ae().currentRoute.value.query,Y=y(v.isDialog?v.act:String(T.act)),w=y(v.isDialog?v.id:Number(T.id)),E=y(v.isDialog?v.couponType:Number(T.couponType)),R=y(v.isDialog?v.isNewUser:Number(T.isNewUser)),F=Y.value==="add"?"create":"update",H=oe(),e=y({sendRange:0,sendRangeData:[],isGlobal:0,isShow:1,couponType:E.value||1,isNewUser:R.value||0,couponUnit:1,reduceType:1,sendType:1,limitUserRank:[],useStartDate:D(new Date,"YYYY-MM-DD HH:mm:ss"),useEndDate:D(x(1,"add"),"YYYY-MM-DD HH:mm:ss"),delayDay:0,sendNum:1e3,couponMoney:20,couponDiscount:8,minOrderAmount:100,maxOrderAmount:0,limitNum:R.value==1?1:0}),U=y(!0),M=y(0),O=d=>{if(d===-1){M.value=d;return}e.value.useStartDate=D(new Date,"YYYY-MM-DD HH:mm:ss"),d===0&&(e.value.useEndDate=D(x(1,"add"),"YYYY-MM-DD HH:mm:ss")),d===1&&(e.value.useEndDate=D(x(7,"add"),"YYYY-MM-DD HH:mm:ss")),d===2&&(e.value.useEndDate=D(x(15,"add"),"YYYY-MM-DD HH:mm:ss"))};te(()=>{Y.value==="detail"?j():V.value=!1,G()});const j=async()=>{try{const d=await me(Y.value,{id:w.value,couponType:E.value,isNewUser:R.value});Object.assign(e.value,d)}catch(d){_.error(d.message),c("close")}finally{V.value=!1}},G=async()=>{try{const d=await ve();I.value=d}catch(d){_.error(d.message)}finally{V.value=!1}},A=async()=>{if(W()){await H.value.validate();try{c("update:confirmLoading",!0);const d=await ye(F,{id:w.value,...e.value});c("submitCallback",d),_.success("操作成功")}catch(d){_.error(d.message)}finally{c("update:confirmLoading",!1)}}},z=()=>{A()},J=(d,l,s)=>{if(e.value.reduceType==1){if(e.value.couponType==1&&(Number(e.value.minOrderAmount)<=0||Number(e.value.couponMoney)<=0)){s(new Error("请填写"));return}if(e.value.couponType==2&&(Number(e.value.minOrderAmount)<=0||Number(e.value.couponDiscount)<=0)){s(new Error("请填写"));return}s()}else if(e.value.reduceType==2){if(e.value.couponType==1&&Number(e.value.couponMoney)<=0){s(new Error("请填写"));return}if(e.value.couponType==2&&Number(e.value.couponDiscount)<=0){s(new Error("请填写"));return}s()}},K=(d,l,s)=>{if(e.value.sendType==1){if(!e.value.useStartDate&&!e.value.useEndDate){s(new Error("请输入用券时间"));return}s()}else if(e.value.sendType==0){if(!e.value.delayDay&&!e.value.useDay){s(new Error("请输入用券时间"));return}s()}else s()},W=()=>(Number(e.value.sendRange)>0&&e.value.sendRangeData.length==0?U.value=!1:U.value=!0,U.value),Q=ue({couponName:[{required:!0,message:"请输入优惠券名称",trigger:"blur"}],reduceType:[{required:!0,validator:J,trigger:"blur"}],sendType:[{required:!0,validator:K,trigger:"blur"}],sendNum:[{required:!0,message:"请填写发放总量",trigger:"blur"}],limitNum:[{required:!0,message:"请设置领取次数",trigger:"blur"}],limitUserRank:[{required:!0,message:"请选择可用会员等级",trigger:"blur"}]});return P({onFormSubmit:z}),(d,l)=>{const s=f("el-form-item"),b=f("el-radio"),p=f("TigInput"),N=f("el-radio-group"),S=f("el-radio-button"),X=f("el-option"),Z=f("el-select"),h=f("el-button"),ee=f("el-form");return n(),g("div",be,[o("div",De,[o("div",ce,[V.value?i("",!0):(n(),m(ee,{key:0,ref_key:"formRef",ref:H,rules:Q,model:e.value,"label-width":"auto"},{default:u(()=>[e.value.isNewUser!=0?(n(),m(s,{key:0,prop:"couponType",label:"优惠券类型"},{default:u(()=>[t(pe,{modelValue:e.value.couponType,"onUpdate:modelValue":l[0]||(l[0]=a=>e.value.couponType=a),radioList:[{key:1,title:"满减券",desc:"例：满100减20"},{key:2,title:"折扣券",desc:"例：满100打8折"}]},null,8,["modelValue"])]),_:1})):i("",!0),t(s,{prop:"couponName",label:"优惠券名称"},{default:u(()=>[t(B,{width:"450px",modelValue:e.value.couponName,"onUpdate:modelValue":l[1]||(l[1]=a=>e.value.couponName=a),dataId:w.value,dataType:10,maxlength:60},null,8,["modelValue","dataId"])]),_:1}),t(s,{prop:"reduceType",label:"优惠内容"},{default:u(()=>[o("div",Ve,[t(N,{modelValue:e.value.reduceType,"onUpdate:modelValue":l[9]||(l[9]=a=>e.value.reduceType=a)},{default:u(()=>[o("div",Te,[t(b,{value:1}),o("div",we,[l[29]||(l[29]=o("p",{class:"mr10"},"满",-1)),o("div",Ue,[t(p,{type:e.value.couponUnit==1?"decimal":"integer",modelValue:e.value.minOrderAmount,"onUpdate:modelValue":l[4]||(l[4]=a=>e.value.minOrderAmount=a),class:"mr10",width:"240px",disabled:e.value.reduceType==2},{append:u(()=>[e.value.reduceType!=2?(n(),g("div",Ne,[o("div",{class:k(["ml10 item",{active:e.value.couponUnit==1}]),onClick:l[2]||(l[2]=a=>e.value.couponUnit=1)}," 元 ",2),o("div",{class:k(["ml10 item",{active:e.value.couponUnit==2}]),onClick:l[3]||(l[3]=a=>e.value.couponUnit=2)}," 件 ",2)])):(n(),g("div",xe,[o("div",{class:k(["ml10 item",{active:e.value.couponUnit==1}])},"元",2),o("div",{class:k(["ml10 item",{active:e.value.couponUnit==2}])},"件",2)]))]),_:1},8,["type","modelValue","disabled"])]),o("p",_e,", "+C(e.value.couponType==1?"减":"打"),1),e.value.couponType==1?(n(),m(p,{key:0,type:"decimal",modelValue:e.value.couponMoney,"onUpdate:modelValue":l[5]||(l[5]=a=>e.value.couponMoney=a),width:"180px",disabled:e.value.reduceType==2},{append:u(()=>l[27]||(l[27]=[r("元",-1)])),_:1},8,["modelValue","disabled"])):i("",!0),e.value.couponType==2?(n(),m(p,{key:1,type:"decimal",decimalPlaces:1,modelValue:e.value.couponDiscount,"onUpdate:modelValue":l[6]||(l[6]=a=>e.value.couponDiscount=a),width:"180px",disabled:e.value.reduceType==2},{append:u(()=>l[28]||(l[28]=[r("折",-1)])),_:1},8,["modelValue","disabled"])):i("",!0)])]),o("div",ke,[t(b,{value:2}),o("div",Ye,[o("p",Re,"无门槛, "+C(e.value.couponType==1?"减":"打"),1),e.value.couponType==1?(n(),m(p,{key:0,type:"decimal",modelValue:e.value.couponMoney,"onUpdate:modelValue":l[7]||(l[7]=a=>e.value.couponMoney=a),width:"180px",disabled:e.value.reduceType==1},{append:u(()=>l[30]||(l[30]=[r("元",-1)])),_:1},8,["modelValue","disabled"])):i("",!0),e.value.couponType==2?(n(),m(p,{key:1,type:"decimal",decimalPlaces:1,modelValue:e.value.couponDiscount,"onUpdate:modelValue":l[8]||(l[8]=a=>e.value.couponDiscount=a),width:"180px",disabled:e.value.reduceType==1},{append:u(()=>l[31]||(l[31]=[r("折",-1)])),_:1},8,["modelValue","disabled"])):i("",!0)])])]),_:1},8,["modelValue"])])]),_:1}),e.value.couponType==2?(n(),m(s,{key:1,prop:"maxOrderAmount",label:"优惠上限"},{default:u(()=>[o("div",null,[o("div",null,[t(p,{type:"decimal",modelValue:e.value.maxOrderAmount,"onUpdate:modelValue":l[10]||(l[10]=a=>e.value.maxOrderAmount=a),width:"180px"},{append:u(()=>l[32]||(l[32]=[r("元",-1)])),_:1},8,["modelValue"])]),l[33]||(l[33]=o("div",{class:"extra"},"最多可打折的金额, 默认 0 表示无限制",-1))])]),_:1})):i("",!0),t(s,{prop:"sendType",label:"用券时间"},{default:u(()=>[o("div",Me,[t(N,{modelValue:e.value.sendType,"onUpdate:modelValue":l[17]||(l[17]=a=>e.value.sendType=a)},{default:u(()=>[o("div",Se,[t(b,{value:1}),o("div",Ce,[t(q(ge),{"end-date":e.value.useEndDate,"onUpdate:endDate":l[11]||(l[11]=a=>e.value.useEndDate=a),"start-date":e.value.useStartDate,"onUpdate:startDate":l[12]||(l[12]=a=>e.value.useStartDate=a),clearable:!0,width:"180px",type:"datetime","value-format":"YYYY-MM-DD HH:mm:ss",disabled:e.value.sendType==0,onCallback:l[13]||(l[13]=a=>O(-1))},null,8,["end-date","start-date","disabled"]),o("div",null,[t(N,{class:"itemWidth",modelValue:M.value,"onUpdate:modelValue":l[14]||(l[14]=a=>M.value=a),onChange:O,disabled:e.value.sendType==0},{default:u(()=>[t(S,{value:0},{default:u(()=>l[34]||(l[34]=[r("1天",-1)])),_:1,__:[34]}),t(S,{value:1},{default:u(()=>l[35]||(l[35]=[r("7天",-1)])),_:1,__:[35]}),t(S,{value:2},{default:u(()=>l[36]||(l[36]=[r("15天",-1)])),_:1,__:[36]})]),_:1},8,["modelValue","disabled"])])])]),o("div",Ie,[t(b,{value:0}),o("div",Ee,[l[38]||(l[38]=o("p",{class:"mr10"},"领券后",-1)),t(p,{type:"integer",modelValue:e.value.delayDay,"onUpdate:modelValue":l[15]||(l[15]=a=>e.value.delayDay=a),width:"100px",disabled:e.value.sendType==1},null,8,["modelValue","disabled"]),l[39]||(l[39]=o("p",{class:"mr10 ml10"},", 有效期",-1)),t(p,{type:"integer",modelValue:e.value.useDay,"onUpdate:modelValue":l[16]||(l[16]=a=>e.value.useDay=a),width:"180px",disabled:e.value.sendType==1},{append:u(()=>l[37]||(l[37]=[r("天",-1)])),_:1},8,["modelValue","disabled"])])])]),_:1},8,["modelValue"]),e.value.sendType==0?(n(),g("div",He,"领券后默认0天生效, 表示立即生效")):i("",!0)])]),_:1}),t(s,{prop:"sendNum",label:"发放总量"},{default:u(()=>[o("div",null,[o("div",null,[t(p,{type:"integer",modelValue:e.value.sendNum,"onUpdate:modelValue":l[18]||(l[18]=a=>e.value.sendNum=a),width:"180px"},{append:u(()=>l[40]||(l[40]=[r("张",-1)])),_:1},8,["modelValue"])]),l[41]||(l[41]=o("div",{class:"extra"},"修改优惠券总量时只能增加不能减少，请谨慎设置。",-1))])]),_:1}),t(s,{prop:"limitNum",label:"领取次数限制"},{default:u(()=>[o("div",null,[o("div",null,[t(p,{type:"integer",disabled:e.value.isNewUser==1,modelValue:e.value.limitNum,"onUpdate:modelValue":l[19]||(l[19]=a=>e.value.limitNum=a),width:"180px"},{append:u(()=>l[42]||(l[42]=[r("次",-1)])),_:1},8,["disabled","modelValue"])]),o("div",Oe,C(e.value.isNewUser==1?"新人专享券仅限领取一次":"限制每个用户最多可领次数, 默认 0 表示无领取限制"),1)])]),_:1}),e.value.isNewUser==1?(n(),m(s,{key:2,prop:"isNewUser",label:"领取客户限制"},{default:u(()=>[e.value.isNewUser==1?(n(),g("div",Ae,"新人专享")):i("",!0)]),_:1})):i("",!0),e.value.isNewUser==2?(n(),m(s,{key:3,prop:"limitUserRank",label:"领取客户限制"},{default:u(()=>[t(Z,{modelValue:e.value.limitUserRank,"onUpdate:modelValue":l[20]||(l[20]=a=>e.value.limitUserRank=a),multiple:"",placeholder:"请选择",style:{width:"300px"},clearable:""},{default:u(()=>[(n(!0),g(de,null,ne(I.value,a=>(n(),m(X,{key:a.rankId,label:a.rankName,value:a.rankId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):i("",!0),t(s,{prop:"sendRange",label:"适用商品"},{default:u(()=>[o("div",null,[o("div",null,[t(q(fe),{rangeIds:e.value.sendRangeData,"onUpdate:rangeIds":l[21]||(l[21]=a=>e.value.sendRangeData=a),rangeType:e.value.sendRange,"onUpdate:rangeType":l[22]||(l[22]=a=>e.value.sendRange=a),isSelf:1},null,8,["rangeIds","rangeType"])]),Number(e.value.sendRange)>0&&!U.value?(n(),g("div",qe,"请选择商品")):i("",!0)])]),_:1}),t(s,{prop:"isShow",label:"是否展示"},{default:u(()=>[o("div",null,[t(N,{modelValue:e.value.isShow,"onUpdate:modelValue":l[23]||(l[23]=a=>e.value.isShow=a)},{default:u(()=>[t(b,{value:1},{default:u(()=>l[43]||(l[43]=[r("是",-1)])),_:1,__:[43]}),t(b,{value:0},{default:u(()=>l[44]||(l[44]=[r("否",-1)])),_:1,__:[44]})]),_:1},8,["modelValue"])])]),_:1}),t(s,{prop:"couponDesc",label:"券使用说明"},{default:u(()=>[o("div",Be,[t(p,{classType:"tig-form-input",type:"textarea",row:6,modelValue:e.value.couponDesc,"onUpdate:modelValue":l[24]||(l[24]=a=>e.value.couponDesc=a)},null,8,["modelValue"]),t(B,{modelValue:e.value.couponDesc,"onUpdate:modelValue":l[25]||(l[25]=a=>e.value.couponDesc=a),dataId:w.value,dataType:11,type:"textarea"},null,8,["modelValue","dataId"])])]),_:1}),se(t(s,{"wrapper-col":{offset:4,span:16}},{default:u(()=>[t(h,{ref:"submitBtn",class:"form-submit-btn",type:"primary",onClick:l[26]||(l[26]=a=>A())},{default:u(()=>l[45]||(l[45]=[r("提交",-1)])),_:1,__:[45]},512)]),_:1},512),[[re,!v.isDialog]])]),_:1},8,["rules","model"]))])])])}}}),rl=ie(Le,[["__scopeId","data-v-f3b5602f"]]);export{rl as default};
