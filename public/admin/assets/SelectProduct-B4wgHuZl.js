/* empty css             */import{d as W,cf as D,cU as X,r,v as Y,a9 as Z,o as ee,e as d,f as g,g as p,h as o,y as s,k as b,l as a,i as V,K as M,n as te,j as N,t as z,F as le,J as oe,_ as se}from"./index-BGgofOm4.js";import"./SelectTimeInterval.vue_vue_type_style_index_0_scoped_207fe586_lang-CdQ8MEGg.js";import{_ as ae}from"./SelectCategory.vue_vue_type_script_setup_true_lang-DH07CGtZ.js";import"./index-BdoKLCH8.js";import{i as ne}from"./format-CpNC4fsQ.js";import{a as ue}from"./product-DiKWBvyV.js";/* empty css                                                                    */import{P as ie}from"./Pagination-Nz0PhK3s.js";/* empty css                                                                              */import"./time-BL_Iz6xX.js";import"./category-0ZzOrTFu.js";import"./index-BS7Hjr9I.js";const de={class:"container",style:{position:"relative",height:"100%"}},ce={class:"content_wrapper"},re={class:"",style:{display:"flex","flex-direction":"column",width:"100%",height:"100%",position:"absolute"}},pe={class:"list-table-tool lyecs-search-warp",style:{flex:"0"}},fe={class:"list-table-tool-row",style:{"margin-bottom":"5px"}},me={class:"list-table-tool-col"},_e={style:{"padding-right":"15px","box-sizing":"border-box"}},ke={class:"flex"},ge={key:0,class:"span-pic"},ve=["href"],ye=["src"],he={class:"gray"},be={class:"flex"},Se={key:0},Ie={key:1},xe={class:"empty-warp"},Ce={key:0,class:"empty-bg"},we={key:0,class:"pagination-con",style:{"flex-shrink":"0"}},Ve={class:"dialog-footer"},Me=W({__name:"SelectProduct",props:D({selectedIds:{type:Array,default:[]},modelValue:{type:Object,default:{}},isMultiple:{type:Boolean,default:!0},isSku:{type:Boolean,default:!1},isSelf:{type:Number,default:0}},{linkSelectData:{},linkSelectDataModifiers:{}}),emits:D(["submitCallback","okType","update:modelValue"],["update:linkSelectData"]),setup(v,{expose:R,emit:B}){const c=v,P=X(v,"linkSelectData"),f=B;f("okType",!1);const u=r([]),y=r(!0),S=r(0),U=Y(),m=r([]),i=Z({page:1,size:U.get("pageSize"),sortField:"",sortOrder:"",keyword:"",isDelete:0,productStatus:1,checkStatus:1,shopId:c.isSelf?0:-1}),x=async()=>{y.value=!0,c.isSku&&(u.value=[]);try{const t=await ue({...i});m.value=t.records,S.value=t.total}catch(t){oe.error(t.message)}finally{y.value=!1}};ee(()=>{x()});const T=()=>{x()},I=r(),C=r(),A=t=>{if(c.isMultiple){let e=[];t.forEach(n=>{e.push(n.productId)}),u.value=e,f("okType",u.value.length>0)}},_=r({}),k=r(!1),E=(t,e)=>{if(t.includes(e)?c.isSku&&e.productSku!==null&&e.productSku.length>1&&(_.value=e,k.value=!0):e.skuIds=[],!c.isMultiple){if(I.value.clearSelection(),t.length==0){u.value=[];return}I.value.toggleRowSelection(e,!0),u.value.length=0,u.value.push(e.productId),f("okType",u.value.length>0)}P.value={path:"product",label:"商品",name:e.productName,id:e.productId,sn:e.productSn,data:{id:e.productId,sn:e.productSn}},f("update:modelValue",e)},j=t=>{c.isSku&&(t.length!=0?m.value.map(e=>{let n=[];e.productSku.length>1&&(n=e.productSku.map(h=>h.skuId)),e.skuIds=n}):m.value.map(e=>{e.skuIds=[]}))},O=(t,e)=>{var n;return!((n=c.selectedIds)!=null&&n.includes(t.productId))},F=()=>{I.value.toggleRowSelection(_.value,!1),u.value=[],_.value="",k.value=!1},J=()=>{console.log(C.value.skuIds),m.value.forEach(t=>{t.productId==_.value.productId&&(t.skuIds=C.value.skuIds)}),_.value="",k.value=!1};return R({onFormSubmit:()=>{if(c.isSku){const t=m.value.filter(e=>u.value.includes(e.productId)).map(e=>{const n={productId:e.productId};return e.skuIds&&(n.skuIds=e.skuIds),n});f("submitCallback",t)}else f("submitCallback",u.value)}}),(t,e)=>{const n=d("TigInput"),h=d("el-button"),K=d("el-space"),L=d("el-form"),w=d("el-table-column"),$=d("el-table"),q=d("a-spin"),G=d("perfect-scrollbar"),H=d("SelectSku"),Q=d("el-dialog");return p(),g(le,null,[o("div",de,[o("div",ce,[o("div",re,[o("div",pe,[s(L,{model:i,name:"form",onFinish:T},{default:a(()=>[o("div",fe,[o("div",me,[s(K,null,{default:a(()=>[s(V(ae),{categoryId:i.categoryId,"onUpdate:categoryId":e[0]||(e[0]=l=>i.categoryId=l),style:{width:"150px"}},null,8,["categoryId"]),s(n,{width:"230px",modelValue:i.keyword,"onUpdate:modelValue":e[1]||(e[1]=l=>i.keyword=l),placeholder:"商品名称/货号"},null,8,["modelValue"]),s(h,{onClick:T},{default:a(()=>e[5]||(e[5]=[M("搜索",-1)])),_:1,__:[5]})]),_:1})]),e[6]||(e[6]=o("div",{class:"list-table-tool-col"},null,-1))])]),_:1},8,["model"])]),s(G,{class:"table-container",style:{flex:"1"}},{default:a(()=>[s(q,{spinning:y.value},{default:a(()=>[o("div",_e,[s($,{ref_key:"tableRef",ref:I,class:te([v.isMultiple?"":"hide-checkbox","result-table"]),data:m.value,loading:y.value,total:S.value,"row-key":"productId",onSelect:E,onSelectAll:j,onSelectionChange:A},{empty:a(()=>[o("div",xe,[y.value?b("",!0):(p(),g("div",Ce,"暂无数据"))])]),default:a(()=>[s(w,{selectable:O,type:"selection",width:"32"}),s(w,{label:"商品信息",prop:"productId"},{default:a(({row:l})=>[o("div",ke,[l.picThumb?(p(),g("div",ge,[o("a",{href:l.url,target:"_blank"},[o("img",{src:V(ne)(l.picThumb),height:"40",width:"40"},null,8,ye)],8,ve)])):b("",!0),o("div",null,[o("p",null,z(l.productName),1),o("p",he,"货号："+z(l.productSn),1)])])]),_:1}),v.isSku?(p(),N(w,{key:0,label:"规格",prop:"skuId"},{default:a(({row:l})=>[o("div",be,[l.skuIds&&l.skuIds.length>0?(p(),g("p",Se," 已选："+z(l.skuIds.length)+"个规格 ",1)):(p(),g("p",Ie,"--"))])]),_:1})):b("",!0)]),_:1},8,["class","data","loading","total"])])]),_:1},8,["spinning"])]),_:1}),S.value>0?(p(),g("div",we,[s(V(ie),{page:i.page,"onUpdate:page":e[2]||(e[2]=l=>i.page=l),size:i.size,"onUpdate:size":e[3]||(e[3]=l=>i.size=l),total:S.value,onCallback:x,layout:"slot ,prev, pager, next",background:!1},null,8,["page","size","total"])])):b("",!0)])])]),s(Q,{modelValue:k.value,"onUpdate:modelValue":e[4]||(e[4]=l=>k.value=l),title:"选择规格",width:"500","before-close":F,"close-on-click-modal":!1},{footer:a(()=>[o("div",Ve,[s(h,{onClick:F},{default:a(()=>e[7]||(e[7]=[M("取消",-1)])),_:1,__:[7]}),s(h,{type:"primary",onClick:J},{default:a(()=>e[8]||(e[8]=[M("保存",-1)])),_:1,__:[8]})])]),default:a(()=>[k.value?(p(),N(H,{key:0,ref_key:"skuRef",ref:C,productInfo:_.value,isMultiple:v.isMultiple},null,8,["productInfo","isMultiple"])):b("",!0)]),_:1},8,["modelValue"])],64)}}}),Ke=se(Me,[["__scopeId","data-v-7100d7c2"]]);export{Ke as default};
