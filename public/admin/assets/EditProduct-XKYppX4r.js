import{d as $,r as m,a as j,a2 as F,o as M,J as b,c as J,e as n,f as K,g as C,h as r,j as z,k as G,y as e,l,E as H,i as _,K as f,t as I,I as Q,_ as W}from"./index-BGgofOm4.js";import{p as x}from"./format-CpNC4fsQ.js";/* empty css                                                                    */import{P as X}from"./ProductCard-BI6ohnfl.js";import"./index-BdoKLCH8.js";import{c as Y,k as Z,l as tt}from"./order-BPrSE32N.js";import{_ as et}from"./DialogForm.vue_vue_type_script_setup_true_lang-BTf40oxg.js";import"./index-BS7Hjr9I.js";const ot={class:"container"},at={class:"content_wrapper"},lt={class:"lyecs-form-table"},st=["onClick"],nt={class:"operating-style"},rt={class:"operating-left"},it={class:"left"},ut={class:"operating-right"},dt=$({__name:"EditProduct",props:{id:{type:Number,default:0},act:{type:String,default:""},form:{type:Object,default:()=>({})},isDialog:Boolean},emits:["submitCallback","update:confirmLoading","close"],setup(N,{expose:S,emit:T}){const c=T,u=N,p=m(!0),v=j().currentRoute.value.query,g=m(u.isDialog?u.act:String(v.act)),h=m(u.isDialog?u.id:Number(v.id));g.value;const V=F(),i=m(u.form);M(()=>{q()});const q=async()=>{try{p.value=!0;const a=await Y(g.value,{id:h.value});Object.assign(i.value,a)}catch(a){b.error(a.message),c("close")}finally{p.value=!1}},D=J(()=>{let a=0;return i.value.items.forEach(o=>{a+=o.quantity*o.price}),a}),k=async()=>{await V.value.validate();try{c("update:confirmLoading",!0);const a=await Z({id:h.value,items:i.value.items});c("submitCallback",a),b.success("操作成功")}catch(a){b.error(a.message)}finally{c("update:confirmLoading",!1)}},B=()=>{k()},O=async a=>{try{const o=await tt({ids:a});console.log(o),o.forEach(s=>{s.quantity=1,s.itemId=0,i.value.items.push(s)})}catch{}finally{c("update:confirmLoading",!1)}},P=a=>{i.value.items.splice(a,1)};return S({onFormSubmit:B}),(a,o)=>{const s=n("el-table-column"),w=n("TigInput"),E=n("el-input-number"),R=n("el-table"),y=n("el-button"),U=n("el-form-item"),A=n("el-form"),L=n("a-spin");return C(),K("div",ot,[r("div",at,[r("div",lt,[p.value?G("",!0):(C(),z(A,{key:0,ref_key:"formRef",ref:V,model:i.value,"label-width":"auto"},{default:l(()=>[e(R,{data:i.value.items,style:{width:"100%"}},{default:l(()=>[e(s,{type:"selection",width:"50"}),e(s,{label:"商品名称",prop:"productId",width:"320"},{default:l(({row:t})=>[e(_(X),{picThumb:t.picThumb,productId:t.productId,productName:t.productName,productType:t.productType,url:t.url},null,8,["picThumb","productId","productName","productType","url"])]),_:1}),e(s,{label:"货号",prop:"productSn"}),e(s,{label:"价格",prop:"price"},{default:l(({row:t})=>[e(w,{type:"decimal",modelValue:t.price,"onUpdate:modelValue":d=>t.price=d},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),e(s,{label:"数量",prop:"quantity",width:"110"},{default:l(({row:t})=>[e(E,{class:"input-number","controls-position":"right",modelValue:t.quantity,"onUpdate:modelValue":d=>t.quantity=d,type:"number",min:1},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),e(s,{label:"属性",prop:"productAttr"},{default:l(({row:t})=>[e(w,{rows:1,modelValue:t.productAttr,"onUpdate:modelValue":d=>t.productAttr=d,type:"textarea"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),e(s,{label:"小计",prop:"subtotal"},{default:l(({row:t})=>[f(I(_(x)(t.quantity*t.price)),1)]),_:1}),e(s,{label:"操作",prop:"name"},{default:l(t=>[r("a",{onClick:d=>P(t.$index)},"删除",8,st)]),_:1})]),_:1},8,["data"]),r("div",nt,[r("div",rt,[r("div",it,[e(y,{disabled:""},{default:l(()=>o[1]||(o[1]=[f("拆分订单",-1)])),_:1,__:[1]}),e(_(et),{isDrawer:"",onOkCallback:O,title:"选择商品",width:"600px",path:"product/product/src/SelectProduct",params:{isMultiple:!0}},{default:l(()=>[e(y,null,{default:l(()=>o[2]||(o[2]=[f("添加商品",-1)])),_:1,__:[2]})]),_:1})]),o[3]||(o[3]=r("div",null," 提示：手动添加商品时，商品价格为商品基础售价，不会判断促销、满减等活动；已付款或发货的订单无法修改、添加商品。 ",-1))]),r("div",ut,"合计："+I(_(x)(D.value)),1)]),H(e(U,{"wrapper-col":{offset:4,span:16}},{default:l(()=>[e(y,{ref:"submitBtn",class:"form-submit-btn",type:"primary",onClick:o[0]||(o[0]=t=>k())},{default:l(()=>o[4]||(o[4]=[f("提交 ",-1)])),_:1,__:[4]},512)]),_:1},512),[[Q,!u.isDialog]])]),_:1},8,["model"])),e(L,{spinning:p.value,style:{width:"100%","margin-top":"100px"}},null,8,["spinning"])])])])}}}),gt=W(dt,[["__scopeId","data-v-633a5012"]]);export{gt as default};
