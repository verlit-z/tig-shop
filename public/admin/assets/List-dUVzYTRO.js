/* empty css             */import"./index-BdoKLCH8.js";import{_ as ae}from"./Switch.vue_vue_type_script_setup_true_lang-BQY033uH.js";import{D as F}from"./DeleteRecord-C3QKVgd9.js";/* empty css                                                                    */import{P as oe}from"./Pagination-Nz0PhK3s.js";import{d as se,a as R,L as re,v as ne,r as c,a9 as T,Q as le,o as de,J as N,e as _,f,g as i,h as r,k as m,y as s,l as o,j as I,K as y,i as l,t as z,F as ie}from"./index-BGgofOm4.js";import{P as B}from"./PopSelect.vue_vue_type_style_index_0_scoped_5832cf6b_lang-DhDNvZWl.js";import{u as pe,g as P,a as q,d as $,b as ce}from"./shopProductCategory-o4waiUa_.js";import{_ as D}from"./DialogForm.vue_vue_type_script_setup_true_lang-BTf40oxg.js";import"./index-BS7Hjr9I.js";const ue=["href"],_e={class:"container"},me={class:"content_wrapper"},ge={class:"lyecs-table-list-warp"},ye={class:"list-table-tool lyecs-search-warp"},fe={class:"list-table-tool-row"},ve={class:"list-table-tool-col"},he={class:"table-container"},Ie={style:{position:"relative"}},ke=["onClick"],Ce={key:1},be={class:"empty-warp"},Se={key:0,class:"empty-bg"},xe={key:0,class:"pagination-con"},ze={key:0,class:"selected-action-warp selected-warp-left"},Pe={class:"selected-action"},$e=se({__name:"List",setup(Ae){const M=pe(),{currentRoute:E}=R();R(),re();const w=ne(),L=c(w.icoDefinedCss),O=c([]),k=c(!0),C=c(0),b=c([]),j=c([]),d=T({page:1,size:w.get("pageSize"),sortField:"",sortOrder:"",keyword:"",isShow:-1,parentId:0}),S=c([0]);c();const J=le(),v=T({});de(()=>{const a=E.value.query;a.id>0&&(d.parentId=a.id),J.meta.title="",u()});const u=async()=>{k.value=!0;try{const a=await P({...d});O.value=a.records,C.value=a.total}catch(a){N.error(a.message)}finally{k.value=!1}},K=async(a,e,n)=>{v[a.categoryId]={},v[a.categoryId].resolve=n,v[a.categoryId].expandCount=0;const p=await P({page:1,parentId:a.categoryId,size:1e3});n(p.records)},Q=async(a,e)=>{const n=v[a.categoryId];if(n.expandCount++,e&&n.expandCount>1&&!n.prevStatus){const p=await P({page:1,parentId:a.categoryId,size:1e3});n.resolve(p.records)}n.prevStatus=e},x=c(),A=async(a,e)=>{const n=v[e.parentId];if(n){const p=await P({page:1,parentId:e.parentId,size:1e3});x.value.store.states.lazyTreeNodeMap.value[e.parentId].length>1?x.value.store.states.lazyTreeNodeMap[e.parentId]=[]:x.value.store.states.lazyTreeNodeMap.value[e.parentId]=[],n.resolve(p.records)}else await u()},U=()=>{M.clearShopProductCategory()},G=a=>{S.value.push(a),d.parentId=a,u()},H=()=>{S.value.pop(),d.parentId=S.value[S.value.length-1],u()},W=async a=>{try{const e=await ce(a,{ids:b.value});N.success("操作成功"),await u()}catch(e){N.error(e.message)}},X=a=>{b.value=a.map(e=>e.categoryId)};return(a,e)=>{const n=_("el-button"),p=_("el-space"),Y=_("el-form"),h=_("el-table-column"),V=_("el-divider"),Z=_("el-table"),ee=_("a-spin"),te=_("el-popconfirm");return i(),f(ie,null,[r("link",{href:L.value,rel:"stylesheet"},null,8,ue),r("div",_e,[r("div",me,[r("div",ge,[r("div",ye,[s(Y,{model:d,name:"form"},{default:o(()=>[r("div",fe,[r("div",ve,[s(p,null,{default:o(()=>[d.parentId>0?(i(),I(n,{key:0,onClick:H},{default:o(()=>e[3]||(e[3]=[r("i",{class:"iconfont icon-fanhui",style:{"font-size":"14px","padding-right":"5px"}},null,-1),y(" 返回上一级 ",-1)])),_:1,__:[3]})):m("",!0),s(l(D),{params:{act:"add",parentId:d.parentId},isDrawer:"",path:"product/shopProductCategory/Info",title:"添加分类",width:"600px",onOkCallback:u},{default:o(()=>[s(n,{type:"primary"},{default:o(()=>e[4]||(e[4]=[y("添加分类",-1)])),_:1,__:[4]})]),_:1},8,["params"])]),_:1})])])]),_:1},8,["model"])]),r("div",he,[s(ee,{spinning:k.value},{default:o(()=>[s(Z,{data:O.value,"expand-row-keys":j.value,indent:30,load:K,total:C.value,"tree-props":{children:"children",hasChildren:"hasChildren"},lazy:"","row-key":"categoryId",onSelectionChange:X,onExpandChange:Q,ref_key:"tableRef",ref:x},{empty:o(()=>[r("div",be,[k.value?m("",!0):(i(),f("div",Se,"暂无数据"))])]),default:o(()=>[s(h,{type:"selection",width:"32"}),s(h,{label:"分类名称"},{default:o(({row:t})=>[s(p,{style:{height:"30px"}},{default:o(()=>[r("div",Ie,[s(l(B),{"org-value":t.categoryName,"onUpdate:orgValue":g=>t.categoryName=g,params:{id:t.categoryId,field:"categoryName"},requestApi:l(q),label:"分类名称",type:"textarea",onCallback:U},{default:o(()=>[t.hasChildren?(i(),f("a",{key:0,onClick:g=>G(t.categoryId)},z(t.categoryName),9,ke)):(i(),f("span",Ce,z(t.categoryName),1))]),_:2},1032,["org-value","onUpdate:orgValue","params","requestApi"])])]),_:2},1024)]),_:1}),s(h,{key:"isShow",sorter:!0,label:"是否显示"},{default:o(({row:t})=>[s(l(ae),{checked:t.isShow,"onUpdate:checked":g=>t.isShow=g,params:{id:t.categoryId,field:"isShow"},requestApi:l(q)},null,8,["checked","onUpdate:checked","params","requestApi"])]),_:1}),s(h,{key:"sortOrder",sorter:!0,label:"排序"},{default:o(({row:t})=>[s(l(B),{"org-value":t.sortOrder,"onUpdate:orgValue":g=>t.sortOrder=g,params:{id:t.categoryId,field:"sortOrder"},requestApi:l(q),label:"排序",type:"input",onCallback:U},{default:o(()=>[r("div",null,z(t.sortOrder),1)]),_:2},1032,["org-value","onUpdate:orgValue","params","requestApi"])]),_:1}),s(h,{width:200,fixed:"right",label:"操作"},{default:o(({row:t})=>[s(l(D),{params:{act:"detail",id:t.categoryId},data:{parentId:t.parentId},isDrawer:"",path:"product/shopProductCategory/Info",title:"编辑分类",width:"600px",onOkCallback:A},{default:o(()=>e[5]||(e[5]=[r("a",{class:"btn-link"},"编辑",-1)])),_:2,__:[5]},1032,["params","data"]),s(V,{direction:"vertical"}),t.parentId?m("",!0):(i(),I(l(D),{key:0,params:{act:"add",parentId:t.categoryId},data:{parentId:t.parentId||t.categoryId},isDrawer:"",path:"product/shopProductCategory/Info",title:"添加子分类",width:"600px",onOkCallback:A},{default:o(()=>e[6]||(e[6]=[r("a",{class:"btn-link"},"添加子分类",-1)])),_:2,__:[6]},1032,["params","data"])),t.parentId?m("",!0):(i(),I(V,{key:1,direction:"vertical"})),t.parentId?(i(),I(l(F),{key:2,params:{id:t.categoryId},requestApi:l($),onAfterDelete:g=>A({},{parentId:t.parentId})},{default:o(()=>e[7]||(e[7]=[y("删除 ",-1)])),_:2,__:[7]},1032,["params","requestApi","onAfterDelete"])):m("",!0),t.parentId?m("",!0):(i(),I(l(F),{key:3,params:{id:t.categoryId},requestApi:l($),onAfterDelete:u},{default:o(()=>e[8]||(e[8]=[y("删除",-1)])),_:2,__:[8]},1032,["params","requestApi"]))]),_:1})]),_:1},8,["data","expand-row-keys","total"])]),_:1},8,["spinning"]),C.value>0?(i(),f("div",xe,[s(l(oe),{page:d.page,"onUpdate:page":e[0]||(e[0]=t=>d.page=t),size:d.size,"onUpdate:size":e[1]||(e[1]=t=>d.size=t),total:C.value,onCallback:u},null,8,["page","size","total"])])):m("",!0)]),b.value.length>0?(i(),f("div",ze,[r("div",Pe,[s(p,null,{default:o(()=>[r("span",null,[e[9]||(e[9]=y("已选择：",-1)),r("b",null,z(b.value.length),1),e[10]||(e[10]=y(" 项",-1))]),s(te,{title:"您确认要批量删除所选数据吗？",onConfirm:e[2]||(e[2]=t=>W("del"))},{reference:o(()=>[s(n,null,{default:o(()=>e[11]||(e[11]=[y("批量删除",-1)])),_:1,__:[11]})]),_:1})]),_:1})])])):m("",!0)])])])],64)}}});export{$e as default};
