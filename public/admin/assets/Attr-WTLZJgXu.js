import{B as P}from"./BusinessData-Dur53bjV.js";import{P as F}from"./PopSelect.vue_vue_type_style_index_0_scoped_5832cf6b_lang-DhDNvZWl.js";import{d as xe,cf as ae,r as h,cU as ye,c as he,o as we,R as Ne,e as _,f as v,g as u,y as s,j as C,k as x,l as o,F as L,m as S,K as w,h as l,i as N,en as Te,t as se,ad as oe,Z as Ce,_ as Le}from"./index-BGgofOm4.js";import{d as Se}from"./vuedraggable.umd-CLczY9wy.js";import"./index-BdoKLCH8.js";import{i as Ue}from"./format-CpNC4fsQ.js";import{_ as de}from"./PriceInput.vue_vue_type_script_setup_true_lang-3H48udRD.js";import{_ as Pe}from"./DialogForm.vue_vue_type_script_setup_true_lang-BTf40oxg.js";import{M as ie}from"./index-BS7Hjr9I.js";const $e={class:"attr-form"},Ae={class:"attr-list other-attr"},Ee={class:"attr-warp attr-normal-box"},Be={class:"title-box flex align-center"},Ie={class:"tit-value"},je=["onClick"],De={class:"attr-normal-value"},Fe={class:"attr-warp-title"},Me={class:"attr-list"},Oe={class:"attr-warp"},Re=["onClick"],qe={class:"attr-warp-title"},ze={class:"flex align-center"},He={style:{width:"300px"}},Ke={class:"attr-warp-box"},Ze={class:"draggable-item"},Ge={class:"attr-row"},Je={style:{width:"250px"}},Qe=["onClick"],We={key:1,class:"upload-img-wrap"},Xe={class:"pic-select-con"},Ye={key:0,class:"pic-select"},et={class:"pic-select-img"},tt=["src"],lt=["onClick"],at={key:1,class:"extra mt10",style:{"text-align":"center"}},st={class:"attr-warp-title"},ot={class:"red"},dt={class:"flex flex-align-center"},it={class:"attr-list other-attr"},rt={class:"attr-warp-title mb10"},ut=["onClick"],nt={class:"title flex"},mt={class:"value"},ct={class:"attr-extra-value"},pt={style:{width:"180px"}},vt=["onClick"],ft={class:"attr-warp-title"},bt={class:"lyecs-form-table"},kt={class:"flex flex-align-center flex-justify-center"},Vt={style:{"padding-top":"20px"}},gt={class:"dialog-footer"},_t=xe({__name:"Attr",props:ae({attrList:{type:Object,default:{normal:[],spe:[],extra:[]}},productList:{type:[Object,Array],default:[]},attrChanged:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},action:{type:String,default:"add"},attrTplList:{type:Array}},{skuErrorText:{default:""},skuErrorTextModifiers:{}}),emits:ae(["update:productList","update:attrList","update:attrChanged"],["update:skuErrorText"]),setup(n,{expose:re,emit:ue}){const $=h(!1),M=n,G=h(),O=h(""),R=ye(n,"skuErrorText"),q=ue,B={normal:0,spe:1,extra:2},I=h(null),k=h({}),p=h(M.attrList),f=h(M.productList),ne=(a,e)=>{const d=a.find(b=>b.attrName===e);return d?d.attrValue:""},z=he(()=>{let a=0;for(let e in f.value)a+=Number(f.value[e].skuStock);return a});h(!1);const V=h({name:"",type:""});let J=!1;we(()=>{q("update:productList",f),q("update:attrList",p)});const me=(a,e,d)=>{const b=a.field.split(".")[1];let r=Number(f.value[b].skuStock);if(f.value[b].skuStock=r,isNaN(r)){d(new Error("请输入数字"));return}else if(r==null||r==null||Number.isNaN(r)){d(new Error("请输入商品库存"));return}else if(M.action!="add"&&r<0){d(new Error("库存不能是负数"));return}else if(Number.isInteger(r))d();else{d(new Error("商品库存必须是整数"));return}},ce=(a,e,d)=>{const b=a.field.split(".")[1];if(Number(f.value[b].skuPrice))d();else{d(new Error("请输入商品一口价"));return}},pe=async()=>{await G.value.validate()},H=a=>{f.value=D()},Q=(a,e)=>{p.value[a][e].attrList.push({attrValue:"",attrType:B[a],attrName:p.value[a][e].attrName})},W=(a,e,d)=>{p.value[a][e].attrList.splice(d,1),f.value=D()},K=(a,e)=>{p.value[a].splice(e,1),f.value=D()},X=(a,e)=>{$.value=!0,O.value=e,V.value.name="",V.value.type=a},ve=a=>{p.value[a].push({attrName:"",attrList:[{attrType:B[a],attrName:"",attrValue:""}]})},fe=(a,e)=>{p.value[e.type][e.index].attrList[e.idx].attrPic=a[0].picUrl,p.value[e.type][e.index].attrList[e.idx].attrPicThumb=a[0].picThumb},be=(a,e,d)=>{p.value[a][e].attrList[d].attrPic="",p.value[a][e].attrList[d].attrPicThumb=""},ke=()=>{ie.confirm({title:"导入模板会清空并重置已设置的属性、规格、规格库存等设置，确认导入吗？",async onOk(){Ce({url:"product/productAttributesTpl/detail?id="+I.value,method:"get"}).then(a=>{let e=a.tplData;for(let d in e){p.value[d]=[];for(let b in e[d])p.value[d].push({attrName:e[d][b].attrName,attrList:[{attrValue:"",attrType:B[d],attrName:e[d][b].attrName}]})}})}})},j=()=>{let a=1;for(let e in f.value)k.value.skuStock&&(f.value[e].skuStock=k.value.skuStock),k.value.skuSn&&(f.value[e].skuSn=k.value.skuSn+"-"+a),k.value.skuTsn&&(f.value[e].skuTsn=k.value.skuTsn+"-"+a),k.value.skuPrice&&(f.value[e].skuPrice=k.value.skuPrice),a++},Y=h(),Ve=a=>{a.validate(e=>{if(e){if(p.value[V.value.type].find(b=>b.attrName===V.value.name)){ie.error({title:"属性名称“"+V.value.name+"”已存在"});return}p.value[V.value.type].push({attrName:V.value.name,attrList:[{attrType:B[V.value.type],attrName:V.value.name,attrValue:""}]}),$.value=!1,O.value=""}})},Z=h([]),D=()=>{if(p.value.spe.length==0)return[];let a=ee(p.value.spe),e=[];for(let d in a){e[d]={attrNames:[],attrValues:[],attrs:[]};let b=[];for(let m in a[d])e[d].attrs[m]={attrName:a[d][m].attrName,attrValue:a[d][m].attrValue},b.push(a[d][m].attrName+":"+a[d][m].attrValue),e[d].attrNames.push(a[d][m].attrName),e[d].attrValues.push(a[d][m].attrValue),e[d].skuStock=e[d].skuStock;e[d].skuValue=b.join("|");const r=f.value.find(m=>e[d].skuValue==m.skuValue);r&&(e[d].skuStock=r.skuStock,e[d].skuSn=r.skuSn,e[d].skuTsn=r.skuTsn,e[d].skuPrice=r.skuPrice)}return f.value=e,e};Ne(()=>p.value,(a,e)=>{J==!0&&q("update:attrChanged",!0),Z.value=D(),J=!0},{deep:!0,immediate:!0});function ee(a){const e=[];if(a.length===0)return R.value="",e.push([]),e;a.map(r=>{r.attrList.length>0&&r.attrList.map(m=>{m.attrName=r.attrName})});const d=a[0],b=a.slice(1);for(let r=0;r<d.attrList.length;r++){const m=[d.attrList[r]],g=ee(b);for(let U=0;U<g.length;U++)e.push([...m,...g[U]])}return e}return re({skuErrorText:R,validateProductSku:pe}),(a,e)=>{const d=_("el-option"),b=_("el-select"),r=_("el-space"),m=_("el-button"),g=_("el-form-item"),U=_("el-icon"),te=_("el-tooltip"),A=_("el-table-column"),E=_("TigInput"),ge=_("el-table"),le=_("el-form"),_e=_("el-dialog");return u(),v("div",$e,[s(g,{label:"属性模板",prop:"type",class:"inner-item"},{default:o(()=>[s(r,null,{default:o(()=>[s(b,{modelValue:I.value,"onUpdate:modelValue":e[0]||(e[0]=t=>I.value=t),placeholder:"请选择",clearable:"",disabled:n.disabled,style:{width:"200px"}},{default:o(()=>[(u(!0),v(L,null,S(n.attrTplList,t=>(u(),C(d,{label:t.tplName,key:t.tplId,value:t.tplId},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1}),s(m,{disabled:!I.value,onClick:ke,style:{"margin-left":"10px"}},{default:o(()=>e[14]||(e[14]=[w("确认导入",-1)])),_:1,__:[14]},8,["disabled"])]),_:1}),s(g,{prop:"brandLogo",label:"商品属性"},{default:o(()=>[l("div",Ae,[(u(!0),v(L,null,S(p.value.normal,(t,c)=>(u(),v("div",Ee,[l("div",Be,[e[16]||(e[16]=l("div",{class:"label"},"属性名：",-1)),l("div",Ie,[s(P,{modelValue:t.attrName,"onUpdate:modelValue":i=>t.attrName=i,width:"280px",disabled:n.disabled,dataType:8},null,8,["modelValue","onUpdate:modelValue","disabled"]),n.disabled?x("",!0):(u(),v("div",{key:0,class:"btn-remove3",onClick:i=>K("normal",c)},e[15]||(e[15]=[l("i",{class:"iconfont icon-cha1"},null,-1)]),8,je))])]),l("div",De,[(u(!0),v(L,null,S(t.attrList,(i,T)=>(u(),C(r,{class:"attr-row"},{default:o(()=>[s(P,{modelValue:i.attrValue,"onUpdate:modelValue":y=>i.attrValue=y,width:"310px",disabled:n.disabled,dataType:8},null,8,["modelValue","onUpdate:modelValue","disabled"])]),_:2},1024))),256))])]))),256)),l("div",Fe,[s(m,{disabled:n.disabled,onClick:e[1]||(e[1]=t=>X("normal","添加商品属性"))},{default:o(()=>e[17]||(e[17]=[l("i",{class:"btn-ico"},"+",-1),w("添加商品属性",-1)])),_:1,__:[17]},8,["disabled"])])])]),_:1}),s(g,{label:"商品规格"},{default:o(()=>[l("div",Me,[(u(!0),v(L,null,S(p.value.spe,(t,c)=>(u(),v("div",Oe,[n.disabled?x("",!0):(u(),v("div",{key:0,class:"btn-remove",onClick:i=>K("spe",c)},e[18]||(e[18]=[l("i",{class:"iconfont icon-cha1"},null,-1)]),8,Re)),l("div",qe,[l("div",ze,[e[19]||(e[19]=l("div",{class:"label"},"规格名：",-1)),l("div",He,[s(P,{modelValue:t.attrName,"onUpdate:modelValue":i=>t.attrName=i,disabled:n.disabled,dataType:8,placeholder:"请输入规格项，如颜色、尺码、大小",onBlur:H},null,8,["modelValue","onUpdate:modelValue","disabled"])])])]),l("div",Ke,[s(N(Se),{class:"attr-row-box","item-key":"deagIndex",list:t.attrList,"ghost-class":"sortable-ghost","chosen-class":"toolChosenClass",animation:"300",onStart:e[2]||(e[2]=()=>{}),onEnd:H,group:{name:"advanced",pull:!1,put:!0}},{item:o(({element:i,index:T})=>[l("div",Ze,[l("div",Ge,[l("div",Je,[s(P,{modelValue:i.attrValue,"onUpdate:modelValue":y=>i.attrValue=y,disabled:n.disabled,dataType:8,placeholder:"请输入规格值，如：白色",onBlur:H,"suffix-icon":N(Te)},null,8,["modelValue","onUpdate:modelValue","disabled","suffix-icon"])]),t.attrList.length>1&&!n.disabled?(u(),v("div",{key:0,class:"btn-remove2",onClick:y=>W("spe",c,T)},e[20]||(e[20]=[l("i",{class:"iconfont icon-cha1"},null,-1)]),8,Qe)):x("",!0),c<1?(u(),v("div",We,[e[21]||(e[21]=l("div",{class:"arrow"},null,-1)),l("div",Xe,[n.disabled?x("",!0):(u(),v("div",Ye,[s(N(Pe),{type:"gallery",onOkCallback:fe,data:{type:"spe",index:c,idx:T}},{default:o(()=>[l("div",et,[i.attrPicThumb?(u(),v("img",{key:0,src:N(Ue)(i.attrPicThumb)},null,8,tt)):x("",!0)])]),_:2},1032,["data"]),i.attrPicThumb?(u(),v("i",{key:0,onClick:y=>be("spe",c,T),class:"pic-select-del iconfont icon-cha"},null,8,lt)):x("",!0)]))])])):x("",!0)]),T===t.attrList.length-1?(u(),C(m,{key:0,disabled:n.disabled,onClick:y=>Q("spe",c),link:"",type:"primary",class:"ml10",style:{"margin-top":"8px"}},{default:o(()=>e[22]||(e[22]=[l("i",{class:"btn-ico"},"+",-1),w("增加规格值",-1)])),_:2,__:[22]},1032,["disabled","onClick"])):x("",!0)])]),_:2},1032,["list"])]),c<1?(u(),v("div",at," 仅支持为第一组规格设置规格图片，买家选择不同规格会看到对应规格图片，建议尺寸：800 x 800像素 ")):x("",!0)]))),256)),l("div",st,[s(m,{disabled:n.disabled,onClick:e[3]||(e[3]=t=>ve("spe"))},{default:o(()=>e[23]||(e[23]=[l("i",{class:"btn-ico"},"+",-1),w("添加商品规格",-1)])),_:1,__:[23]},8,["disabled"])])]),l("div",ot,se(R.value),1)]),_:1}),s(g,{label:""},{label:o(()=>[s(te,{class:"box-item",effect:"light",placement:"bottom","show-after":"300"},{content:o(()=>e[24]||(e[24]=[l("div",{style:{width:"300px",padding:"5px 10px"}}," 附加规格不仅是商品的详细描述，还能为用户提供额外的服务保障，如保修、 安装或技术支持等，这些服务可能涉及附加服务费。通过清晰地列出这些附加规格， 您可以帮助用户更好地理解商品的价值，并做出更明智的购买决策，从而提升用户体验和销售转化率。 ",-1)])),default:o(()=>[l("div",dt,[e[25]||(e[25]=l("div",null,"附加规格",-1)),s(U,{style:{"margin-left":"5px"},size:"14",color:"#999"},{default:o(()=>[s(N(oe))]),_:1})])]),_:1})]),default:o(()=>[l("div",it,[(u(!0),v(L,null,S(p.value.extra,(t,c)=>(u(),v("div",rt,[l("div",{class:"btn-remove5",onClick:i=>K("extra",c)},e[26]||(e[26]=[l("i",{class:"iconfont icon-cha1"},null,-1)]),8,ut),l("div",null,[l("div",nt,[e[27]||(e[27]=l("div",{class:"label"},"附加规格名：",-1)),l("div",mt,[s(P,{modelValue:t.attrName,"onUpdate:modelValue":i=>t.attrName=i,width:"260px",disabled:n.disabled,dataType:8},null,8,["modelValue","onUpdate:modelValue","disabled"])])]),l("div",ct,[(u(!0),v(L,null,S(t.attrList,(i,T)=>(u(),C(r,{class:"attr-row mb10",size:16},{default:o(()=>[l("div",pt,[s(P,{modelValue:i.attrValue,"onUpdate:modelValue":y=>i.attrValue=y,disabled:n.disabled,dataType:8},null,8,["modelValue","onUpdate:modelValue","disabled"])]),s(r,{size:0},{default:o(()=>[e[28]||(e[28]=w(" 附加金额： ",-1)),s(de,{disabled:n.disabled,modelValue:i.attrPrice,"onUpdate:modelValue":y=>i.attrPrice=y,width:"150px"},null,8,["disabled","modelValue","onUpdate:modelValue"])]),_:2,__:[28]},1024),t.attrList.length>1&&!n.disabled?(u(),v("div",{key:0,class:"btn-remove4",onClick:y=>W("extra",c,T)},e[29]||(e[29]=[l("i",{class:"iconfont icon-cha1"},null,-1)]),8,vt)):x("",!0)]),_:2},1024))),256))])]),s(r,{class:"attr-row mt10",style:{"margin-left":"85px"}},{default:o(()=>[s(m,{disabled:n.disabled,onClick:i=>Q("extra",c)},{default:o(()=>e[30]||(e[30]=[l("i",{class:"btn-ico"},"+",-1),w("增加新属性",-1)])),_:2,__:[30]},1032,["disabled","onClick"])]),_:2},1024)]))),256)),l("div",ft,[s(m,{disabled:n.disabled,onClick:e[4]||(e[4]=t=>X("extra","添加商品附加规格"))},{default:o(()=>e[31]||(e[31]=[l("i",{class:"btn-ico"},"+",-1),w("添加商品附加规格",-1)])),_:1,__:[31]},8,["disabled"])])])]),_:1}),s(le,{ref_key:"productFormRef",ref:G,model:f.value,"label-width":"100px",name:"form_in_modal"},{default:o(()=>[Z.value.length>0?(u(),C(g,{key:0,label:"规格明细",prop:"productList"},{default:o(()=>[l("div",bt,[s(ge,{data:f.value,style:{width:"100%"}},{default:o(()=>[(u(!0),v(L,null,S(Z.value[0].attrs,t=>(u(),C(A,{prop:"attrs",label:t.attrName,align:"center"},{default:o(({row:c,$index:i})=>[w(se(ne(c.attrs,t.attrName)),1)]),_:2},1032,["label"]))),256)),s(A,{prop:"skuPrice",label:"一口价",width:"150",fixed:"right"},{header:o(()=>[s(te,{effect:"light",placement:"top"},{content:o(()=>e[32]||(e[32]=[l("div",{style:{width:"100px",padding:"5px 10px"}},"一口价会覆盖除属性价格外的所有价格，慎重设置",-1)])),default:o(()=>[s(N(F),{isDirect:!0,isHover:!1,max:100,type:"decimal","org-value":k.value.skuPrice,"onUpdate:orgValue":e[5]||(e[5]=t=>k.value.skuPrice=t),onCallback:j,label:"一口价"},{default:o(()=>[l("div",kt,[e[33]||(e[33]=l("em",{class:"red"},"*",-1)),e[34]||(e[34]=l("div",null,"一口价",-1)),s(U,{style:{"margin-left":"5px"},size:"14",color:"#999"},{default:o(()=>[s(N(oe))]),_:1})])]),_:1},8,["org-value"])]),_:1})]),default:o(({row:t,$index:c})=>[s(g,{label:"",prop:`productList.${c}.skuPrice`,rules:[{required:!0,validator:ce}]},{default:o(()=>[s(de,{modelValue:t.skuPrice,"onUpdate:modelValue":i=>t.skuPrice=i,disabled:n.disabled},null,8,["modelValue","onUpdate:modelValue","disabled"])]),_:2},1032,["prop","rules"])]),_:1}),s(A,{prop:"skuStock",label:"库存",width:"150",fixed:"right"},{header:o(()=>[s(N(F),{isDirect:!0,isHover:!1,max:100,"org-value":k.value.skuStock,"onUpdate:orgValue":e[6]||(e[6]=t=>k.value.skuStock=t),onCallback:j,label:"库存"},{default:o(()=>e[35]||(e[35]=[l("div",{class:"flex flex-align-center flex-justify-center"},[l("em",{class:"red"},"*"),w(" 库存")],-1)])),_:1,__:[35]},8,["org-value"])]),default:o(({row:t,$index:c})=>[s(g,{label:"",prop:`productList.${c}.skuStock`,rules:[{required:!0,validator:me}]},{default:o(()=>[s(E,{type:"integer",modelValue:t.skuStock,"onUpdate:modelValue":i=>t.skuStock=i,disabled:n.disabled,min:0},null,8,["modelValue","onUpdate:modelValue","disabled"])]),_:2},1032,["prop","rules"])]),_:1}),s(A,{prop:"skuSn",label:"商品编码",width:"150",fixed:"right"},{header:o(()=>[s(N(F),{isDirect:!0,isHover:!1,max:100,"org-value":k.value.skuSn,"onUpdate:orgValue":e[7]||(e[7]=t=>k.value.skuSn=t),onCallback:j,label:"商品编码"},{default:o(()=>e[36]||(e[36]=[l("div",{class:"flex flex-align-center flex-justify-center"},"商品编码",-1)])),_:1,__:[36]},8,["org-value"])]),default:o(({row:t,$index:c})=>[s(E,{modelValue:t.skuSn,"onUpdate:modelValue":i=>t.skuSn=i,disabled:n.disabled},null,8,["modelValue","onUpdate:modelValue","disabled"])]),_:1}),s(A,{prop:"skuTsn",label:"商品条形码",width:"150",fixed:"right"},{header:o(()=>[s(N(F),{isDirect:!0,isHover:!1,max:100,"org-value":k.value.skuTsn,"onUpdate:orgValue":e[8]||(e[8]=t=>k.value.skuTsn=t),onCallback:j,label:"商品条形码"},{default:o(()=>e[37]||(e[37]=[l("div",{class:"flex flex-align-center flex-justify-center"},"商品条形码",-1)])),_:1,__:[37]},8,["org-value"])]),default:o(({row:t,$index:c})=>[s(E,{modelValue:t.skuTsn,"onUpdate:modelValue":i=>t.skuTsn=i,disabled:n.disabled},null,8,["modelValue","onUpdate:modelValue","disabled"])]),_:1})]),_:1},8,["data"])])]),_:1})):x("",!0)]),_:1},8,["model"]),z.value?(u(),C(g,{key:0,label:"库存",prop:"totalStock"},{default:o(()=>[s(E,{classType:"tig-form-input",type:"integer",modelValue:z.value,"onUpdate:modelValue":e[9]||(e[9]=t=>z.value=t),placeholder:"请输入商品库存",disabled:f.value.length>0},null,8,["modelValue","disabled"])]),_:1})):x("",!0),s(_e,{modelValue:$.value,"onUpdate:modelValue":e[13]||(e[13]=t=>$.value=t),title:O.value,width:"450"},{footer:o(()=>[l("div",gt,[s(m,{onClick:e[11]||(e[11]=t=>$.value=!1)},{default:o(()=>e[39]||(e[39]=[w("关闭",-1)])),_:1,__:[39]}),s(m,{type:"primary",onClick:e[12]||(e[12]=t=>Ve(Y.value))},{default:o(()=>e[40]||(e[40]=[w(" 确定 ",-1)])),_:1,__:[40]})])]),default:o(()=>[l("div",Vt,[s(le,{ref_key:"formRef",ref:Y,"label-width":"auto",model:V.value},{default:o(()=>[s(g,{prop:"name",label:"属性名称"},{default:o(()=>[s(E,{width:"100%",modelValue:V.value.name,"onUpdate:modelValue":e[10]||(e[10]=t=>V.value.name=t)},null,8,["modelValue"]),e[38]||(e[38]=l("div",{class:"extra"},"提示：添加新的商品规格属性类型，会清空规格库存中的所有设置",-1))]),_:1,__:[38]})]),_:1},8,["model"])])]),_:1},8,["modelValue","title"])])}}}),Ut=Le(_t,[["__scopeId","data-v-1deb70be"]]);export{Ut as default};
