/* empty css             */import"./index-BdoKLCH8.js";import{_ as B}from"./Switch.vue_vue_type_script_setup_true_lang-BQY033uH.js";import{D as M}from"./DeleteRecord-C3QKVgd9.js";/* empty css                                                                    */import{P as ne}from"./Pagination-Nz0PhK3s.js";import{i as re}from"./format-CpNC4fsQ.js";import{d as de,a as ie,v as pe,r as _,a9 as $,Q as ce,o as ue,J as w,e as d,f,g as c,h as n,y as a,l as o,j as O,k as y,K as v,i as l,t as I,F as _e}from"./index-BGgofOm4.js";import{P as V}from"./PopSelect.vue_vue_type_style_index_0_scoped_5832cf6b_lang-DhDNvZWl.js";import{u as me,g as q,a as b,d as E,b as ge}from"./category-0ZzOrTFu.js";import{_ as z}from"./DialogForm.vue_vue_type_script_setup_true_lang-BTf40oxg.js";import"./index-BS7Hjr9I.js";const fe=["href"],ye={class:"container"},ve={class:"content_wrapper"},he={class:"lyecs-table-list-warp"},ke={class:"list-table-tool lyecs-search-warp"},Ie={class:"list-table-tool-row"},be={class:"list-table-tool-col"},Ce={key:1},xe={class:"table-container"},Ae={style:{position:"relative"}},Se=["onClick"],qe={key:1},ze={key:0},Ue={class:"empty-warp"},De={key:0,class:"empty-bg"},Ne={key:0,class:"pagination-con"},je=de({__name:"List",setup(we){const H=me(),{currentRoute:L}=ie(),F=pe(),j=_(F.icoDefinedCss),P=_([]),C=_(!0),x=_(0),h=_([]),J=_([]),i=$({page:1,size:F.get("pageSize"),sortField:"",sortOrder:"",keyword:"",isShow:-1,parentId:0}),A=_([0]);_();const K=ce(),k=$({});ue(()=>{const s=L.value.query;s.id>0&&(i.parentId=s.id),K.meta.title="",u()});const u=async()=>{C.value=!0;try{const s=await q({...i});P.value=s.records,x.value=s.total}catch(s){w.error(s.message)}finally{C.value=!1}},Q=async(s,t,r)=>{k[s.categoryId]={},k[s.categoryId].resolve=r,k[s.categoryId].expandCount=0;const m=await q({page:1,parentId:s.categoryId,size:1e3});r(m.records),s.children=m.records},G=async(s,t)=>{const r=k[s.categoryId];if(r.expandCount++,t&&r.expandCount>1&&!r.prevStatus){const m=await q({page:1,parentId:s.categoryId,size:1e3});r.resolve(m.records)}r.prevStatus=t},S=_(),U=async(s,t)=>{const r=k[t.parentId];if(r){const m=await q({page:1,parentId:t.parentId,size:1e3});S.value.store.states.lazyTreeNodeMap.value[t.parentId].length>1?S.value.store.states.lazyTreeNodeMap[t.parentId]=[]:S.value.store.states.lazyTreeNodeMap.value[t.parentId]=[],r.resolve(m.records)}else u()},D=()=>{H.clearCategory()},W=s=>{A.value.push(s),i.parentId=s,u()},X=()=>{A.value.pop(),i.parentId=A.value[A.value.length-1],u()},Y=async s=>{try{const t=await ge(s,{ids:h.value});w.success("操作成功"),u()}catch(t){w.error(t.message)}},Z=s=>{h.value=s.map(t=>t.categoryId)};return(s,t)=>{const r=d("el-button"),m=d("el-popconfirm"),N=d("el-space"),ee=d("el-form"),g=d("el-table-column"),te=d("el-image"),R=d("el-divider"),T=d("el-dropdown-item"),ae=d("el-dropdown-menu"),oe=d("el-dropdown"),se=d("el-table"),le=d("a-spin");return c(),f(_e,null,[n("link",{href:j.value,rel:"stylesheet"},null,8,fe),n("div",ye,[n("div",ve,[n("div",he,[n("div",ke,[a(ee,{model:i,name:"form"},{default:o(()=>[n("div",Ie,[n("div",be,[a(N,null,{default:o(()=>[i.parentId>0?(c(),O(r,{key:0,onClick:X},{default:o(()=>t[3]||(t[3]=[n("i",{class:"iconfont icon-fanhui",style:{"font-size":"14px","padding-right":"5px"}},null,-1),v(" 返回上一级 ",-1)])),_:1,__:[3]})):y("",!0),a(l(z),{params:{act:"add",parentId:i.parentId},isDrawer:"",path:"product/category/Info",title:"添加分类",width:"600px",onOkCallback:u},{default:o(()=>[a(r,{type:"primary"},{default:o(()=>t[4]||(t[4]=[v("添加分类",-1)])),_:1,__:[4]})]),_:1},8,["params"]),a(m,{title:"您确认要批量删除所选数据吗？",onConfirm:t[0]||(t[0]=e=>Y("del"))},{reference:o(()=>[a(r,{disabled:h.value.length===0},{default:o(()=>t[5]||(t[5]=[v("批量删除",-1)])),_:1,__:[5]},8,["disabled"])]),_:1}),h.value.length>0?(c(),f("span",Ce,[t[6]||(t[6]=v(" 已选择：",-1)),n("b",null,I(h.value.length),1),t[7]||(t[7]=v(" 项 ",-1))])):y("",!0)]),_:1})])])]),_:1},8,["model"])]),n("div",xe,[a(le,{spinning:C.value},{default:o(()=>[a(se,{data:P.value,"expand-row-keys":J.value,indent:30,load:Q,total:x.value,"tree-props":{children:"children",hasChildren:"hasChildren"},lazy:"","row-key":"categoryId",onSelectionChange:Z,onExpandChange:G,ref_key:"tableRef",ref:S},{empty:o(()=>[n("div",Ue,[C.value?y("",!0):(c(),f("div",De,"暂无数据"))])]),default:o(()=>[a(g,{type:"selection",width:"32"}),a(g,{width:200,label:"分类名称"},{default:o(({row:e})=>[a(N,{style:{height:"30px"}},{default:o(()=>[n("div",Ae,[a(l(V),{"org-value":e.categoryName,"onUpdate:orgValue":p=>e.categoryName=p,params:{id:e.categoryId,field:"categoryName"},requestApi:l(b),label:"分类名称",type:"textarea",onCallback:D},{default:o(()=>[e.hasChildren?(c(),f("a",{key:0,onClick:p=>W(e.categoryId)},I(e.categoryName),9,Se)):(c(),f("span",qe,I(e.categoryName),1))]),_:2},1032,["org-value","onUpdate:orgValue","params","requestApi"])])]),_:2},1024)]),_:1}),a(g,{width:120,label:"分类图片"},{default:o(({row:e})=>[e.categoryPic?(c(),f("div",ze,[a(te,{src:l(re)(e.categoryPic),fit:"contain",style:{height:"30px",width:"30px"}},null,8,["src"])])):y("",!0)]),_:1}),a(g,{label:"单位"},{default:o(({row:e})=>[a(l(V),{"org-value":e.measureUnit,"onUpdate:orgValue":p=>e.measureUnit=p,params:{id:e.categoryId,field:"measureUnit"},requestApi:l(b),label:"单位",type:"input",onCallback:D},{default:o(()=>[n("div",null,I(e.measureUnit||"-"),1)]),_:2},1032,["org-value","onUpdate:orgValue","params","requestApi"])]),_:1}),a(g,{label:"是否热门"},{default:o(({row:e})=>[a(l(B),{checked:e.isHot,"onUpdate:checked":p=>e.isHot=p,params:{id:e.categoryId,field:"isHot"},requestApi:l(b)},null,8,["checked","onUpdate:checked","params","requestApi"])]),_:1}),a(g,{key:"isShow",sorter:!0,label:"是否显示"},{default:o(({row:e})=>[a(l(B),{checked:e.isShow,"onUpdate:checked":p=>e.isShow=p,params:{id:e.categoryId,field:"isShow"},requestApi:l(b)},null,8,["checked","onUpdate:checked","params","requestApi"])]),_:1}),a(g,{key:"sortOrder",sorter:!0,label:"排序"},{default:o(({row:e})=>[a(l(V),{"org-value":e.sortOrder,"onUpdate:orgValue":p=>e.sortOrder=p,params:{id:e.categoryId,field:"sortOrder"},requestApi:l(b),label:"排序",type:"integer",onCallback:D},{default:o(()=>[n("div",null,I(e.sortOrder),1)]),_:2},1032,["org-value","onUpdate:orgValue","params","requestApi"])]),_:1}),a(g,{width:180,fixed:"right",label:"操作"},{default:o(({row:e})=>[a(N,{size:0},{default:o(()=>[a(l(z),{params:{act:"detail",id:e.categoryId},data:{parentId:e.parentId},isDrawer:"",path:"product/category/Info",title:"编辑分类",width:"600px",onOkCallback:U},{default:o(()=>t[8]||(t[8]=[n("a",{class:"btn-link"},"编辑",-1)])),_:2,__:[8]},1032,["params","data"]),a(R,{direction:"vertical"}),a(l(z),{params:{act:"add",parentId:e.categoryId},data:{parentId:e.parentId||e.categoryId},isDrawer:"",path:"product/category/Info",title:"添加子分类",width:"600px",onOkCallback:U},{default:o(()=>t[9]||(t[9]=[n("a",{class:"btn-link"},"添加子分类",-1)])),_:2,__:[9]},1032,["params","data"]),a(R,{direction:"vertical"}),a(oe,{trigger:"hover","hide-on-click":!1},{dropdown:o(()=>[a(ae,null,{default:o(()=>[a(T,null,{default:o(()=>[a(l(z),{params:{id:e.categoryId},isDrawer:"",path:"product/category/Move",title:"商品转移",width:"600px",onOkCallback:u},{default:o(()=>t[10]||(t[10]=[n("a",{class:"btn-link"},"商品转移",-1)])),_:2,__:[10]},1032,["params"])]),_:2},1024),a(T,null,{default:o(()=>[e.parentId?(c(),O(l(M),{key:0,params:{id:e.categoryId},requestApi:l(E),onAfterDelete:p=>U({},{parentId:e.parentId})},{default:o(()=>t[11]||(t[11]=[v("删除 ",-1)])),_:2,__:[11]},1032,["params","requestApi","onAfterDelete"])):y("",!0),e.parentId?y("",!0):(c(),O(l(M),{key:1,params:{id:e.categoryId},requestApi:l(E),onAfterDelete:u},{default:o(()=>t[12]||(t[12]=[v("删除",-1)])),_:2,__:[12]},1032,["params","requestApi"]))]),_:2},1024)]),_:2},1024)]),default:o(()=>[t[13]||(t[13]=n("span",{class:"iconfont-admin icon-gengduo1 btn-link"},null,-1))]),_:2,__:[13]},1024)]),_:2},1024)]),_:1})]),_:1},8,["data","expand-row-keys","total"])]),_:1},8,["spinning"]),x.value>0?(c(),f("div",Ne,[a(l(ne),{page:i.page,"onUpdate:page":t[1]||(t[1]=e=>i.page=e),size:i.size,"onUpdate:size":t[2]||(t[2]=e=>i.size=e),total:x.value,onCallback:u},null,8,["page","size","total"])])):y("",!0)])])])])],64)}}});export{je as default};
