/* empty css             */import"./index-BdoKLCH8.js";import{_ as ae}from"./Switch.vue_vue_type_script_setup_true_lang-BQY033uH.js";import{D as M}from"./DeleteRecord-C3QKVgd9.js";/* empty css                                                                    */import{P as se}from"./Pagination-Nz0PhK3s.js";import{d as oe,u as re,a as R,L as le,v as ne,r as p,a9 as P,Q as ie,o as de,dl as S,J as ue,e as _,f as m,g as u,h as l,k as f,y as a,l as s,j as O,K as z,i as r,dm as q,t as v,n as pe,F as $,m as ce,dn as w,dp as me}from"./index-BGgofOm4.js";import{P as D}from"./PopSelect.vue_vue_type_style_index_0_scoped_5832cf6b_lang-DhDNvZWl.js";import{_ as T}from"./DialogForm.vue_vue_type_script_setup_true_lang-BTf40oxg.js";import"./index-BS7Hjr9I.js";const ye=["href"],he={class:"container"},_e={class:"content_wrapper"},fe={key:0,class:"lyecs-table-list-warp"},ve={class:"list-table-tool lyecs-search-warp"},Ie={class:"list-table-tool-row"},ge={class:"list-table-tool-col"},ke={class:"table-container"},be={style:{position:"relative"}},Ce=["onClick"],xe={key:1},Ae={class:"empty-warp"},Se={key:0,class:"empty-bg"},ze={key:0,class:"pagination-con"},$e=oe({__name:"List",setup(qe){const B=re(),{currentRoute:L}=R();R(),le();const F=ne(),E=p(F.icoDefinedCss),k=p("admin"),U=p([]),b=p(!0),C=p(0),K=p([]),j=p([]),d=P({page:1,size:F.get("pageSize"),sortField:"sortOrder",sortOrder:"",adminType:"admin",keyword:"",parentId:0}),x=p([0]);p();const J=ie(),I=P({});de(()=>{const o=L.value.query;o.id>0&&(d.parentId=o.id),J.meta.title="",y()});const y=async()=>{b.value=!0;try{const o=await S({...d});U.value=o.records,C.value=o.total}catch(o){ue.error(o.message)}finally{b.value=!1}},Q=async(o,t,n)=>{I[o.authorityId]={},I[o.authorityId].resolve=n,I[o.authorityId].expandCount=0;const c=await S({page:1,parentId:o.authorityId,sortField:"sortOrder",size:1e3});n(c.records)},G=async(o,t)=>{const n=I[o.authorityId];if(n.expandCount++,t&&n.expandCount>1&&!n.prevStatus){const c=await S({page:1,parentId:o.authorityId,sortField:"sortOrder",size:1e3});n.resolve(c.records)}n.prevStatus=t},A=p(null),N=async(o,t)=>{const n=I[t.parentId];if(n){const c=await S({page:1,parentId:t.parentId,sortField:"sortOrder",size:1e3});A.value.store.states.lazyTreeNodeMap.value[t.parentId].length>1?A.value.store.states.lazyTreeNodeMap[t.parentId]=[]:A.value.store.states.lazyTreeNodeMap.value[t.parentId]=[],n.resolve(c.records)}else y()},g=async()=>{B.mainMenu=await me()},H=o=>{x.value.push(o),d.parentId=o,y()},W=()=>{x.value.pop(),d.parentId=x.value[x.value.length-1],y()},X=o=>{K.value=o.map(t=>t.authorityId)};return(o,t)=>{const n=_("el-button"),c=_("el-space"),Y=_("el-form"),h=_("el-table-column"),V=_("el-divider"),Z=_("el-table"),ee=_("a-spin");return u(),m($,null,[l("link",{href:E.value,rel:"stylesheet"},null,8,ye),l("div",he,[l("div",_e,[k.value!=null?(u(),m("div",fe,[l("div",ve,[a(Y,{model:d,name:"form"},{default:s(()=>[l("div",Ie,[l("div",ge,[a(c,null,{default:s(()=>[d.parentId>0?(u(),O(n,{key:0,onClick:W},{default:s(()=>t[3]||(t[3]=[l("i",{class:"iconfont icon-fanhui",style:{"font-size":"14px","padding-right":"5px"}},null,-1),z(" 返回上一级 ",-1)])),_:1,__:[3]})):f("",!0),a(r(T),{params:{act:"add",parentId:d.parentId,adminType:k.value},isDrawer:"",path:"authority/authority/Info",title:"添加权限",width:"580px",onOkCallback:y},{default:s(()=>[a(n,{type:"primary"},{default:s(()=>t[4]||(t[4]=[z("添加权限",-1)])),_:1,__:[4]})]),_:1},8,["params"])]),_:1})])])]),_:1},8,["model"])]),l("div",ke,[a(ee,{spinning:b.value},{default:s(()=>[a(Z,{ref_key:"tableRef",ref:A,data:U.value,"expand-row-keys":j.value,indent:30,load:Q,total:C.value,"tree-props":{children:"children",hasChildren:"hasChildren"},lazy:"","row-key":"authorityId",onSelectionChange:X,onExpandChange:G},{empty:s(()=>[l("div",Ae,[b.value?f("",!0):(u(),m("div",Se,"暂无数据"))])]),default:s(()=>[a(h,{width:260,label:"权限名称"},{default:s(({row:e})=>[a(c,{style:{height:"30px"}},{default:s(()=>[l("div",be,[a(r(D),{"org-value":e.authorityName,"onUpdate:orgValue":i=>e.authorityName=i,params:{id:e.authorityId,field:"authorityName"},requestApi:r(q),label:"权限名称",type:"textarea",onCallback:g},{default:s(()=>[e.hasChildren?(u(),m("a",{key:0,onClick:i=>H(e.authorityId)},v(e.authorityName),9,Ce)):(u(),m("span",xe,v(e.authorityName),1))]),_:2},1032,["org-value","onUpdate:orgValue","params","requestApi"])])]),_:2},1024)]),_:1}),a(h,{width:100,label:"权限图标"},{default:s(({row:e})=>[l("em",{class:pe([e.authorityIco,"main_pel_m"])},null,2)]),_:1}),a(h,{label:"唯一编码"},{default:s(({row:e})=>[a(r(D),{"org-value":e.authoritySn,"onUpdate:orgValue":i=>e.authoritySn=i,params:{id:e.authorityId,field:"authoritySn"},requestApi:r(q),label:"唯一编码",type:"textarea",onCallback:g},{default:s(()=>[l("div",null,v(e.authoritySn||"-"),1)]),_:2},1032,["org-value","onUpdate:orgValue","params","requestApi"])]),_:1}),a(h,{label:"细分权限"},{default:s(({row:e})=>[(u(!0),m($,null,ce(e.childAuth,(i,te)=>(u(),m("span",null,v(te!=0?",":"")+v(i.authName),1))),256))]),_:1}),a(h,{key:"isShow",sorter:!0,label:"是否显示"},{default:s(({row:e})=>[a(r(ae),{checked:e.isShow,"onUpdate:checked":i=>e.isShow=i,params:{id:e.authorityId,field:"isShow"},requestApi:r(q),onCallback:g},null,8,["checked","onUpdate:checked","params","requestApi"])]),_:1}),a(h,{key:"sortOrder",sorter:!0,label:"排序"},{default:s(({row:e})=>[a(r(D),{"org-value":e.sortOrder,"onUpdate:orgValue":i=>e.sortOrder=i,params:{id:e.authorityId,field:"sortOrder"},requestApi:r(q),label:"排序",type:"integer",onCallback:g},{default:s(()=>[l("div",null,v(e.sortOrder),1)]),_:2},1032,["org-value","onUpdate:orgValue","params","requestApi"])]),_:1}),a(h,{width:220,fixed:"right",label:"操作"},{default:s(({row:e})=>[a(r(T),{data:{parentId:e.parentId},params:{act:"detail",id:e.authorityId,adminType:k.value},isDrawer:"",path:"authority/authority/Info",title:"编辑权限",width:"580px",onOkCallback:N},{default:s(()=>t[5]||(t[5]=[l("a",{class:"btn-link"},"编辑",-1)])),_:2,__:[5]},1032,["data","params"]),a(V,{direction:"vertical"}),a(r(T),{data:{parentId:e.parentId||e.authorityId},params:{act:"add",parentId:e.authorityId,adminType:k.value},isDrawer:"",path:"authority/authority/Info",title:"编辑权限",width:"580px",onOkCallback:N},{default:s(()=>t[6]||(t[6]=[l("a",{class:"btn-link"},"添加子目录",-1)])),_:2,__:[6]},1032,["data","params"]),a(V,{direction:"vertical"}),e.parentId?(u(),O(r(M),{key:0,params:{id:e.authorityId},requestApi:r(w),onAfterDelete:i=>N({},{parentId:e.parentId})},{default:s(()=>t[7]||(t[7]=[z("删除 ",-1)])),_:2,__:[7]},1032,["params","requestApi","onAfterDelete"])):f("",!0),e.parentId?f("",!0):(u(),O(r(M),{key:1,params:{id:e.authorityId},requestApi:r(w),onAfterDelete:t[0]||(t[0]=i=>{y(),g()})},{default:s(()=>t[8]||(t[8]=[z("删除 ",-1)])),_:2,__:[8]},1032,["params","requestApi"]))]),_:1})]),_:1},8,["data","expand-row-keys","total"])]),_:1},8,["spinning"]),C.value>0?(u(),m("div",ze,[a(r(se),{page:d.page,"onUpdate:page":t[1]||(t[1]=e=>d.page=e),size:d.size,"onUpdate:size":t[2]||(t[2]=e=>d.size=e),total:C.value,onCallback:y},null,8,["page","size","total"])])):f("",!0)])])):f("",!0)])])],64)}}});export{$e as default};
