import{d as ee,r as _,a as le,a2 as te,a9 as se,o as oe,J as N,e as C,f as p,g as r,h as i,j as I,k as S,l as u,y as n,E as ae,i as $,K as v,F,m as Y,t as V,I as ie,_ as re}from"./index-BGgofOm4.js";import{a as ue,u as ne}from"./seckill-DgpJrV9p.js";import"./SelectTimeInterval.vue_vue_type_style_index_0_scoped_207fe586_lang-CdQ8MEGg.js";import"./index-BdoKLCH8.js";import{i as de}from"./format-CpNC4fsQ.js";import{e as ce}from"./product-DiKWBvyV.js";/* empty css                                                                    *//* empty css                                                                              */import{S as pe}from"./SelectTimeInterval-B3x_Nno7.js";import{_ as ve}from"./DialogForm.vue_vue_type_script_setup_true_lang-BTf40oxg.js";import"./time-BL_Iz6xX.js";import"./index-BS7Hjr9I.js";const me={class:"container"},ke={class:"content_wrapper"},fe={class:"lyecs-form-table"},ye={class:"lyecs-product-select-group"},_e={key:1,class:"lyecs-product-selected-con"},ge={class:"product-selected-list"},Se={class:"product-selected-list-tr product-selected-list-th",style:{"background-color":"#f5f6fa"}},be={key:0,class:"col col3"},Ie={class:"product-selected-list-tr"},Ve={class:"col col2 product-info"},Te={style:{display:"flex"}},we=["src"],Ce={style:{"line-height":"2"}},he={class:"title"},Pe={class:"col col1"},Ee={class:"extra"},Ne={class:"col col1"},De={class:"extra"},xe={key:0,class:"col col3"},$e={key:1},Ue={key:0,class:"batch"},Me={key:1,class:"setting"},Be={key:3,class:"setting"},Le=ee({__name:"Info",props:{id:{type:Number,default:0},act:{type:String,default:""},isDialog:Boolean},emits:["submitCallback","update:confirmLoading","close"],setup(j,{expose:H,emit:J}){const h=J,T=j,D=_(!0),b=_(!0),U=le().currentRoute.value.query,k=_(T.isDialog?T.act:String(U.act)),M=_(T.isDialog?T.id:Number(U.id)),K=k.value==="add"?"create":"update",x=te(),l=_({seckillItem:[]}),z=se({seckillStartTime:[{required:!0,validator:(a,e,t)=>{e===""?t(new Error("活动时间不能为空")):l.value.seckillStartTime&&l.value.seckillEndTime?t():t(new Error("活动时间不能为空"))},trigger:"blur"}],seckillItem:[{required:!0,validator:(a,e,t)=>{if(e.length==0){t(new Error("活动商品不能为空!"));return}if(e.forEach(o=>{if(o.secondsSeckill){if(!o.hasOwnProperty("seckillPrice")||o.seckillPrice==""){t(new Error("请设置秒杀价格!"));return}if(!o.hasOwnProperty("seckillStock")||o.seckillStock===""){t(new Error("请设置秒杀库存!"));return}}}),!e.some(o=>o.secondsSeckill)){t(new Error("请至少设置一项参加秒杀的商品!"));return}t()},trigger:"blur"}]});oe(()=>{k.value==="detail"?A():(D.value=!1,b.value=!1)});const A=async()=>{var a;try{const e=await ue(k.value,{id:M.value});Object.assign(l.value,e),(a=l.value.seckillItem)==null||a.forEach(t=>{t.productName=l.value.productName,t.picThumb=l.value.picThumb,t.secondsSeckill=1,t.tipValue="已参加"}),b.value=!1}catch(e){N.error(e.message),h("close")}finally{D.value=!1,b.value=!1}},B=async()=>{await x.value.validate();try{h("update:confirmLoading",!0);const a=await ne(K,{id:M.value,...l.value});h("submitCallback",a),N.success("操作成功")}catch(a){N.error(a.message)}finally{h("update:confirmLoading",!1)}},G=()=>{B()},f=_(!0),y=_(!0),P=_(""),E=_(),L=a=>{a===1?(l.value.seckillItem.forEach(e=>{e.secondsSeckill&&(e.seckillPrice=P.value)}),P.value="",f.value=!f.value):(l.value.seckillItem.forEach(e=>{e.secondsSeckill&&(e.seckillStock=E.value)}),E.value=void 0,y.value=!y.value),x.value.validate()},Q=a=>{l.value.productId=a[0],W(a[0])},W=async a=>{var e,t;if(b.value=!0,a)try{const c=await ce("detail",{id:a});if(((e=c.productList)==null?void 0:e.length)===0){let o={};o.secondsSeckill=1,o.tipValue="已参加",o.seckillPrice="",o.seckillStock="",o.picThumb=c.picThumb,o.productName=c.productName,o.skuPrice=c.productPrice,o.skuStock=c.productStock,l.value.seckillItem=[],l.value.seckillItem.push(o)}else l.value.seckillItem=[],(t=c.productList)==null||t.forEach(o=>{let d={};d.secondsSeckill=1,d.tipValue="已参加",d.seckillPrice="",d.seckillStock="",d.picThumb=c.picThumb,d.productName=c.productName,d.skuPrice=o.skuPrice,d.skuStock=o.skuStock,d.skuId=o.skuId,d.skuData=o.skuData,l.value.seckillItem.push(d)})}catch(c){N.error(c.message)}finally{b.value=!1}},X=()=>{l.value.seckillItem=[]},q=a=>{l.value.seckillItem[a].secondsSeckill=l.value.seckillItem[a].secondsSeckill?0:1};return H({onFormSubmit:G}),(a,e)=>{const t=C("el-button"),c=C("el-space"),o=C("TigInput"),d=C("el-form-item"),Z=C("el-form");return r(),p("div",me,[i("div",ke,[i("div",fe,[D.value?S("",!0):(r(),I(Z,{key:0,ref_key:"formRef",ref:x,model:l.value,rules:z,"label-width":"auto"},{default:u(()=>[n(d,{label:"秒杀商品",prop:"seckillItem"},{default:u(()=>{var g,O;return[i("div",ye,[k.value=="add"?(r(),I(c,{key:0,style:{"margin-bottom":"15px"}},{default:u(()=>{var s;return[n($(ve),{params:{selectedIds:l.value.seckillItem,isMultiple:!1,isSelf:1},isDrawer:"",path:"product/product/src/SelectProduct",title:"选择商品",width:"600px",onOkCallback:Q},{default:u(()=>{var w;return[n(t,{loading:b.value,disabled:((w=l.value.seckillItem)==null?void 0:w.length)>0,type:"primary"},{default:u(()=>e[11]||(e[11]=[v("选择商品",-1)])),_:1,__:[11]},8,["loading","disabled"])]}),_:1},8,["params"]),((s=l.value.seckillItem)==null?void 0:s.length)>0?(r(),I(t,{key:0,onClick:X},{default:u(()=>e[12]||(e[12]=[v("清空",-1)])),_:1,__:[12]})):S("",!0)]}),_:1})):S("",!0),((g=l.value.seckillItem)==null?void 0:g.length)>0&&!b.value?(r(),p("div",_e,[i("div",ge,[i("div",Se,[e[13]||(e[13]=i("div",{class:"col col2"},"商品信息",-1)),e[14]||(e[14]=i("div",{class:"col col1"},"秒杀价",-1)),e[15]||(e[15]=i("div",{class:"col col1"},"秒杀库存",-1)),k.value=="add"&&((O=l.value.seckillItem)==null?void 0:O.length)>1?(r(),p("div",be,"操作")):S("",!0)]),(r(!0),p(F,null,Y(l.value.seckillItem,(s,w)=>{var R;return r(),p("div",Ie,[i("div",Ve,[i("div",Te,[i("img",{src:$(de)(s.picThumb),height:"50",width:"50"},null,8,we),i("span",Ce,V(s.productName),1)]),i("ul",null,[(r(!0),p(F,null,Y(s.skuData,m=>(r(),p("li",null,[i("span",he,V(m.name)+"：",1),v(V(m.value),1)]))),256))])]),i("div",Pe,[n(o,{type:"decimal",disabled:k.value!="add",modelValue:s.seckillPrice,"onUpdate:modelValue":m=>s.seckillPrice=m},null,8,["disabled","modelValue","onUpdate:modelValue"]),i("div",Ee,"价格(元)："+V(s.skuPrice||s.productPrice),1)]),i("div",Ne,[n(o,{type:"integer",disabled:k.value!="add",modelValue:s.seckillStock,"onUpdate:modelValue":m=>s.seckillStock=m},null,8,["disabled","modelValue","onUpdate:modelValue"]),i("div",De,"现有库存："+V(s.skuStock||s.productStock),1)]),k.value=="add"&&((R=l.value.seckillItem)==null?void 0:R.length)>1?(r(),p("div",xe,[s.secondsSeckill?(r(),I(t,{key:0,type:s.tipValue=="取消参加"?"danger":"primary",link:"",onClick:m=>q(w),onMouseout:m=>s.tipValue="已参加",onMouseover:m=>s.tipValue="取消参加"},{default:u(()=>[v(V(s.tipValue),1)]),_:2},1032,["type","onClick","onMouseout","onMouseover"])):(r(),I(t,{key:1,link:"",type:"primary",onClick:m=>q(w)},{default:u(()=>e[16]||(e[16]=[v("参加秒杀",-1)])),_:2,__:[16]},1032,["onClick"]))])):(r(),p("div",$e))])}),256))]),k.value=="add"?(r(),p("div",Ue,[e[23]||(e[23]=i("span",null,"批量设置：",-1)),y.value&&f.value?(r(),I(t,{key:0,link:"",type:"primary",onClick:e[0]||(e[0]=s=>f.value=!f.value)},{default:u(()=>e[17]||(e[17]=[v("秒杀价格",-1)])),_:1,__:[17]})):f.value?S("",!0):(r(),p("div",Me,[n(o,{type:"decimal",modelValue:P.value,"onUpdate:modelValue":e[1]||(e[1]=s=>P.value=s),placeholder:"请输入秒杀价格"},null,8,["modelValue"]),n(t,{link:"",type:"primary",onClick:e[2]||(e[2]=s=>L(1))},{default:u(()=>e[18]||(e[18]=[v("保存",-1)])),_:1,__:[18]}),n(t,{link:"",type:"primary",onClick:e[3]||(e[3]=s=>f.value=!f.value)},{default:u(()=>e[19]||(e[19]=[v("取消",-1)])),_:1,__:[19]})])),y.value&&f.value?(r(),I(t,{key:2,link:"",type:"primary",onClick:e[4]||(e[4]=s=>y.value=!y.value)},{default:u(()=>e[20]||(e[20]=[v("秒杀库存",-1)])),_:1,__:[20]})):y.value?S("",!0):(r(),p("div",Be,[n(o,{type:"integer",modelValue:E.value,"onUpdate:modelValue":e[5]||(e[5]=s=>E.value=s),placeholder:"请输入秒杀库存"},null,8,["modelValue"]),n(t,{link:"",type:"primary",onClick:e[6]||(e[6]=s=>L(2))},{default:u(()=>e[21]||(e[21]=[v("保存",-1)])),_:1,__:[21]}),n(t,{link:"",type:"primary",onClick:e[7]||(e[7]=s=>y.value=!y.value)},{default:u(()=>e[22]||(e[22]=[v("取消",-1)])),_:1,__:[22]})]))])):S("",!0)])):S("",!0)]),e[24]||(e[24]=i("div",{class:"extra"},"只能添加一件商品参与秒杀活动（支持对不同规格进行单独设置）",-1))]}),_:1,__:[24]}),n(d,{rules:[{required:!0,message:"活动名称不能为空!"}],label:"活动名称",prop:"seckillName"},{default:u(()=>[n(o,{classType:"tig-form-input",modelValue:l.value.seckillName,"onUpdate:modelValue":e[8]||(e[8]=g=>l.value.seckillName=g),width:"432px"},null,8,["modelValue"])]),_:1}),n(d,{label:"活动日期",prop:"seckillStartTime"},{default:u(()=>[n($(pe),{"end-date":l.value.seckillEndTime,"onUpdate:endDate":e[9]||(e[9]=g=>l.value.seckillEndTime=g),"start-date":l.value.seckillStartTime,"onUpdate:startDate":e[10]||(e[10]=g=>l.value.seckillStartTime=g),clearable:"",type:"datetime","value-format":"YYYY-MM-DD HH:mm:ss"},null,8,["end-date","start-date"])]),_:1}),ae(n(d,{"wrapper-col":{offset:4,span:16}},{default:u(()=>[n(t,{ref:"submitBtn",class:"form-submit-btn",type:"primary",onClick:B},{default:u(()=>e[25]||(e[25]=[v("提交",-1)])),_:1,__:[25]},512)]),_:1},512),[[ie,!T.isDialog]])]),_:1},8,["model","rules"]))])])])}}}),Xe=re(Le,[["__scopeId","data-v-250668ae"]]);export{Xe as default};
